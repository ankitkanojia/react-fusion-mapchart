import pads from"./pads.js";import timeDay from"../time-intervals/day.js";import utcDay from"../time-intervals/utc/day.js";import{utcMonday}from"../time-intervals/utc/week.js";import{monday as timeMonday}from"../time-intervals/week.js";var PERCENT_CHAR_CODE=37,BLANK="",newYear=function newYear(y){return{y:y,m:0,d:1,H:0,M:0,S:0,L:0}},utcDate=function utcDate(d){if(d.y>=0&&d.y<100){var date=new Date(Date.UTC(-1,d.m,d.d,d.H,d.M,d.S,d.L));date.setUTCFullYear(d.y);return date}return new Date(Date.UTC(d.y,d.m,d.d,d.H,d.M,d.S,d.L))};var TimeParser=function(){function TimeParser(specifier,parses,newDate){this._specifier=specifier;this._parses=parses;this._newDate=newDate}var _proto=TimeParser.prototype;_proto.parseSpecifier=function parseSpecifier(d,string,_j){var i=0,n=this._specifier.length,m=string.length,c,j=_j,parse;while(i<n){if(j>=m)return-1;c=this._specifier.charCodeAt(i++);if(c===PERCENT_CHAR_CODE){c=this._specifier.charAt(i++);parse=this._parses[c in pads?this._specifier.charAt(i++):c];if(!parse||(j=parse(d,string,j))<0){return-1}}else if(c!==string.charCodeAt(j++)){return-1}}return j};_proto.parse=function parse(_string){var d=newYear(1900),i,week,day,string=_string;string+=BLANK;i=this.parseSpecifier(d,string,0);if(i!==string.length)return null;if("Q"in d)return new Date(d.Q);if("p"in d)d.H=d.H%12+d.p*12;if("V"in d){if(d.V<1||d.V>53)return null;if(!("w"in d))d.w=1;if("Z"in d){week=utcDate(newYear(d.y));day=week.getUTCDay();week=day>4||day===0?utcMonday.ceil(week):utcMonday.floor(week);week=utcDay.offset(week,(d.V-1)*7);d.y=week.getUTCFullYear();d.m=week.getUTCMonth();d.d=week.getUTCDate()+(d.w+6)%7}else{week=this._newDate(newYear(d.y));day=week.getDay();week=day>4||day===0?timeMonday.ceil(week):timeMonday.floor(week);week=timeDay.offset(week,(d.V-1)*7);d.y=week.getFullYear();d.m=week.getMonth();d.d=week.getDate()+(d.w+6)%7}}else if("W"in d||"U"in d){if(!("w"in d)){if("u"in d){d.w=d.u%7}else{d.w="W"in d?1:0}}day="Z"in d?utcDate(newYear(d.y)).getUTCDay():this._newDate(newYear(d.y)).getDay();d.m=0;d.d="W"in d?(d.w+6)%7+d.W*7-(day+5)%7:d.w+d.U*7-(day+6)%7}if("Z"in d){d.H+=d.Z/100|0;d.M+=d.Z%100;return utcDate(d)}return this._newDate(d)};_proto.toString=function toString(){return this._specifier};return TimeParser}();export{utcDate};export default TimeParser;