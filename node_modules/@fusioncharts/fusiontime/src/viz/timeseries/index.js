import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import chain from"ramda/es/chain";import clone from"ramda/es/clone";import unique from"ramda/es/uniq";import xprod from"ramda/es/xprod";import equals from"ramda/es/equals";import addIndex from"ramda/es/addIndex";import{pluck,regex,UNDEF,stubFN,extend2,hashify,PXSTRING,HASHSTRING,pluckNumber,convertColor,getLightColor,getLinkAction,toRaphaelColor,DEFAULT_FT_FONT}from"@fusioncharts/core/src/lib";import{groupBy,between,pivot,filter as filterBy}from"@fusioncharts/datatable/src/operators";import extent from"@fusioncharts/utils/src/array/extent";import safeMax from"@fusioncharts/utils/src/array/safe-max";import isObject from"@fusioncharts/utils/src/type/is-object";import OrdinalScale from"@fusioncharts/utils/src/scales/ordinal";import{timeYear}from"@fusioncharts/utils/src/time-intervals";import isValidNumber from"@fusioncharts/utils/src/type/is-valid-number";import arrayHasContent from"@fusioncharts/utils/src/type/array-has-content";import{DatetimeUnits as time}from"@fusioncharts/utils/src/datetime-enums";import stringHasContent from"@fusioncharts/utils/src/type/string-has-content";import CommonAPI from"@fusioncharts/charts/src/chart/_internal/commonchartapi";import ColorManager from"@fusioncharts/charts/src/_internal/color-utils/colormanager";import xFactory from"./factories/x";import yFactory from"./factories/y";import panelFactory from"./factories/panel";import CaptionFactory from"./factories/caption";import expanderAxis from"./_utils/expanders/axis";import expanderPanel from"./_utils/expanders/panel";import expanderSeries from"./_utils/expanders/series";import backgroundFactory from"./factories/background";import Line from"../../_internal/components/dataset/line";import timeNavigatorFactory from"./factories/navigator-time";import CustomRangeFactory from"./factories/custom-range-selector";import toolbarManagerFactory from"./factories/toolbar-manager-factory";import legendFactory from"../../../src/_internal/factories/legend-factory";import toolbarFactory from"../../../src/_internal/factories/toolbar-factory";import CrosslineManager from"../../_internal/factories/multicanvas-crossline-manager";import standardRangeSelectorFactory from"../../../src/_internal/factories/standard-range-selector.factory";var DEFAULT_CANVAS_DISTANCE=20,DEFAULT_TIMENAV_HEIGHT_RATIO=.3,DEFAULT_AXIS_HEIGHT_RATIO=.6,DEFAULT_CAPTION_HEIGHT_RATIO=.3,DEFAULT_LEGEND_RATIO=.1,CANVAS_TOP_PADDING=6,LINE_HEIGHT_FACTOR=1.2,STYLE_STR_ONE="style='",STYLE_STR_TWO="'",dropHash=regex.dropHash,isDashedString=function isDashedString(str){return typeof str==="string"&&str!=="none"},columnsFilter=function columnsFilter(table,filterFn){return table.getSchema().filter(filterFn).map(function(scheme){return scheme.name})},capsFirst=function capsFirst(str){return str.charAt(0).toUpperCase()+str.slice(1)},permuteIndices=function permuteIndices(arr){return arr.map(function(p){return{x:p.x,y:p.y,plots:xprod(p.x.map(function(x){return x.index}),p.y.map(function(y){return y.index})).map(function(prod){return{x:prod[0],y:prod[1]}})}})},getIndex=function getIndex(id){return+id.split("_").pop()},toolbarPositionParser=function toolbarPositionParser(positionArg){var position=positionArg;switch(position){case"tr":case"rt":case"top right":case"right top":position="tr";break;case"br":case"rb":case"bottom right":case"right bottom":position="br";break;case"tl":case"lt":case"top left":case"left top":position="tl";break;case"bl":case"lb":case"bottom left":case"left bottom":position="bl";break;default:position="tr"}return position},isTemporalScheme=function isTemporalScheme(scheme){return scheme.type==="date"||scheme.type==="interval"},isNumericScheme=function isNumericScheme(scheme){return scheme.type==="number"},isStringyScheme=function isStringyScheme(scheme){return scheme.type==="string"},flatMap=addIndex(chain),defaultPanelsMulticanvas=function defaultPanelsMulticanvas(xs,ys){return flatMap(function(fx,ix){return ys.map(function(fy,iy,yArr){return{x:[{index:ix,visible:iy===yArr.length-1}],y:[{index:iy,align:"left"}]}})},xs)},defaultPanelsSingleCanvas=function defaultPanelsSingleCanvas(xs,ys){return flatMap(function(fx,ix){return{x:[{index:ix,visible:true}],y:ys.map(function(fy,iy){return{index:iy,align:iy%2===0?"left":"right"}})}},xs)},parsePaletteColor=function parsePaletteColor(paletteInfo){if(paletteInfo===void 0){paletteInfo=[]}var colorArr=[];if(arrayHasContent(paletteInfo)){colorArr=paletteInfo.slice()}else if(stringHasContent(paletteInfo)){colorArr=paletteInfo.split(/\s*,\s*/)}colorArr=colorArr.filter(function(color){return!!color});return colorArr.map(function(color){return hashify(color)})},setLineHeight=function setLineHeight(styleObj,baseFontSize){if(typeof styleObj!=="object"){return}if(!styleObj["line-height"]){styleObj["line-height"]=(parseFloat(styleObj["font-size"])||baseFontSize||10)*LINE_HEIGHT_FACTOR+PXSTRING}},filterer=function filterer(tree,info){for(var filter in tree){tree[filter]._fc_info.table=tree[filter]._fc_info.filter?info.table.query([tree[filter]._fc_info.filterInfo.query]):info.table;tree[filter]._fc_info.filterInfo.table=tree[filter]._fc_info.table;tableCreator(tree[filter])}},grouping=function grouping(tree,info){for(var groupOp in tree){tree[groupOp]._fc_info.table=info.table;tree[groupOp]._fc_info.group=groupOp;tableCreator(tree[groupOp])}},pivoter=function pivoter(tree,info){for(var pivotOp in tree){tree[pivotOp]._fc_info.table=info.table;tree[pivotOp]._fc_info.groupItems=info.groupItems;tree[pivotOp]._fc_info.group=info.group;tableCreator(tree[pivotOp])}},aggregator=function aggregator(operation){var operator=operation.op,operands=operation.operands,filter=operation.filter,keys=[];if(filter){for(var key in operands){if(operands.hasOwnProperty(key)){var _keys;(_keys=keys).push.apply(_keys,Object.keys(operands[key]))}}keys=unique(keys)}else{keys=Object.keys(operands)}return keys.map(function(operand){return{column:operand,operation:operator}})},seriesGenerator=function seriesGenerator(operands,uniqueItems,aggregations,op){if(uniqueItems===void 0){uniqueItems=[]}var seriesNames=[];var _loop=function _loop(operand){if(operand!=="plottype"){var filterFn=function filterFn(aggr){return aggr.column===operand&&aggr.operation===op};if(uniqueItems.length>0){seriesNames=chain(function(item){return aggregations.filter(filterFn).map(function(aggr){return[item,aggr.column,aggr.operation]})},uniqueItems).map(function(arr){return arr.join(" - ")})}else{seriesNames=aggregations.filter(filterFn).map(function(aggr){return[aggr.column,aggr.operation].join(" - ")})}seriesNames.forEach(function(name){return operands[operand].push(name)})}};for(var operand in operands){_loop(operand)}},binner=function binner(tree,info){var _loop2=function _loop2(bin){var binDecider=tree[bin]._fc_info.binDecider,chart=tree[bin]._fc_info.chart,thresholdX=binDecider.getRangeThreshold(),groupConfig=[{column:tree[bin]._fc_info.bin,timeUnit:time[capsFirst(thresholdX[0].name())],binSize:thresholdX[1],startValue:tree[bin]._fc_info.totalStart}],filterColumn=info.group,filterItems=info.groupItems,pivotColumn=info.pivot,infoTable=info.table,selectorFn=function selectorFn(item){return filterBy(function(row,col){return row[col[filterColumn]]===item})};for(var agg in tree[bin]){if(agg==="aggregate"){(function(){var ops=tree[bin][agg]._fc_info,operations=[],aggregations=[],query=void 0,queriedTables=[],uniqueItemsList=[],uniqueItems=[];for(var op in ops){operations.push({op:op,operands:ops[op],filter:filterColumn})}aggregations=chain(aggregator,operations);if(filterColumn){var filterQueries=filterItems.map(selectorFn),filteredTables=filterQueries.map(function(filterQuery){return infoTable.query([filterQuery])});if(pivotColumn){query=pivot(groupConfig,pivotColumn,aggregations);filteredTables.forEach(function(filteredTable){queriedTables.push(filteredTable.query([query]));uniqueItemsList.push(filteredTable.unique(pivotColumn))})}else{query=groupBy(groupConfig,aggregations);queriedTables=filteredTables.map(function(table){return table.query([query])})}}else{if(pivotColumn){query=pivot(groupConfig,pivotColumn,aggregations);uniqueItems=infoTable.unique(pivotColumn)}else{query=groupBy(groupConfig,aggregations)}queriedTables=[infoTable.query([query])]}chart.addEventListener("focusLimitChanged",function(){thresholdX=binDecider.getRangeThreshold();groupConfig=[{column:tree[bin]._fc_info.bin,timeUnit:time[capsFirst(thresholdX[0].name())],binSize:thresholdX[1],startValue:tree[bin]._fc_info.totalStart}];if(pivotColumn){query._updateArgs(groupConfig,pivotColumn,aggregations)}else{query._updateArgs(groupConfig,aggregations)}});operations.forEach(function(operation){var operands=operation.operands;if(filterColumn){filterItems.forEach(function(filterItem,index){var nodeInfo=operands[filterItem];nodeInfo.table=queriedTables[index];nodeInfo.position=tree[bin]._fc_info.bin;nodeInfo.filterItem=filterItem;seriesGenerator(nodeInfo,uniqueItemsList[index],aggregations,operation.op)})}else{operands.table=queriedTables[0];operands.position=tree[bin]._fc_info.bin;seriesGenerator(operands,uniqueItems,aggregations,operation.op)}})})()}}};for(var bin in tree){_loop2(bin)}},tableCreator=function tableCreator(tableMap){for(var op in tableMap){var ops=tableMap[op];if(op==="filter"){filterer(ops,tableMap._fc_info)}else if(op==="group"){grouping(ops,tableMap._fc_info)}else if(op==="pivot"){pivoter(ops,tableMap._fc_info)}else if(op==="bin"){binner(ops,tableMap._fc_info)}}},mapper=function mapper(chart,isContext){var panels,xs,ys,binDeciders,scalesX,scalesY,root;if(isContext){panels=chart.config.contextPanels;xs=chart.config.contextAxesX;ys=chart.config.contextAxesY;binDeciders=chart.getFromEnv("contextBins");scalesX=chart.getFromEnv("contextScalesX");scalesY=chart.getFromEnv("contextScalesY");root=chart.config.contextTableMap}else{panels=chart.config.focusPanels;xs=chart.config.focusAxesX;ys=chart.config.focusAxesY;binDeciders=chart.getFromEnv("focusBins");scalesX=chart.getFromEnv("focusScalesX");scalesY=chart.getFromEnv("focusScalesY");root=chart.config.focusTableMap}for(var i=0,ii=panels.length;i<ii;i++){var plots=panels[i].plots;var _loop3=function _loop3(j,jj){var plot=plots[j],x=xs[plot.x],y=ys[plot.y],binDecider=binDeciders[plot.x],threshold=binDecider.getRangeThreshold(),xDomain=binDecider.getBinDomain().map(Number),scaleX=scalesX[plot.x],scaleY=scalesY[plot.y];var node=root;if(!plot.plots)plot.plots=[];x.binDecider=binDecider;x.scale=scaleX;y.scale=scaleY;if(x.filter){if(!node.filter)node.filter={};node=node.filter;x.filterInfo.query=between(x.filter[0],xDomain[0]-threshold[2]*2,xDomain[1]+threshold[2]*2);if(!node["x__FC_OP_SEP__"+plot.x]){node["x__FC_OP_SEP__"+plot.x]={_fc_info:{filter:x.filter[0],filterInfo:x.filterInfo,start:xDomain[0],end:xDomain[1]}}}node=node["x__FC_OP_SEP__"+plot.x]}if(y.filter){if(!node)node.filter={};node=node.filter;if(!node["y__FC_OP_SEP__"+plot.y]){node["y__FC_OP_SEP__"+plot.y]={_fc_info:{filter:y.filter[0]}}}node=node["y__FC_OP_SEP__"+plot.y]}y.plot.forEach(function(eachPlot,index){var parent=node,uniqueItems=[];if(eachPlot.group){var group=eachPlot.group;if(!node.group)node.group={};node=node.group;if(!node[group]){node[group]={_fc_info:{}}}node[group]._fc_info.groupItems=uniqueItems=chart.config.dataTable.unique(group);node=node[group]}if(eachPlot.stack){var stack=eachPlot.stack;if(!node.pivot)node.pivot={};node=node.pivot;if(!node[stack]){node[stack]={_fc_info:{pivot:stack}}}node=node[stack]}if(x.bin){if(!node.bin)node.bin={};node=node.bin;if(!node["x__FC_OP_SEP__"+plot.x]){node["x__FC_OP_SEP__"+plot.x]={_fc_info:{chart:chart,bin:x.bin[0],binDecider:binDecider,totalStart:+timeYear.floor(new Date(chart.config.dataTable.min(x.bin[0])))}}}node=node["x__FC_OP_SEP__"+plot.x]}if(y.bin){if(!node.bin)node.bin={};node=node.bin;if(!node["y__FC_OP_SEP__"+plot.y]){node["y__FC_OP_SEP__"+plot.y]={_fc_info:{bin:y.bin[0]}}}node=node["y__FC_OP_SEP__"+plot.y]}if(!node.aggregate)node.aggregate={_fc_info:{}};if(eachPlot.type==="candlestick"||eachPlot.type==="ohlc"){var len=eachPlot.group?uniqueItems.length:1;for(var k=0;k<len;++k){var ohlcObj={plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator},uniqueItem=eachPlot.group?uniqueItems[k]:UNDEF;if(eachPlot.open){if(!node.aggregate._fc_info.first){node.aggregate._fc_info.first={}}var first=node.aggregate._fc_info.first;if(uniqueItem&&!first[uniqueItem]){first[uniqueItem]={}}if(uniqueItem){if(!first[uniqueItem][eachPlot.open]){first[uniqueItem][eachPlot.open]=[]}}else{if(!first[eachPlot.open]){first[eachPlot.open]=[]}}ohlcObj.open=uniqueItem?first[uniqueItem][eachPlot.open]:first[eachPlot.open]}if(eachPlot.high){if(!node.aggregate._fc_info.max){node.aggregate._fc_info.max={}}var max=node.aggregate._fc_info.max;if(uniqueItem&&!max[uniqueItem]){max[uniqueItem]={}}if(uniqueItem){if(!max[uniqueItem][eachPlot.high]){max[uniqueItem][eachPlot.high]=[]}}else{if(!max[eachPlot.high]){max[eachPlot.high]=[]}}ohlcObj.high=uniqueItem?max[uniqueItem][eachPlot.high]:max[eachPlot.high]}if(eachPlot.low){if(!node.aggregate._fc_info.min){node.aggregate._fc_info.min={}}var min=node.aggregate._fc_info.min;if(uniqueItem&&!min[uniqueItem]){min[uniqueItem]={}}if(uniqueItem){if(!min[uniqueItem][eachPlot.low]){min[uniqueItem][eachPlot.low]=[]}}else{if(!min[eachPlot.low]){min[eachPlot.low]=[]}}ohlcObj.low=uniqueItem?min[uniqueItem][eachPlot.low]:min[eachPlot.low]}if(eachPlot.close){if(!node.aggregate._fc_info.last){node.aggregate._fc_info.last={}}var last=node.aggregate._fc_info.last;if(uniqueItem&&!last[uniqueItem]){last[uniqueItem]={}}if(uniqueItem){if(!last[uniqueItem][eachPlot.close]){last[uniqueItem][eachPlot.close]=[]}}else{if(!last[eachPlot.close]){last[eachPlot.close]=[]}}ohlcObj.close=uniqueItem?last[uniqueItem][eachPlot.close]:last[eachPlot.close]}var info=node.aggregate._fc_info;ohlcObj.tableInfo=(uniqueItem?[info.first[uniqueItem],info.max[uniqueItem],info.min[uniqueItem],info.last[uniqueItem]]:[info.first,info.max,info.min,info.last]).filter(function(s){return!!s})[0];ohlcObj.value=eachPlot.value;ohlcObj.plotInAxisIndex=index;plot.plots.push(ohlcObj)}}else{if(!node.aggregate._fc_info[eachPlot.aggregation]){node.aggregate._fc_info[eachPlot.aggregation]={}}var aggregationObj=node.aggregate._fc_info[eachPlot.aggregation];if(eachPlot.group){for(var _k=0;_k<uniqueItems.length;++_k){var _uniqueItem=uniqueItems[_k];if(!aggregationObj[_uniqueItem]){aggregationObj[_uniqueItem]={}}if(!aggregationObj[_uniqueItem][eachPlot.value]){aggregationObj[_uniqueItem][eachPlot.value]=[]}plot.plots.push({plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator,tableInfo:aggregationObj[_uniqueItem],value:aggregationObj[_uniqueItem][eachPlot.value],stack:eachPlot.stack,plotInAxisIndex:index})}}else{if(!aggregationObj[eachPlot.value]){aggregationObj[eachPlot.value]=[]}plot.plots.push({plottype:eachPlot.type,typeinnavigator:eachPlot.typeinnavigator,tableInfo:aggregationObj,value:aggregationObj[eachPlot.value],stack:eachPlot.stack,plotInAxisIndex:index})}}node=parent})};for(var j=0,jj=plots.length;j<jj;j++){_loop3(j,jj)}}},getSmartLinearMin=function getSmartLinearMin(min,isBaseRequired){var reducedMin=min-Math.abs(min*.1);return reducedMin>0&&isBaseRequired?0:reducedMin},getSmartLogMin=function getSmartLogMin(min,isBaseRequired){var reducedMin=min*.9;return isBaseRequired?Math.min(reducedMin,1):reducedMin},getLogMinMax=function getLogMinMax(dataMin,dataMax,userMin,userMax,baseArg,isBaseRequired){var base=baseArg;if(!isValidNumber(base)||base===0)base=10;var logMin=dataMin>0&&isFinite(dataMin)?getSmartLogMin(dataMin,isBaseRequired):1,enforcedMin=isValidNumber(userMin)&&userMin>0&&userMin<dataMin?userMin:logMin,logMax=dataMax>0&&isFinite(dataMax)?dataMax:logMin+ +base,enforcedMax=isValidNumber(userMax)&&userMax>enforcedMin?userMax:logMax*1.2;return[enforcedMin,enforcedMax]},getLinearMinMax=function getLinearMinMax(dataMinArg,dataMaxArg,userMinArg,userMaxArg,isBaseRequired){var dataMax=dataMaxArg,dataMin=dataMinArg,userMin=userMinArg,userMax=userMaxArg,linearMax;!isFinite(dataMin)&&(dataMin=UNDEF);!isFinite(dataMax)&&(dataMax=UNDEF);!isFinite(userMin)&&(userMin=UNDEF);!isFinite(userMax)&&(userMax=UNDEF);var linearMin=userMin<dataMin?userMin:dataMin!==UNDEF?getSmartLinearMin(dataMin,isBaseRequired):0,isNegitive=linearMin<0&&(userMax<0||dataMax<0);if(userMax>dataMax){linearMax=userMax}else if(dataMax!==UNDEF){if(isNegitive&&isBaseRequired){linearMax=0}else{linearMax=dataMax+Math.abs(dataMax*.2)}}else{linearMax=linearMin+1}return[linearMin,linearMax]},parseStrokeDashArray=function parseStrokeDashArray(styleDef){for(var property in styleDef){if(styleDef.hasOwnProperty(property)){var isStrokeDashArray=property==="stroke-dasharray";if(typeof styleDef[property]==="object"){parseStrokeDashArray(styleDef[property])}else if(isStrokeDashArray&&isDashedString(styleDef[property])){styleDef[property]=styleDef[property].replace(/^\s+|\s+$/g,"").replace(/,/g," ").split(" ").map(function(c){return+c})}}}},parseOpacity=function parseOpacity(styleDef){for(var property in styleDef){if(styleDef.hasOwnProperty(property)){if(typeof styleDef[property]==="object"){parseOpacity(styleDef[property])}else if(property==="opacity"||property==="stroke-opacity"||property==="fill-opacity"){styleDef[property]=Math.max(0,Math.min(1,+styleDef[property]))}}}},disposeFn=function disposeFn(component){component.dispose&&component.dispose()},useFirstTables=function useFirstTables(obj,rootTable,useTable){if(useTable===void 0){useTable=stubFN}var keys=Object.keys(obj),len=keys.length,continueRecursion=true;for(var i=0;i<len&&continueRecursion;++i){var key=keys[i],el=obj[key];if(key==="_fc_info"||key==="table"){var table=key==="table"?el:el.table;if(table&&table!==rootTable){useTable(table);continueRecursion=false}}else if(key==="aggregate"){useFirstTables(el._fc_info,rootTable,useTable)}else if(isObject(el)){useFirstTables(el,rootTable,useTable)}}},actionsReducer=function actionsReducer(action,type,chart){switch(action){case"plot":chart.showWarning("02362480","param"," Timeseries"," Some plot configurations were ignored. Please provide valid values to the plot attribute within a "+type+"Axis configuration.");break;case"axis":chart.showWarning("08927060","param"," Timeseries","Some "+type+"Axis configurations were ignored. Please provide a valid value to the plot attribute within the "+type+"Axis configurations.");break;case"fullaxis":chart.showWarning("08963401","param"," Timeseries","All "+type+"Axis configurations were ignored. Please provide a valid value to the plot attribute within the "+type+"Axis configurations. Defaulting to showing all numeric columns in separate canvases.");break}},createStyleStr=function createStyleStr(styleObj){if(styleObj===void 0){styleObj={}}var key,styleStr=STYLE_STR_ONE;for(key in styleObj){styleStr+=key+": "+styleObj[key]+"; "}styleStr+=STYLE_STR_TWO;return styleStr},parsePrediction=function parsePrediction(dataSource,getStyleDef){var prediction={},styleKey={};if(dataSource.extensions&&isObject(dataSource.extensions.prediction)){prediction=dataSource.extensions.prediction;prediction.enabled=true}else{prediction={enabled:false}}if(isObject(prediction.style)){for(styleKey in prediction.style){if(prediction.style.hasOwnProperty(styleKey)){prediction.style[styleKey]=getStyleDef(prediction.style[styleKey])}}}else{prediction.style={}}return prediction};var TimeSeries=function(_CommonAPI){_inheritsLoose(TimeSeries,_CommonAPI);function TimeSeries(){var _this;_this=_CommonAPI.call(this)||this;var chart=_assertThisInitialized(_this);chart.addToEnv("getStyleDef",function(styleDefArg){if(styleDefArg===void 0){styleDefArg={}}var styleDef=styleDefArg,defaulTextStyle=chart.getFromEnv("textStyle"),mergedStyle;if(typeof styleDef==="string"){var styleDefinition=chart.getFromEnv("dataSource").styledefinition;mergedStyle={};styleDefinition&&styleDef.split(/\s+/g).forEach(function(style){return extend2(mergedStyle,styleDefinition[style])})}if(mergedStyle){styleDef=mergedStyle}parseStrokeDashArray(styleDef);parseOpacity(styleDef);(styleDef["font-size"]||styleDef["font-size"]===0)&&setLineHeight(styleDef,defaulTextStyle["font-size"]);return styleDef});chart.deregisterFactory("canvas");chart.registerFactory("background",backgroundFactory);chart.registerFactory("caption",CaptionFactory);chart.registerFactory("legend",legendFactory);chart.registerFactory("panel",panelFactory);chart.registerFactory("selectorToolbar",toolbarFactory,["timeNavigator","canvas"]);chart.registerFactory("timeNavigator",timeNavigatorFactory);chart.registerFactory("standardRangeSelector",standardRangeSelectorFactory,["selectorToolbar"]);chart.registerFactory("customRangeSelector",CustomRangeFactory,["selectorToolbar"]);chart.registerFactory("multicanvasCrosslineManager",CrosslineManager,["mouseTracker"]);chart.registerFactory("toolbarManager",toolbarManagerFactory,["standardRangeSelector","customRangeSelector"]);return _this}TimeSeries.getName=function getName(){return"timeseries"};var _proto=TimeSeries.prototype;_proto.getName=function getName(){return"timeseries"};_proto.__setDefaultConfig=function __setDefaultConfig(){var config=this.config;config.skipConfigureIteration={};config.canvasAxisMap={};config.scaleYDsMap={};config.palettecolors=["#5D62B5","#29C3BE","#F2726F","#FFC533","#62B58F","#BC95DF","#67CDF2"];config.defaultLegendTextStyle={"font-family":DEFAULT_FT_FONT,"font-weight":"normal","font-style":"normal","font-size":"12px",fill:"#5F5F5F","line-height":"14px",opacity:"1","fill-opacity":"1"};config.defaultTooltipStyle={"background-color":convertColor("#ffffff","90"),color:"#5f5f5f","border-color":"#e8e8e8","border-width":"1px","border-radius":"0px","line-height":1,"font-family":DEFAULT_FT_FONT,padding:"3px",opacity:.9};this.addToEnv("textStyle",{"font-family":"sans-serif","font-size":"10",fill:"#000000","line-height":"12"});config.contextPanels=UNDEF;config.contextLimit=config.focusLimit=UNDEF;config.legendMap={}};_proto.setTooltipStyle=function setTooltipStyle(){var tooltipStyle=this.getFromEnv("tooltipStyle"),baseTextStyle=this.getFromEnv("baseTextStyle"),toolTipController=this.getFromEnv("toolTipController");tooltipStyle.container=Object.assign({},this.config.defaultTooltipStyle,baseTextStyle,tooltipStyle.text,tooltipStyle.container);tooltipStyle.header=Object.assign({"font-size":pluck(tooltipStyle.container["font-size"],"12px"),"font-weight":pluck(tooltipStyle.container["font-weight"],"bold"),"font-family":tooltipStyle.container["font-family"],padding:"5px 5px 0",color:getLightColor("#5f5f5f",76)},tooltipStyle.header);tooltipStyle.body=Object.assign({"font-size":pluck(tooltipStyle.container["font-size"],"11px"),"font-weight":pluck(tooltipStyle.container["font-weight"],"normal"),"font-family":tooltipStyle.container["font-family"],padding:"0 5px 5px"},tooltipStyle.body);toolTipController.setStyle(tooltipStyle.container);toolTipController.setRestrictionWithinCanvas({bottom:true});tooltipStyle.headerStyleString=createStyleStr(tooltipStyle.header);tooltipStyle.bodyStyleString=createStyleStr(tooltipStyle.body)};_proto.sanitizeData=function sanitizeData(attrs){var _this2=this;_CommonAPI.prototype.sanitizeData.call(this,attrs);var _expanderAxis=expanderAxis(columnsFilter(attrs.data,isTemporalScheme),attrs.xaxis,false),xAxis=_expanderAxis.expandedAxis,xActions=_expanderAxis.actions,_expanderAxis2=expanderAxis(columnsFilter(attrs.data,isNumericScheme),attrs.yaxis),yAxis=_expanderAxis2.expandedAxis,yActions=_expanderAxis2.actions;attrs.xaxis=xAxis;attrs.yaxis=yAxis;xActions.forEach(function(action){return actionsReducer(action,"x",_this2)});yActions.forEach(function(action){return actionsReducer(action,"y",_this2)})};_proto.getDSdef=function getDSdef(){return Line};_proto._updateVisuals=function _updateVisuals(){_CommonAPI.prototype._updateVisuals.call(this);this.getFromEnv("paper").config.noDefaultAttribs=true};_proto.domainValidator=function domainValidator(currentDomain,totalDomain,prevDomain){if(prevDomain===void 0){prevDomain=[]}var chart=this,mode,rangeThreshold=chart.getFromEnv("contextBins")[0].getBinMin(),currentDomainStartValue=currentDomain[0],currentDomainEndValue=currentDomain[1],totalDomainStartValue=totalDomain[0],validatedDomainDiff,totalDomainEndValue=totalDomain[1],currentDomainStartValuems=+currentDomain[0],currentDomainEndValuems=+currentDomain[1],totalDomainStartValuems=+totalDomain[0],totalDomainEndValuems=+totalDomain[1];if(prevDomain.length){mode=Math.abs(currentDomainEndValuems-currentDomainStartValuems-(+prevDomain[1]-+prevDomain[0]))>1?"squeeze":"drag"}if(currentDomainStartValuems<totalDomainStartValuems){currentDomainStartValue=totalDomainStartValue;currentDomainEndValue=mode==="drag"?new Date(currentDomainEndValuems+(totalDomainStartValuems-currentDomainStartValuems)):currentDomainEndValue}if(currentDomainEndValuems>totalDomainEndValuems){currentDomainEndValue=totalDomainEndValue;currentDomainStartValue=mode==="drag"?new Date(currentDomainStartValuems-(currentDomainEndValuems-totalDomainEndValuems)):currentDomainStartValue}if(currentDomainEndValuems<totalDomainStartValuems){currentDomainEndValue=totalDomainStartValue}if(currentDomainStartValuems>totalDomainEndValuems){currentDomainStartValue=totalDomainEndValue}if(currentDomainStartValuems>currentDomainEndValuems){var _ref=[currentDomainEndValue,currentDomainStartValue];currentDomainStartValue=_ref[0];currentDomainEndValue=_ref[1]}validatedDomainDiff=currentDomainEndValue-currentDomainStartValue;if(validatedDomainDiff>=3*rangeThreshold[2]){chart.fireEvent("domainValidated");return[+currentDomainStartValue,+currentDomainEndValue]}return chart.getFocusLimit()||chart.getContextLimit()};_proto.configureAttributes=function configureAttributes(attrs){var chart=this,config=chart.config,colorManager=new ColorManager(chart),ordinalScale=new OrdinalScale,chartAttrs=attrs.chart,colors=parsePaletteColor(chartAttrs.palettecolors),getStyleDef=chart.getFromEnv("getStyleDef"),legendConf=attrs.legend,chartStyle=chartAttrs.style||{},baseTextStyle=getStyleDef(chartStyle.text),legendMap=config.legendMap,uniqueItems={},prevLegendMap=chart.getFromEnv("legendMap"),dataSource=chart.getFromEnv("dataSource"),defaultTextStyle=extend2(chart.getFromEnv("textStyle"),baseTextStyle),tooltipConfig=isObject(attrs.tooltip)?attrs.tooltip:{},tooltipStyle=isObject(tooltipConfig.style)?tooltipConfig.style:{},legend=chart.getChildren("legend")&&chart.getChildren("legend")[0];var legendStyle=getStyleDef(legendConf&&legendConf.item&&legendConf.item.style&&legendConf.item.style.text),interimXExpand=[];this.addToEnv("baseTextStyle",Object.assign({"font-family":DEFAULT_FT_FONT},baseTextStyle));legendStyle=Object.assign({},this.getFromEnv("baseTextStyle"),legendStyle);config.mergedLegendStyle=extend2(extend2({},config.defaultLegendTextStyle),legendStyle);if(config.focusTableMap){useFirstTables(config.focusTableMap,config.focusTableMap._fc_info.table,disposeFn)}if(config.contextTableMap){useFirstTables(config.contextTableMap,config.contextTableMap._fc_info.table,disposeFn);config.contextTableMap=UNDEF}this.addToEnv("chart-attrib",chartAttrs);colorManager.configure();this.addToEnv("color-manager",colorManager);if(colors.length){config.palettecolors=colors}ordinalScale.setRange(config.palettecolors);this.addToEnv("ordinalScale",ordinalScale);config.dataTable=attrs.data;config.showLegend=pluckNumber(chartAttrs.showlegend,1);config.navigatorEnabled=pluckNumber(dataSource.navigator&&dataSource.navigator.enabled,chartAttrs.enablenavigator,1);config.showTooltip=pluckNumber(tooltipConfig.enabled,chartAttrs.showtooltip,1);config.interCanvasSpace=pluckNumber(chartAttrs.intercanvasspace,DEFAULT_CANVAS_DISTANCE);config.multiCanvas=pluckNumber(chartAttrs.multicanvas,1);this.addToEnv("UTC",pluck(chartAttrs.enableutc,false));this.addToEnv("dateAPI",function(date,param,utc){return date["get"+(utc?"UTC":"")+param]()});interimXExpand=attrs.xaxis.slice(0,1).map(function(ob){return Object.assign({},ob,{bin:ob.plot.map(function(n){return n.value})})});config.focusAxesX=interimXExpand.map(function(ob){return Object.assign({},ob,{filter:ob.plot.map(function(n){return n.value}),filterInfo:{}})});config.focusAxesY=expanderSeries(columnsFilter(config.dataTable,isStringyScheme),attrs.yaxis,attrs.series,attrs.stack,attrs.group);config.focusPanels=permuteIndices(expanderPanel(config.focusAxesX,config.focusAxesY,attrs.canvas,config.multiCanvas?defaultPanelsMulticanvas:defaultPanelsSingleCanvas));config.pixelMultiplier=1;config.focusAxesY.forEach(function(_ref2){var plot=_ref2.plot;var count=0,colItemsArr;plot.forEach(function(_ref3){var stack=_ref3.stack,group=_ref3.group,value=_ref3.value,type=_ref3.type;var isColumn=type==="column";if(isColumn){colItemsArr=group?config.dataTable.unique(group):new Array(1);count+=colItemsArr.length}if(stack){if(uniqueItems[stack])return;uniqueItems[stack]=config.dataTable.unique(stack)}else if(group){if(uniqueItems[group])return;uniqueItems[group]=isColumn?colItemsArr:config.dataTable.unique(group)}else if(type!=="ohlc"&&type!=="candlestick"){if(uniqueItems[value])return;uniqueItems[value]=[value]}});config.pixelMultiplier=Math.max(count,config.pixelMultiplier)});for(var key in uniqueItems){var uniqueArr=uniqueItems[key];uniqueArr.forEach(function(name){if(!legendMap[name]){legendMap[name]={visibility:true,series:name}}})}chart.addToEnv("legendMap",legendMap);if(prevLegendMap){var newLegendMap=legendMap,reuseLegend=function reuseLegend(oldObj,newObj){for(var _key in oldObj){if(oldObj.hasOwnProperty(_key)){var newItem=newObj&&newObj[_key],oldItem=oldObj[_key];if(oldItem.hasOwnProperty("visibility")){if(newItem){if(!oldItem.visibility){legend.getItem(oldItem.legendItemId).removeLegendState("hidden");oldItem.visibility=true}newObj[_key]=oldItem}else{legend&&legend.disposeItem(oldItem.legendItemId)}}else{reuseLegend(oldItem,newItem)}}}};reuseLegend(prevLegendMap,newLegendMap)}config.contextAxesX=clone(interimXExpand);config.contextAxesY=clone(config.focusAxesY);xFactory(this);yFactory(this);config.focusTableMap={_fc_info:{table:config.dataTable}};mapper(chart);if(config.navigatorEnabled){config.contextPanels=permuteIndices(expanderPanel(config.contextAxesX,config.contextAxesY,[],function(xs,ys){return xs.map(function(cx,ix){return{x:[{index:ix}],y:ys.map(function(cy,iy){return{index:iy,visible:false}})}})}));config.contextTableMap={_fc_info:{table:config.dataTable}};mapper(chart,true)}tableCreator(config.focusTableMap);tableCreator(config.contextTableMap);config.printOption={enabled:pluckNumber(chartAttrs.printshowbutton,chartAttrs.showprintmenuitem,0)};config.toolbarPosition=toolbarPositionParser(pluck(chartAttrs.toolbarposition,"tr").toLowerCase());config.toolbarHAlign=(""+chartAttrs.toolbarhalign).toLowerCase()==="left"?"l":config.toolbarPosition.charAt(1);config.toolbarVAlign=(""+chartAttrs.toolbarvalign).toLowerCase()==="bottom"?"b":config.toolbarPosition.charAt(0);config.link=chartAttrs.clickurl;this.addToEnv("linkClickFN",getLinkAction(this.getFromEnv("dataSource"),this));this.addToEnv("chartConfig",config);chart.addToEnv("tooltipStyle",{container:getStyleDef(tooltipStyle.container),text:getStyleDef(tooltipStyle.text),header:getStyleDef(tooltipStyle.header),body:getStyleDef(tooltipStyle.body)});this.addToEnv("style",{outCancolor:defaultTextStyle.fill,fontSize:defaultTextStyle["font-size"],outCanfontFamily:defaultTextStyle["font-family"]});this.createBaseComponent();this.getFromEnv("animationManager").setAnimationState(this._firstConfigure?"initial":"update");config.prediction=parsePrediction(dataSource,getStyleDef);this.addToEnv("prediction",config.prediction);this._createToolBox();this.configureChildren();this.setTooltipStyle()};_proto._addLegend=function _addLegend(info){var chart=this,fillColor,config,legendItem,chartConfig=chart.config,mergedLegendStyle=chartConfig.mergedLegendStyle,series=info.series,color=chart.getFromEnv("ordinalScale").getRangeValue(series),legend=chart.getFromEnv("legend"),strokeColor=getLightColor(color,60).replace(dropHash,HASHSTRING);if(chartConfig.showLegend){fillColor={FCcolor:{color:color,angle:0,ratio:"0",alpha:"100"}};legendItem=legend.getItem(info.legendItemId);config={label:series};if(!legendItem){info.legendItemId=legend.createItem();legendItem=legend.getItem(info.legendItemId);chart.addExtEventListener("fc-click",function(){var visibility=info.visibility,flushFn=function flushFn(table){return table._flushResult&&table._flushResult({legendInteracted:true})};if(visibility){info.visibility=false;legendItem.setLegendState("hidden")}else{info.visibility=true;legendItem.removeLegendState("hidden")}if(chartConfig.focusTableMap){useFirstTables(chartConfig.focusTableMap,chartConfig.focusTableMap._fc_info.table,flushFn)}if(chartConfig.contextTableMap){useFirstTables(chartConfig.contextTableMap,chartConfig.contextTableMap._fc_info.table,flushFn)}},legendItem)}legendItem.configure(config);legendItem.setStateCosmetics("default",{symbol:{fill:toRaphaelColor(fillColor),rawFillColor:color,stroke:toRaphaelColor(strokeColor)},text:Object.assign({},mergedLegendStyle,{fill:convertColor(mergedLegendStyle.fill,mergedLegendStyle.opacity*mergedLegendStyle["fill-opacity"]*100)})})}};_proto._createGroup=function _createGroup(attr,container){if(attr===void 0){attr={}}var animationManager=this.getFromEnv("animationManager");return animationManager.setAnimation({attr:attr,container:container,el:"group",component:this,label:"group"})};_proto._createLayers=function _createLayers(){var animationManager=this.getFromEnv("animationManager");var parentGroup=this.getContainer("parentgroup"),exo;!parentGroup&&(parentGroup=this.addContainer("parentgroup",animationManager.setAnimation({el:parentGroup||"group",attr:{name:"parentgroup"},component:this})));if(!this.getChildContainer("tropo")){this.addChildContainer("tropo",this._createGroup({name:"chart-tropo"},parentGroup))}if(!this.getChildContainer("strato")){this.addChildContainer("strato",this._createGroup({name:"chart-strato"},parentGroup))}if(!this.getChildContainer("meso")){this.addChildContainer("meso",this._createGroup({name:"chart-meso"},parentGroup))}if(!this.getChildContainer("thermo")){this.addChildContainer("thermo",this._createGroup({name:"chart-thermo"},parentGroup))}if(!this.getChildContainer("exo")){exo=this.addChildContainer("exo",this._createGroup({name:"chart-exo"},parentGroup))}if(!this.getChildContainer("toolbar-master")){this.addChildContainer("toolbar-master",this._createGroup({name:"toolbar-master"},exo))}if(!this.getChildContainer("legendGroup")){this.addChildContainer("legendGroup",this._createGroup({name:"legend-group"},exo))}};_proto.manageSpace=function manageSpace(){var chart=this,chartConfig=chart.config,focusPanels=chartConfig.focusPanels,canvasAxisMap=chartConfig.canvasAxisMap,yScales=chart.getFromEnv("focusScalesY"),xScales=chart.getFromEnv("focusScalesX"),caption=chart.getChildren("caption"),selectorToolBar=chart.getFromEnv("selectorToolbar"),menubar=chart.getFromEnv("toolbar"),menuSpace=menubar.getLogicalSpace(),legend=chart.getChildren("legend")&&chart.getChildren("legend")[0],background=chart.getChildren("background")[0],firstCanvas=chart.getChildren("canvas_0"),verticalPadding=0,horizontalPadding=0,timeNavigators=chart.getChildren("timeNavigator"),totalWidth,totalHeight,availableHeight,timeNavScrollbarAndLabelHeight,totalTimeNavHeight=0,availableWidth,canvasHeight,intermediateCanvasHeight,maxVAxisWidth={left:0,right:0},left=0,top=0,right=totalWidth=+chart.getFromEnv("chartWidth"),bottom=totalHeight=+chart.getFromEnv("chartHeight"),captionDim,leftAxesMaxWidth=0,rightAxesMaxWidth=0,marginHorizontal=.03*totalWidth,marginVertical=.03*totalHeight,axisHeight=0,heightTaken,yAxesDimensions,xAxesDimensions,intermediateTimeNavSelectionHeight,actualTimeNavSelectionHeight,timeNavHeight,brush,legendHeight,toolHeight,capHeight,interCanvasSpace=chartConfig.interCanvasSpace;top+=pluckNumber(chartConfig.marginTop,marginVertical);bottom-=pluckNumber(chartConfig.marginBottom,marginVertical);left+=pluckNumber(chartConfig.marginLeft,marginHorizontal);right-=pluckNumber(chartConfig.marginRight,marginHorizontal);background.setDimension({height:totalHeight,width:totalWidth});background.setTranslation(0,0);focusPanels.forEach(function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],yIds=canvasInfo.y,yAxisWidth=DEFAULT_AXIS_HEIGHT_RATIO*(right-left)/(yIds.length||1),setYAxisDim=function setYAxisDim(axisId){var index=getIndex(axisId),dim=chart.getChildren(axisId)[0].setDimension({width:yAxisWidth});return panelInfo.y[index].overlap?{}:dim};yAxesDimensions=yIds.map(setYAxisDim);yAxesDimensions.forEach(function(dim){if(typeof dim.left==="number"){maxVAxisWidth.left=Math.max(maxVAxisWidth.left,dim.left)}else{maxVAxisWidth.right=Math.max(maxVAxisWidth.right,dim.right)}})});focusPanels.forEach(function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],yIds=canvasInfo.y,axesLeftWidth=0,axesRightWidth=0,axis,dim,align;yIds.forEach(function(axisId){axis=chart.getChildren(axisId)[0];align=axis.getAlignment();dim=axis.updateMaxLabelSpace(maxVAxisWidth[align]);axesLeftWidth+=pluckNumber(dim.left,0);axesRightWidth+=pluckNumber(dim.right,0)});leftAxesMaxWidth=safeMax([leftAxesMaxWidth,axesLeftWidth]);rightAxesMaxWidth=safeMax([rightAxesMaxWidth,axesRightWidth])});focusPanels.forEach(function(panelInfo,i){var canvasInfo=canvasAxisMap["canvas_"+i],xIds=canvasInfo.x,xAxisHeight=DEFAULT_AXIS_HEIGHT_RATIO*(bottom-top)/(xIds.length||1),setXAxisDim=function setXAxisDim(axisId){var index=getIndex(axisId),dim=chart.getChildren(axisId)[0].setDimension({height:xAxisHeight});return panelInfo.x[index].overlap?{}:dim};xAxesDimensions=xIds.map(setXAxisDim);xAxesDimensions.forEach(function(dim){axisHeight+=pluckNumber(dim.top,dim.bottom,0)})});left+=leftAxesMaxWidth;right-=rightAxesMaxWidth;availableHeight=bottom-top;if(caption&&caption.length){captionDim=caption[0].setDimension({width:right-left-menuSpace.width,height:DEFAULT_CAPTION_HEIGHT_RATIO*availableHeight});caption[0].setTranslation(left,top);capHeight=Math.max(captionDim.height,menuSpace.height)}else{capHeight=menuSpace.height}if(menuSpace.height){menubar.setDimension({x:right-menuSpace.width,y:top});menubar.manageSpace()}top+=capHeight;availableWidth=Math.max(0,right-left);toolHeight=selectorToolBar.getLogicalSpace().height;selectorToolBar.setDimension({x:left,y:top,width:availableWidth});selectorToolBar.manageSpace();top+=toolHeight;heightTaken=axisHeight+(focusPanels.length-1)*interCanvasSpace;availableHeight=Math.max(0,bottom-top-heightTaken);if(legend){legendHeight=Math.max(0,legend.setDimension({height:availableHeight*DEFAULT_LEGEND_RATIO,width:availableWidth}).height);bottom-=legendHeight;availableHeight-=legendHeight;legend.setTranslation(left,bottom)}if(timeNavigators&&timeNavigators.length){intermediateCanvasHeight=(1-DEFAULT_TIMENAV_HEIGHT_RATIO)*availableHeight/(focusPanels.length||1);intermediateTimeNavSelectionHeight=DEFAULT_TIMENAV_HEIGHT_RATIO*availableHeight/(timeNavigators.length||1);timeNavigators.forEach(function(timeNavigator,index){brush=timeNavigator.getChildren("brush")[0];timeNavScrollbarAndLabelHeight=brush.getLabelSpace()+timeNavigator.config.scrollbarHeight;actualTimeNavSelectionHeight=Math.min(Math.max(Math.min(intermediateTimeNavSelectionHeight,.8*intermediateCanvasHeight),48),60);timeNavHeight=actualTimeNavSelectionHeight+timeNavScrollbarAndLabelHeight;timeNavigator.setDimension({width:availableWidth,height:timeNavHeight});timeNavigator.setTranslation(left,bottom-(timeNavigators.length-index)*timeNavHeight);totalTimeNavHeight+=timeNavHeight});if(totalTimeNavHeight>availableHeight){timeNavigators.forEach(function(nav){return nav.setDimension({width:0,height:0})})}else{availableHeight-=totalTimeNavHeight}}canvasHeight=Math.max(0,availableHeight/(focusPanels.length||1));if(firstCanvas&&firstCanvas[0]){var canvasPadding=firstCanvas[0].getCanvasBorder();verticalPadding=canvasPadding.topBorder+canvasPadding.bottomBorder;horizontalPadding=canvasPadding.leftBorder+canvasPadding.rightBorder}yScales.forEach(function(scale){return scale.setRange([canvasHeight-verticalPadding-CANVAS_TOP_PADDING,0])});xScales.forEach(function(scale){return scale.setRange([0,availableWidth-horizontalPadding])});focusPanels.forEach(function(panelConfig,index){var canvasId="canvas_"+index,_canvasAxisMap$canvas=canvasAxisMap[canvasId],xIds=_canvasAxisMap$canvas.x,yIds=_canvasAxisMap$canvas.y,x=panelConfig.x,y=panelConfig.y,tempLeft=left,tempRight=left+availableWidth,canvas=chart.getChildren(canvasId)[0],canvasPadding=canvas.getCanvasBorder(),tempTop=top+canvasPadding.topBorder,tempBottom=tempTop+canvasHeight,overlappedXAxis=[];canvas.setPadding({top:CANVAS_TOP_PADDING});canvas.setDimension({width:availableWidth,height:canvasHeight});xIds.forEach(function(id){var axisInfo=x[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.overlap){overlappedXAxis.push(id);return}if(axisInfo.align==="top"){axis.setTranslation(left+canvasPadding.leftBorder,tempTop);tempTop+=dim.top}else if(axisInfo.align==="bottom"){axis.setTranslation(left+canvasPadding.leftBorder,tempBottom);tempBottom+=dim.bottom}});canvas.setTranslation(left,tempTop);overlappedXAxis.forEach(function(id){var axisInfo=x[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.align==="top"){axis.setTranslation(left+canvasPadding.leftBorder,tempTop)}else if(axisInfo.align==="bottom"){axis.setTranslation(left+canvasPadding.leftBorder,tempTop+canvasHeight-dim.bottom)}});yIds.forEach(function(id){var axisTop=tempTop+CANVAS_TOP_PADDING;var axisInfo=y[getIndex(id)],axis=chart.getChildren(id)[0],dim=axis.getDimension();if(axisInfo.overlap){if(axisInfo.align==="left"){axis.setTranslation(left,axisTop)}else if(axisInfo.align==="right"){axis.setTranslation(left+availableWidth-dim.right,axisTop)}}else{if(axisInfo.align==="left"){tempLeft-=dim.left;axis.setTranslation(tempLeft,axisTop)}else if(axisInfo.align==="right"){axis.setTranslation(tempRight,axisTop);tempRight+=dim.right}}});top=tempBottom+interCanvasSpace})};_proto._setDataLabelStyle=function _setDataLabelStyle(){return this};_proto._checkInvalidData=function _checkInvalidData(){var dataObj=this.getFromEnv("dataSource"),chartInstance=this.getFromEnv("chartInstance");if(!dataObj.data){chartInstance.__state.dataReady=false;chartInstance.jsVars.hasNativeMessage=true;chartInstance.jsVars.drawCount+=1;return true}return false};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){var dataObj=this.getFromEnv("dataSource");if(dataObj.data&&typeof dataObj.data.getData==="function"){var _dataObj$data$getData=dataObj.data.getData(),data=_dataObj$data$getData.data,schema=_dataObj$data$getData.schema;if(!Array.isArray(data)||data.length===0||!Array.isArray(schema)||!schema.filter(function(obj){return obj.type==="date"}).length||!schema.filter(function(obj){return obj.type==="number"}).length)return true;return false}return true};_proto.setYScaleLimit=function setYScaleLimit(scaleId,dsId,limit,baseRequired){if(baseRequired===void 0){baseRequired=true}var chart=this,config=chart.config,scaleYDsMap=config.scaleYDsMap,scaleMap=scaleYDsMap[scaleId],dsInfo,dataMin,dataMax,isBaseRequired,findFn=function findFn(_ref4){var scale=_ref4.scale;return scale&&scale.getId()===scaleId},focusY=config.focusAxesY.find(findFn),contextY=config.contextAxesY.find(findFn),y=focusY||contextY,scale=y&&y.scale;if(!scale)return;if(!scaleMap){scaleMap=scaleYDsMap[scaleId]={}}if(!(dsInfo=scaleMap[dsId])){dsInfo=scaleMap[dsId]={}}dsInfo.limit=limit;dsInfo.baseRequired=baseRequired;for(var key in scaleMap){if(scaleMap.hasOwnProperty(key)){var dsInf=scaleMap[key];var _extent=extent([dataMin,dataMax].concat(dsInf.limit));dataMin=_extent[0];dataMax=_extent[1];isBaseRequired=isBaseRequired||dsInf.baseRequired}}if(scale.getType()==="log"){scale.setDomain(getLogMinMax(dataMin,dataMax,y.min,y.max,y.base,isBaseRequired))}else{scale.setDomain(getLinearMinMax(dataMin,dataMax,y.min,y.max,isBaseRequired))}chart.config.focusPanels.forEach(function(panelInfo,i){var canvasId="canvas_"+i,canvases=chart.getChildren(canvasId),canvas=canvases&&canvases[0],yInf=chart.config.canvasAxisMap[canvasId],yIds=yInf&&yInf.y;if(!yIds||!canvas)return;canvas.asyncDraw();yIds.forEach(function(id){var axes=chart.getChildren(id);axes.forEach(function(axis){if(axis.getScale()===scale){axis.placeAxis();axis.asyncDraw()}})})})};_proto.setXScaleLimit=function setXScaleLimit(scaleId,dsId,limit){var chart=this,config=chart.config,scaleYDsMap=config.scaleYDsMap,scaleMap=scaleYDsMap[scaleId],dsInfo,dataMin,dataMax,min,max,_chart$getContextLimi=chart.getContextLimit(),tMin=_chart$getContextLimi[0],tMax=_chart$getContextLimi[1],findFn=function findFn(_ref5){var scale=_ref5.scale;return scale&&scale.getId()===scaleId},focusX=config.focusAxesX.find(findFn),contextX=config.contextAxesX.find(findFn),x=focusX||contextX,scale=x&&x.scale;if(!scale)return;if(!scaleMap){scaleMap=scaleYDsMap[scaleId]={}}if(!(dsInfo=scaleMap[dsId])){dsInfo=scaleMap[dsId]={}}dsInfo.limit=limit;for(var key in scaleMap){if(scaleMap.hasOwnProperty(key)){var dsInf=scaleMap[key];var _extent2=extent([dataMin,dataMax].concat(dsInf.limit));dataMin=_extent2[0];dataMax=_extent2[1]}}if(focusX){var _chart$getFocusLimit=chart.getFocusLimit();min=_chart$getFocusLimit[0];max=_chart$getFocusLimit[1];if(+min===tMin&&isValidNumber(dataMin)){min=Math.min(min,dataMin)}if(+max===tMax&&isValidNumber(dataMax)){max=Math.max(max,dataMax)}scale.setDomain([min,max])}else{min=isValidNumber(dataMin)?Math.min(tMin,dataMin):tMin;max=isValidNumber(dataMax)?Math.max(tMax,dataMax):tMax;scale.setDomain([min,max])}chart.config.focusPanels.forEach(function(panelInfo,i){var canvasId="canvas_"+i,canvases=chart.getChildren(canvasId),canvas=canvases&&canvases[0],xInf=chart.config.canvasAxisMap[canvasId],xIds=xInf&&xInf.x;if(!xIds||!canvas)return;canvas.asyncDraw();xIds.forEach(function(id){var axes=chart.getChildren(id);axes.forEach(function(axis){if(axis.getScale()===scale){axis.placeAxis();axis.asyncDraw()}})})})};_proto.setFocusLimit=function setFocusLimit(limit){if(limit===void 0){limit=[]}var chart=this,config=chart.config,dataLimit=this.domainValidator(limit,this.getContextLimit(),config.focusLimit),focusAxis=config.focusAxesX[0],focusBin=this.getFromEnv("focusBins")[0],focusScale=this.getFromEnv("focusScalesX")[0],focusLimit=chart.getFocusLimit();config.focusLimit=dataLimit;focusBin.setBinDomain(dataLimit);var threshold=focusBin.getRangeThreshold();focusScale.setRangeThreshold(threshold);this.fireEvent("focusLimitChanged");if(equals(dataLimit,focusLimit)){return}if(focusAxis.filterInfo&&focusAxis.filterInfo.query){focusAxis.filterInfo.query._updateArgs(+dataLimit[0]-+threshold[2]*2,+dataLimit[1]+ +threshold[2]*2);focusAxis.filterInfo.table._flushResult();chart.updateVerticalAxesWidth()}};_proto.updateVerticalAxesWidth=function updateVerticalAxesWidth(){var chart=this,canvasAxisMap=chart.config.canvasAxisMap,canvasAxisMapAr=Object.keys(canvasAxisMap),canvas,maxVAxesWidth={left:0,right:0},axisDim,axes;canvasAxisMapAr.forEach(function(canvasId){canvas=canvasAxisMap[canvasId];canvas.y.forEach(function(yId){axes=chart.getChildren(yId);axes.forEach(function(axis){axisDim=axis.getDimension();if(typeof axisDim.left==="number"){maxVAxesWidth.left=Math.max(maxVAxesWidth.left,axisDim.left)}else{maxVAxesWidth.right=Math.max(maxVAxesWidth.right,axisDim.right)}})})});canvasAxisMapAr.forEach(function(canvasId){canvas=canvasAxisMap[canvasId];canvas.y.forEach(function(yId){axes=chart.getChildren(yId);axes.forEach(function(axis){axis.updateMaxLabelSpace(maxVAxesWidth[axis.getAlignment()])})})})};_proto.getFocusLimit=function getFocusLimit(){var focusLimit=this.config.focusLimit;return focusLimit&&focusLimit.slice()};_proto.setContextLimit=function setContextLimit(limit){if(limit===void 0){limit=[]}var contextBins=this.getFromEnv("contextBins");this.config.contextLimit=limit.slice();contextBins[0].setBinDomain(limit);this.getFromEnv("contextScalesX")[0].setRangeThreshold(contextBins[0].getRangeThreshold())};_proto.getContextLimit=function getContextLimit(){return this.config.contextLimit.slice()};return TimeSeries}(CommonAPI);export default TimeSeries;