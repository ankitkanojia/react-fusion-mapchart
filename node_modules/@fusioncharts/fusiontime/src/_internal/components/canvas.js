import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import SmartRenderer from"@fusioncharts/core/src/component-interface/smart-renderer";import{convertColor}from"@fusioncharts/core/src/lib/lib-graphics";import{pluckNumber,pluck}from"@fusioncharts/core/src/lib";import timeMarkerFactory from"../factories/time-marker-factory";import refLineFactory from"../factories/reference-line-factory";import refZoneFactory from"../factories/reference-zone-factory";import gridLineFactory from"../factories/grid-line-factory";import mouseTracker from"../factories/mouse-tracker-factory";import MouseActionFactory from"../factories/tooltip-and-hover-factory";import wheelFactory from"../factories/interactions/wheel-factory";import dbTapFactory from"../factories/interactions/db-tap-factory";import swipeFactory from"../factories/interactions/swipe-factory";import pinchZoomFactory from"../factories/interactions/pinch-zoom-factory";import datasetFactory from"../factories/dataset-factory";import verticalCrosslineFactory from"../factories/vertical-crossline-factory";import horizontalCrosslineFactory from"../factories/horizontal-crossline-factory";var M="M",H="H",V="V",HORIZONTAL="horizontal",DEFAULT_BORDER_WIDTH=2;var Canvas=function(_SmartRenderer){_inheritsLoose(Canvas,_SmartRenderer);function Canvas(){var _this;_this=_SmartRenderer.call(this)||this;_this.registerFactory("dataset",datasetFactory);_this.registerFactory("gridLine",gridLineFactory);_this.registerFactory("timeMarker",timeMarkerFactory);_this.registerFactory("referenceLine",refLineFactory);_this.registerFactory("referenceZone",refZoneFactory);_this.registerFactory("mouseTracker",mouseTracker);_this.registerFactory("tooltip",MouseActionFactory,["mouseTracker"]);_this.registerFactory("wheel",wheelFactory);_this.registerFactory("dbTap",dbTapFactory);_this.registerFactory("swipe",swipeFactory);_this.registerFactory("pinchZoom",pinchZoomFactory);_this.registerFactory("verticalCrossline",verticalCrosslineFactory,["dataset"]);_this.registerFactory("horizontalCrossline",horizontalCrosslineFactory,["dataset"]);return _this}var _proto=Canvas.prototype;_proto.__setDefaultConfig=function __setDefaultConfig(){_SmartRenderer.prototype.__setDefaultConfig.call(this);this.config.padding={left:0,right:0,top:0,bottom:0};this.config.multiSeriesDatasetMap={}};_proto.getName=function getName(){return"canvas"};_proto.highlightDataPoints=function highlightDataPoints(hovered,yAxisAlign,refZoneRange){var canvas=this,allDataSets=canvas.getChildren("dataset"),highlightIndices,mouseTrackerComp=canvas.getChildren("mouseTracker")[0],filteredDatasets=allDataSets.filter(function(dataset){return dataset.config.yAxisAlign===yAxisAlign});filteredDatasets.forEach(function(dataset){highlightIndices=dataset.getHighlightedIndices(refZoneRange);if(highlightIndices.length){if(hovered){mouseTrackerComp.deactivate();dataset.setHoverInEffect(highlightIndices)}else{mouseTrackerComp.activate();dataset.setHoverOutEffect(highlightIndices)}}})};_proto.getType=function getType(){return"canvas"};_proto.configureAttributes=function configureAttributes(overrideConfig){var canvas=this,config=canvas.config,dataSource=canvas.getFromEnv("dataSource"),styles=dataSource.chart&&dataSource.chart.style||{},applicableStyle={},getStyleDef=canvas.getFromEnv("getStyleDef"),borderConfig=config.borderConfig||(config.borderConfig={});if(overrideConfig.xConfigs)canvas.config.xConfigs=overrideConfig.xConfigs;if(overrideConfig.yConfigs)canvas.config.yConfigs=overrideConfig.yConfigs;if(overrideConfig.plotConfigs)canvas.config.plotConfigs=overrideConfig.plotConfigs;if(overrideConfig.tableMap)canvas.config.tableMap=overrideConfig.tableMap;if(overrideConfig.enableGridLines)canvas.config.enableGridLines=overrideConfig.enableGridLines;if(overrideConfig.isContext)canvas.config.isContext=overrideConfig.isContext;if(overrideConfig.dataTable)canvas.config.dataTable=overrideConfig.dataTable;applicableStyle=getStyleDef(styles.canvas);["leftBorder","topBorder","rightBorder","bottomBorder"].forEach(function(border){borderConfig[border]=overrideConfig[border]?pluckNumber(applicableStyle["stroke-width"],DEFAULT_BORDER_WIDTH):borderConfig[border]||0});config.canvasBorderColor=convertColor(pluck(applicableStyle.stroke,"D6D6D6"),pluckNumber(applicableStyle["stroke-opacity"]*100,100));config.canvasBGColor=convertColor(pluck(applicableStyle.fill,"ffffff"),pluckNumber(applicableStyle["fill-opacity"]*100,100));config.opacity=applicableStyle.opacity;config.enableMouseTracking=pluckNumber(overrideConfig.enableMouseTracking,1);config.enableMarkers=pluckNumber(overrideConfig.enableMarkers,1);config.enableTimeMarkers=pluckNumber(overrideConfig.enableTimeMarkers,1);config.enableReferenceLine=pluckNumber(overrideConfig.enableReferenceLine,1);config.enableReferenceZone=pluckNumber(overrideConfig.enableReferenceZone,1);config.enableInteraction=pluckNumber(overrideConfig.enableInteraction,0);config.includeLegend=pluckNumber(overrideConfig.includeLegend,1);config.gridLineDirection=pluck(overrideConfig.gridLineDirection,HORIZONTAL);config.styleGridLines=pluckNumber(overrideConfig.styleGridLines,1);config.gridLineStyle=pluck(overrideConfig.gridLineStyle)};_proto.setDimension=function setDimension(dim){if(dim===void 0){dim={}}var canvas=this,config=canvas.config,borderConfig=config.borderConfig,chartConfig=canvas.getFromEnv("chartConfig");config.canvasTop=dim.top||0;config.canvasLeft=dim.left||0;config.canvasWidth=dim.width||chartConfig.origRenderWidth;config.canvasHeight=dim.height||chartConfig.origRenderHeight;config.canvasBGTop=config.canvasTop+borderConfig.topBorder;config.canvasBGLeft=config.canvasLeft+borderConfig.leftBorder;config.canvasBGWidth=Math.max(0,config.canvasWidth-borderConfig.rightBorder-borderConfig.leftBorder);config.canvasBGHeight=Math.max(0,config.canvasHeight-borderConfig.bottomBorder)};_proto.isWithinCanvas=function isWithinCanvas(xArg,yArg){var canvas=this,x=xArg,y=yArg,config=canvas.config,left=config.canvasBGLeft,right=Math.floor(left+config.canvasBGWidth),top=config.canvasBGTop,padding=config.padding,bottom=Math.floor(top+config.canvasBGHeight),translationObj=canvas.getTranslation();x=x-(translationObj.x||0)+(padding.left||0);y=y-(translationObj.y||0)+(padding.top||0);return x>left&&x<right&&y>top&&y<bottom};_proto.draw=function draw(){var canvas=this;canvas._createGroup();canvas._drawCanvas();!canvas.config.isContext&&canvas._setTooltipBounding()};_proto._setTooltipBounding=function _setTooltipBounding(){var canvas=this,config=canvas.config,translate=canvas.getTranslation(),tooltipController=canvas.getFromEnv("toolTipController"),left=config.canvasLeft+(translate.x||0),top=config.canvasTop+(translate.y||0);tooltipController._setRelativePosition({left:left,right:left+config.canvasWidth,top:top,bottom:top+config.canvasHeight,canvas:this})};_proto._drawCanvas=function _drawCanvas(){var canvas=this,config=canvas.config,borderConfig=config.borderConfig,canvasTop=config.canvasTop+borderConfig.topBorder/2,canvasLeft=config.canvasLeft+borderConfig.leftBorder/2,canvasWidth=config.canvasWidth-(borderConfig.rightBorder/2+borderConfig.leftBorder/2),canvasHeight=config.canvasHeight-(borderConfig.bottomBorder/2+borderConfig.topBorder/2),canvasPaths={leftBorder:[M,canvasLeft,canvasTop,V,canvasTop+canvasHeight],rightBorder:[M,canvasLeft+canvasWidth,canvasTop,V,canvasTop+canvasHeight],topBorder:[M,canvasLeft,canvasTop,H,canvasLeft+canvasWidth],bottomBorder:[M,canvasLeft,canvasTop+canvasHeight,H,canvasLeft+canvasWidth]},border;canvas.addGraphicalElement({el:"rect",component:canvas,label:"canvas",container:{id:"tropo",label:"group",isParent:false},attr:{y:config.canvasBGTop,x:config.canvasBGLeft,width:config.canvasBGWidth,height:config.canvasBGHeight,fill:config.canvasBGColor,"stroke-width":0,stroke:"none",opacity:config.opacity},id:"background"},true);for(border in borderConfig){canvas.addGraphicalElement({el:"path",component:canvas,label:"canvas",container:{id:"tropo",label:"group",isParent:false},attr:{path:canvasPaths[border],stroke:config.canvasBorderColor,"stroke-width":borderConfig[border],opacity:config.opacity},id:"border"},true)}};_proto._createGroup=function _createGroup(){var canvas=this,config=canvas.config,padding=config.padding,canvasLeft=config.canvasBGLeft-padding.left,canvasTop=config.canvasBGTop-padding.top,canvasWidth=config.canvasBGWidth,canvasHeight=config.canvasBGHeight,clipPath=["M"+canvasLeft+","+canvasTop,"L"+(canvasLeft+canvasWidth)+","+canvasTop,"L"+(canvasLeft+canvasWidth)+","+(canvasTop+canvasHeight),"L"+canvasLeft+","+(canvasTop+canvasHeight)+"Z"];canvas.addGraphicalElement({el:"group",container:{id:"tropo",label:"group",isParent:true},component:canvas,label:"group",attr:{name:"canvas-tropo",transform:config.canvasTranslation},id:"tropo"});canvas.addGraphicalElement({el:"group",container:{id:"strato",label:"group",isParent:true},component:canvas,label:"strato",attr:{name:"canvas-strato",transform:config.translate},id:"strato"});canvas.addGraphicalElement({el:"group",container:{id:"meso",label:"group",isParent:true},component:canvas,label:"meso",attr:{name:"canvas-meso",transform:config.translate,"clip-path":clipPath},id:"meso"});canvas.addGraphicalElement({el:"group",container:{id:"thermo",label:"group",isParent:true},component:canvas,label:"thermo",attr:{name:"canvas-thermo",transform:config.translate},id:"thermo"});canvas.addGraphicalElement({el:"group",container:{id:"exo",label:"group",isParent:true},component:canvas,label:"exo",attr:{name:"canvas-exo",transform:config.translate},id:"exo"});canvas.addToEnv("dsGroupclipPath",clipPath)};_proto.setTranslation=function setTranslation(x,y){var config=this.config,borderConfig=config.borderConfig,padding=config.padding;config._translateX=x+borderConfig.leftBorder;config._translateY=y+borderConfig.topBorder;config.canvasTranslation="t"+config._translateX+","+config._translateY;config._translateX+=padding.left;config._translateY+=padding.top;config.translate="t"+config._translateX+","+config._translateY};_proto.getCanvasBorder=function getCanvasBorder(){return this.config.borderConfig};_proto.setPadding=function setPadding(padding){if(padding===void 0){padding={}}Object.assign(this.config.padding,padding)};return Canvas}(SmartRenderer);export default Canvas;