import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{SmartRenderer}from"@fusioncharts/core/src/component-interface";import Calendar from"../../../vendors/fc-calendar/dist/fc-calendar";import{PXSTRING,DEFAULT_FT_FONT}from"@fusioncharts/core/src/lib";import DateBox from"./date-box";import TimeBox from"./time-box";import Button from"./button";import isObject from"@fusioncharts/utils/src/type/is-object";var DEFAULT_CALENDAR_GAP=25,DEFAULT_VERTICAL_PADDING=8,DEFAULT_HORIZONTAL_PADDING=5,DEFAULT_WIDGET_FONT_SIZE=11,CALENDAR_KEY="cal-",CALENDAR_KEY_LEN=CALENDAR_KEY.length,getCssObj=function getCssObj(obj,getStyleDef){var output={};if(isObject(obj)){for(var key in obj){if(obj.hasOwnProperty(key)&&key.startsWith(CALENDAR_KEY)){output[key.substring(CALENDAR_KEY_LEN)]=getStyleDef(obj[key])}}}return output},formatDate=function formatDate(x){return(x<10?"0"+x:x)+""},isWithinDate=function isWithinDate(date,start,end){var startDate=new Date(start.year,start.month,start.day),endDate=new Date(end.year,end.month,end.day),curDate=new Date(date.year,date.month,date.day);if(+curDate>=+startDate&&+curDate<=+endDate){return true}return false};var CustomRangeManager=function(_SmartRenderer){_inheritsLoose(CustomRangeManager,_SmartRenderer);function CustomRangeManager(id){var _this;_this=_SmartRenderer.call(this,id)||this;var manager=_assertThisInitialized(_this);manager.addToEnv("fontParser",function(fontsizeArg){var fontsize=parseFloat(fontsizeArg);return isNaN(fontsize)?DEFAULT_WIDGET_FONT_SIZE:fontsize});return _this}var _proto=CustomRangeManager.prototype;_proto.__setDefaultConfig=function __setDefaultConfig(){var managerConfig=this.config;managerConfig.marginLeft=10;managerConfig.marginRight=10;managerConfig.marginTop=15;managerConfig.marginBottom=15;managerConfig.contextStart={year:1970,month:1,day:1};managerConfig.contextEnd={year:2070,month:1,day:1};managerConfig.calendarDim={height:191,width:163};this._calendars={};managerConfig._backgroundStyle={"font-size":DEFAULT_WIDGET_FONT_SIZE+PXSTRING,"font-family":"Verdana,sans-serif",border:"1px solid #cdcdcd","background-color":"#ffffff"};managerConfig._pointerStyle={"font-size":DEFAULT_WIDGET_FONT_SIZE+PXSTRING,"font-family":"Verdana,sans-serif","border-left":"1px solid #cdcdcd","border-right":"0px solid #cdcdcd","border-top":"1px solid #cdcdcd","border-bottom":"0px solid #cdcdcd",transform:"rotate(45deg)","background-color":"#ffffff"}};_proto.configureAttributes=function configureAttributes(inputConfig){if(inputConfig===void 0){inputConfig={}}var manager=this,managerConfig=manager.config,calendars=manager.getCalendars(),extStyle,styleDef=manager.getFromEnv("getStyleDef"),baseTextStyle=manager.getFromEnv("baseTextStyle"),applyButtonStyle,cancelButtonStyle;Object.assign(managerConfig,inputConfig);extStyle=managerConfig.extStyle;if(managerConfig.visibility!=="visible"){if(calendars.left){calendars.left.dispose();delete calendars.left}if(calendars.right){calendars.right.dispose();delete calendars.right}return}manager.attachChild(DateBox,"left-date","left-date").configure({label:"From: ",date:managerConfig.startDate,id:"left",labelStyle:extStyle.label,inputStyle:extStyle.input});manager.attachChild(DateBox,"right-date","right-date").configure({label:"To: ",date:managerConfig.endDate,id:"right",labelStyle:extStyle.label,inputStyle:extStyle.input});if(managerConfig.showTime){manager.attachChild(TimeBox,"left-time","left-time").configure({time:managerConfig.startDate,labelStyle:extStyle.label,selectStyle:extStyle.select});manager.attachChild(TimeBox,"right-time","right-time").configure({time:managerConfig.endDate,labelStyle:extStyle.label,selectStyle:extStyle.select})}if(extStyle["button-apply"]){applyButtonStyle=Object.assign({},baseTextStyle,extStyle["button-apply"])}else{applyButtonStyle=Object.assign({color:"#ffffff","font-size":DEFAULT_WIDGET_FONT_SIZE+PXSTRING},baseTextStyle)}manager.attachChild(Button,"apply","apply").configure({label:"Apply",type:"submit",customStyle:applyButtonStyle,buttonStyle:applyButtonStyle,"button:hoverout":applyButtonStyle,"button:hover":extStyle["button-apply:hover"]||{}});if(extStyle["button-cancel"]){cancelButtonStyle=Object.assign({},baseTextStyle,extStyle["button-cancel"])}else{cancelButtonStyle=Object.assign({backgroundColor:"#ffffff",color:"#7A7A7A",border:"0px","font-size":DEFAULT_WIDGET_FONT_SIZE+PXSTRING},baseTextStyle)}manager.attachChild(Button,"cancel","cancel").configure({label:"Cancel",type:"cancel",customStyle:cancelButtonStyle,buttonStyle:cancelButtonStyle,"button:hoverout":cancelButtonStyle,"button:hover":extStyle["button-cancel:hover"]||{}});managerConfig._finalBackgroundStyle=Object.assign(managerConfig._backgroundStyle,styleDef(extStyle.container));managerConfig._finalPointerStyle=Object.assign(managerConfig._pointerStyle,styleDef(extStyle.container));if(managerConfig._finalPointerStyle.border){managerConfig._finalPointerStyle["border-left"]=managerConfig._finalPointerStyle["border-top"]=managerConfig._finalPointerStyle.border}managerConfig._finalPointerStyle["border-right"]=managerConfig._finalPointerStyle["border-bottom"]="0px";delete managerConfig._finalPointerStyle.border;managerConfig.calStyle=getCssObj(managerConfig.extStyle,manager.getFromEnv("getStyleDef"))};_proto.manageSpace=function manageSpace(){var manager=this,managerConfig=manager.config,fromLabelBoxDim,toLabelBoxDim,timeBoxPaddingFactor=4,fromDate,toDate,fromTime,toTime,apply,cancel,maxSpaceTakenOnLeft=0,maxSpaceTakenOnRight=0,fromTimeDim={height:0,width:0},toTimeDim={height:0,width:0},applyDim,cancelDim,calendarDim=managerConfig.calendarDim;if(managerConfig.visibility!=="visible"){return}fromDate=manager.getChildren("left-date")[0];toDate=manager.getChildren("right-date")[0];fromTime=manager.getChildren("left-time");toTime=manager.getChildren("right-time");apply=manager.getChildren("apply")[0];cancel=manager.getChildren("cancel")[0];if(fromTime){fromTime=fromTime[0];fromTimeDim=fromTime.getDimension()}if(toTime){toTime=toTime[0];toTimeDim=toTime.getDimension()}!fromTimeDim.height&&(timeBoxPaddingFactor=2);fromLabelBoxDim=fromDate.getDimension();toLabelBoxDim=toDate.getDimension();applyDim=apply.getDimension();cancelDim=cancel.getDimension();maxSpaceTakenOnLeft=Math.max(fromTimeDim.width,fromLabelBoxDim.width,calendarDim.width);managerConfig.leftCalendarPosition={x:managerConfig.marginLeft,y:managerConfig.marginTop+fromLabelBoxDim.height+DEFAULT_VERTICAL_PADDING};managerConfig.rightCalendarPosition={x:managerConfig.marginLeft+maxSpaceTakenOnLeft+DEFAULT_CALENDAR_GAP,y:managerConfig.marginTop+toLabelBoxDim.height+DEFAULT_VERTICAL_PADDING};fromDate.setTranslation(managerConfig.marginLeft,managerConfig.marginTop);toDate.setTranslation(managerConfig.marginLeft+maxSpaceTakenOnLeft+DEFAULT_CALENDAR_GAP,managerConfig.marginTop);fromTime&&fromTime.setTranslation(managerConfig.marginLeft,managerConfig.leftCalendarPosition.y+calendarDim.height+2*DEFAULT_VERTICAL_PADDING);toTime&&toTime.setTranslation(managerConfig.marginLeft+maxSpaceTakenOnLeft+DEFAULT_CALENDAR_GAP,managerConfig.rightCalendarPosition.y+calendarDim.height+2*DEFAULT_VERTICAL_PADDING);apply.setTranslation(managerConfig.marginLeft,managerConfig.leftCalendarPosition.y+calendarDim.height+timeBoxPaddingFactor*DEFAULT_VERTICAL_PADDING+fromTimeDim.height);cancel.setTranslation(managerConfig.marginLeft+applyDim.width+DEFAULT_HORIZONTAL_PADDING,managerConfig.leftCalendarPosition.y+calendarDim.height+timeBoxPaddingFactor*DEFAULT_VERTICAL_PADDING+fromTimeDim.height);maxSpaceTakenOnRight=Math.max(managerConfig.marginLeft+applyDim.width+DEFAULT_HORIZONTAL_PADDING+cancelDim.width,managerConfig.rightCalendarPosition.x+calendarDim.width,managerConfig.marginLeft+maxSpaceTakenOnLeft+DEFAULT_CALENDAR_GAP+toTimeDim.width,managerConfig.marginLeft+maxSpaceTakenOnLeft+DEFAULT_CALENDAR_GAP+toLabelBoxDim.width);managerConfig.width=maxSpaceTakenOnRight+managerConfig.marginRight;managerConfig.height=managerConfig.leftCalendarPosition.y+calendarDim.height+applyDim.height+timeBoxPaddingFactor*DEFAULT_VERTICAL_PADDING+fromTimeDim.height+managerConfig.marginBottom};_proto.isWithinWidget=function isWithinWidget(x,y){var config=this.config,left=config.x,top=config.y,bottom=top+config.height,right=left+config.width;return x>left&&x<right&&y>top&&y<bottom};_proto.draw=function draw(){this.manageSpace();var manager=this,tool=manager.getLinkedParent(),managerConfig=manager.config,position=tool.config.containerPos;managerConfig.x=position.x-managerConfig.width/2;managerConfig.y=position.y+DEFAULT_VERTICAL_PADDING/2;manager.addGraphicalElement({el:"html",attr:{x:managerConfig.x,y:managerConfig.y,width:managerConfig.width,height:managerConfig.height,type:"div",fill:"ffffff",display:"block",class:"fc-crs-widget",visibility:managerConfig.visibility},css:managerConfig._backgroundStyle,component:manager,label:"box-container",id:"box-container"});manager.addGraphicalElement({el:"html",attr:{x:managerConfig.width/2-10,y:-8,width:15,height:15,type:"div",display:"block",visibility:managerConfig.visibility},css:managerConfig._finalPointerStyle,container:{label:"box-container",id:"box-container"},component:manager,label:"box-pointer",id:"box-pointer"});managerConfig.drawCalendars&&manager.drawCalendars()};_proto.getCalendars=function getCalendars(){return this._calendars};_proto.drawCalendars=function drawCalendars(){var manager=this,config=manager.config,calendars=manager.getCalendars(),leftCalendarPosition=config.leftCalendarPosition,rightCalendarPosition=config.rightCalendarPosition,container=manager.getGraphicalElement("box-container","box-container").element,curCalendarDim,calStyle=config.calStyle;if(!calendars.left){calendars.left=new Calendar({weekLabel:["S","M","T","W","T","F","S"],selectedDate:config.startDate,posX:leftCalendarPosition.x,posY:leftCalendarPosition.y,container:container,id:"left",rangeStart:config.contextStart,rangeEnd:config.contextEnd,showInactiveMonths:true,customCssClass:calStyle,events:{onDateChange:function onDateChange(date){manager.updateDate(date,"left")},onMonthChange:function onMonthChange(date){manager.updateDate(date,"left")},onYearChange:function onYearChange(date){manager.updateDate(date,"left")}},"font-family":DEFAULT_FT_FONT+" !important"})}else{calendars.left.configure({weekLabel:["S","M","T","W","T","F","S"],selectedDate:config.startDate,posX:leftCalendarPosition.x,posY:leftCalendarPosition.y,rangeStart:config.contextStart,rangeEnd:config.contextEnd,customCssClass:calStyle,showInactiveMonths:true,container:container})}if(!calendars.right){calendars.right=new Calendar({weekLabel:["S","M","T","W","T","F","S"],selectedDate:config.endDate,posX:rightCalendarPosition.x,posY:rightCalendarPosition.y,rangeStart:config.contextStart,rangeEnd:config.contextEnd,showInactiveMonths:true,customCssClass:calStyle,container:container,id:"right",events:{onDateChange:function onDateChange(date){manager.updateDate(date,"right")},onMonthChange:function onMonthChange(date){manager.updateDate(date,"right")},onYearChange:function onYearChange(date){manager.updateDate(date,"right")}},"font-family":DEFAULT_FT_FONT+" !important"})}else{calendars.right.configure({weekLabel:["S","M","T","W","T","F","S"],selectedDate:config.endDate,posX:rightCalendarPosition.x,posY:rightCalendarPosition.y,rangeStart:config.contextStart,rangeEnd:config.contextEnd,customCssClass:calStyle,showInactiveMonths:true,container:container})}curCalendarDim=calendars.left.getDimension();if(curCalendarDim.width!==config.calendarDim.width||curCalendarDim.height!==config.calendarDim.height){config.calendarDim=curCalendarDim;manager.asyncDraw()}};_proto.updateDate=function updateDate(date,id){var manager=this,labelBox=manager.getChildren(id+"-date")[0],element=labelBox.getGraphicalElement("box","box");labelBox.configure({date:date});element.element.value=formatDate(date.day)+"/"+formatDate(date.month)+"/"+formatDate(date.year)};_proto.updateCalendar=function updateCalendar(date,id){var manager=this,managerConfig=manager.config,calendars=manager.getCalendars();if(isWithinDate(date,managerConfig.contextStart,managerConfig.contextEnd)){calendars[id]&&calendars[id].configure({selectedDate:date})}else{manager.getChildren(id+"-date")[0].setData({},true)}};_proto.submitData=function submitData(type){if(type===void 0){type="cancel"}var manager=this,rangeSelector=manager.getLinkedParent(),chart=rangeSelector.getFromEnv("chart"),curDomain=[],calendars=manager.getCalendars(),isUTC=chart.getFromEnv("UTC"),leftDate=calendars.left.getDate(),rightDate=calendars.right.getDate(),fromTimeComp=manager.getChildren("left-time"),toTimeComp=manager.getChildren("right-time"),d1,d2,fromTime={hours:0,minutes:0,seconds:0},toTime={hours:0,minutes:0,seconds:0};if(fromTimeComp){fromTime=fromTimeComp[0].getTime()}if(toTimeComp){toTime=toTimeComp[0].getTime()}rangeSelector.setData({},true);if(type==="submit"){d1=isUTC?Date.UTC(leftDate.year,leftDate.month-1,leftDate.day,fromTime.hours,fromTime.minutes,fromTime.seconds):new Date(leftDate.year,leftDate.month-1,leftDate.day,fromTime.hours,fromTime.minutes,fromTime.seconds);d2=isUTC?Date.UTC(rightDate.year,rightDate.month-1,rightDate.day,toTime.hours,toTime.minutes,toTime.seconds):new Date(rightDate.year,rightDate.month-1,rightDate.day,toTime.hours,toTime.minutes,toTime.seconds);curDomain.push(+d1);curDomain.push(+d2);chart.setFocusLimit(curDomain)}rangeSelector.removeDocumentListener()};return CustomRangeManager}(SmartRenderer);export{formatDate};export default CustomRangeManager;