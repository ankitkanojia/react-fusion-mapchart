import Line from"./line";import FusionCharts from"../../../../../fusioncharts/core/index";import{TimeSeries}from"../../../index";import DataStore from"../../../../../fc-datatable";import{setup,CONTAINER_ID}from"../../../../../../dev-tests/viz/utitilies";var domSetup=function domSetup(id){if(id===void 0){id="chart-container"}if(!document.getElementById(id)){var ele=document.createElement("div");ele.setAttribute("id",id);document.body.prepend(ele)}},domTeardown=function domTeardown(id){if(id===void 0){id="chart-container"}var ele=document.getElementById(id);if(ele){document.body.removeChild(ele)}};FusionCharts.addDep(TimeSeries);var firstDate=new Date("Sat Feb 01 2014 21:06:00").getTime(),timeGap=new Date("Sat Feb 02 2014 21:06:00").getTime()-firstDate,timeSpan=4*timeGap,pixelRange=[0,45],xScale1={getDomainValue:function getDomainValue(v){var ratio=Math.abs(pixelRange[0]-v)/(pixelRange[1]-pixelRange[0]);return new Date(firstDate+ratio*timeSpan)}},xScale={getRangeValue:function getRangeValue(v){return v*1.5}},yScale={getRangeValue:function getRangeValue(v){return v*1.5}};xdescribe("To verify _getHoveredPlot method",function(){var lDS=new Line;lDS.config.firstTimeStamp=new Date(firstDate).getTime();lDS.config.timeStampGap=timeGap;lDS.addToEnv("xScale",xScale1);lDS.config.dataInfo=[{x:0,y:100},{x:15,y:100},{x:30,y:120},{x:45,y:120}];it("LDS-TC-05: To verify if the method returns n'th plot when pointer x, y is inside the plot",function(){var point=lDS._getHoveredPlot(30,120);expect(point&&point.pointIndex).toBe(2)});it("LDS-TC-06: To verify if the method returns n'th plot when pointer x, y is on the edge of the plot",function(){var point=lDS._getHoveredPlot(10,100);expect(point&&point.pointIndex).toBe(1)});it("LDS-TC-07: To verify if the method does not return n'th plot when pointer x, y is out of the plot",function(){var point=lDS._getHoveredPlot(9,110);expect(point&&point.pointIndex).not.toBe(0);point=lDS._getHoveredPlot(9,116);expect(point&&point.pointIndex).not.toBe(0);point=lDS._getHoveredPlot(9,104);expect(point&&point.pointIndex).not.toBe(0);point=lDS._getHoveredPlot(16,116);expect(point&&point.pointIndex).not.toBe(0);point=lDS._getHoveredPlot(16,104);expect(point&&point.pointIndex).not.toBe(0)})});xdescribe("FASA_TS_1: To validate that correct data generator is used",function(){var line,graphicalElements,dataObj={data:[[{start:13912128e5,end:13912164e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:107090,base:0}],[{start:13912164e5,end:139122e7,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:127137,base:0}],[{start:139122e7,end:13912236e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:61825,base:0}]],schema:[{name:"starttime",type:"interval",format:"%b %e, %Y %I%p"},{name:"sum of tripduration",type:"number"}],style:{fill:"AFD8F8",stroke:"AFD8F8"},series:"India",isAggregated:true,visibility:"visible"};beforeEach(function(){line=new Line;graphicalElements={};line.addGraphicalElement=function(obj){graphicalElements[obj.label]=obj};line.getGraphicalElement=function(label){return graphicalElements[label]};line.addToEnv("xScale",xScale);line.addToEnv("yScale",yScale)});afterEach(function(){line=undefined;graphicalElements={}});it("FASA_TC_1: To verify that lineGenerator is used if dataset type is line",function(){line.__setDefaultConfig();line.config.type="line";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,160635L2086827300000,190705.5L2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("line-path");expect(path).toBe(pathString)});it("FASA_TC_2: To verify that lineGenerator is used if dataset type is smooth-path",function(){line.__setDefaultConfig();line.config.type="smooth-line";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,160635C2086823700000,175670.25,2086825500000,190705.5,2086827300000,190705.5C2086829100000,190705.5,2086830900000,141721.5,2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("smooth-line-path");expect(path).toBe(pathString)});it("FASA_TC_3: To verify that lineGenerator is used if dataset type is step-path",function(){line.__setDefaultConfig();line.config.type="step-line";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,160635L2086824600000,160635L2086824600000,190705.5L2086830000000,190705.5L2086830000000,92737.5L2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("step-line-path");expect(path).toBe(pathString)});it("FASA_TC_4: To verify that lineGenerator is used if dataset type is area",function(){line.__setDefaultConfig();line.config.type="area";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,0L2086827300000,0L2086832700000,0L2086832700000,92737.5L2086827300000,190705.5L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("area-path");expect(path).toBe(pathString)});it("FASA_TC_5: To verify that lineGenerator is used if dataset type is smooth-area",function(){line.__setDefaultConfig();line.config.type="smooth-area";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,0C2086823700000,0,2086825500000,0,2086827300000,0C2086829100000,0,2086830900000,0,2086832700000,0L2086832700000,92737.5C2086830900000,141721.5,2086829100000,190705.5,2086827300000,190705.5C2086825500000,190705.5,2086823700000,175670.25,2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("smooth-area-path");expect(path).toBe(pathString)});it("FASA_TC_6: To verify that lineGenerator is used if dataset type is step-area",function(){line.__setDefaultConfig();line.config.type="step-area";line.configureAttributes(dataObj);line._drawPlot();var dsType=graphicalElements[Object.keys(graphicalElements)[0]].label,pathString="M2086821900000,0L2086824600000,0L2086824600000,0L2086830000000,0L2086830000000,0L2086832700000,0L2086832700000,92737.5L2086830000000,92737.5L2086830000000,190705.5L2086824600000,190705.5L2086824600000,160635L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(dsType).toBe("step-area-path");expect(path).toBe(pathString)})});xdescribe("FASA_TS_2: To validate that correct curve type is used",function(){var line,graphicalElements,dataObj={data:[[{start:13912128e5,end:13912164e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:107090,base:0}],[{start:13912164e5,end:139122e7,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:127137,base:0}],[{start:139122e7,end:13912236e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:61825,base:0}]],schema:[{name:"starttime",type:"interval",format:"%b %e, %Y %I%p"},{name:"sum of tripduration",type:"number"}],style:{fill:"AFD8F8",stroke:"AFD8F8"},series:"India",isAggregated:true,visibility:"visible"};beforeEach(function(){line=new Line;graphicalElements={};line.addGraphicalElement=function(obj){graphicalElements[obj.label]=obj};line.getGraphicalElement=function(label){return graphicalElements[label]};line.addToEnv("xScale",xScale);line.addToEnv("yScale",yScale)});afterEach(function(){line=undefined;graphicalElements={}});it("FASA_TC_7: To verify that linear curve is returned if dataset type is area.",function(){line.config.type="area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0L2086827300000,0L2086832700000,0L2086832700000,92737.5L2086827300000,190705.5L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_8: To verify that curve is returned if dataset type is smooth-line.",function(){line.__setDefaultConfig();line.config.type="smooth-path";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,160635C2086823700000,175670.25,2086825500000,190705.5,2086827300000,190705.5C2086829100000,190705.5,2086830900000,141721.5,2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_9: To verify that curve is returned if dataset type is smooth-area.",function(){line.__setDefaultConfig();line.config.type="smooth-area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0C2086823700000,0,2086825500000,0,2086827300000,0C2086829100000,0,2086830900000,0,2086832700000,0L2086832700000,92737.5C2086830900000,141721.5,2086829100000,190705.5,2086827300000,190705.5C2086825500000,190705.5,2086823700000,175670.25,2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_10: To verify that stepcurve is returned if dataset type is step-line, step-area.",function(){line.__setDefaultConfig();line.config.type="step-path";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,160635L2086824600000,160635L2086824600000,190705.5L2086830000000,190705.5L2086830000000,92737.5L2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_11: To verify that stepcurve is returned if dataset type is step-line, step-area.",function(){line.__setDefaultConfig();line.config.type="step-area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0L2086824600000,0L2086824600000,0L2086830000000,0L2086830000000,0L2086832700000,0L2086832700000,92737.5L2086830000000,92737.5L2086830000000,190705.5L2086824600000,190705.5L2086824600000,160635L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)})});xdescribe("FASA_TS_3: To verify the path for smooth-line dataset",function(){var line,graphicalElements,dataObj={data:[[{start:13912128e5,end:13912164e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:107090,base:0}],[{start:13912164e5,end:139122e7,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:127137,base:0}],[{start:139122e7,end:13912236e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:61825,base:0}]],schema:[{name:"starttime",type:"interval",format:"%b %e, %Y %I%p"},{name:"sum of tripduration",type:"number"}],style:{fill:"AFD8F8",stroke:"AFD8F8"},series:"India",isAggregated:true,visibility:"visible"};beforeEach(function(){line=new Line;graphicalElements={};line.addGraphicalElement=function(obj){graphicalElements[obj.label]=obj};line.getGraphicalElement=function(label){return graphicalElements[label]};line.addToEnv("xScale",xScale);line.addToEnv("yScale",yScale)});afterEach(function(){line=undefined;graphicalElements={}});it("FASA_TC_12: Smooth line path string should be generated according to data provided",function(){line.__setDefaultConfig();line.config.type="smooth-path";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,160635C2086823700000,175670.25,2086825500000,190705.5,2086827300000,190705.5C2086829100000,190705.5,2086830900000,141721.5,2086832700000,92737.5",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)})});xdescribe("FASA_TS_4: To verify the path for area dataset",function(){var line,graphicalElements,dataObj={data:[[{start:13912128e5,end:13912164e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:107090,base:0}],[{start:13932128e5,end:13912164e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:107090,base:0}],[{start:13912164e5,end:139122e7,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:127137,base:0}],[{start:139122e7,end:13912236e5,duration:{Unit:"Hour",number:1,ms:36e5},outputFormat:"%b %e, %Y %I%p"},{target:61825,base:0}]],schema:[{name:"starttime",type:"interval",format:"%b %e, %Y %I%p"},{name:"sum of tripduration",type:"number"}],style:{fill:"AFD8F8",stroke:"AFD8F8"},series:"India",isAggregated:true,visibility:"visible"};beforeEach(function(){line=new Line;graphicalElements={};line.addGraphicalElement=function(obj){graphicalElements[obj.label]=obj};line.getGraphicalElement=function(label){return graphicalElements[label]};line.addToEnv("xScale",xScale);line.addToEnv("yScale",yScale)});afterEach(function(){line=undefined;graphicalElements={}});it("FASA_TC_13: To verify area path string with given data.",function(){line.config.type="area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0L2088321900000,0L2086827300000,0L2086832700000,0L2086832700000,92737.5L2086827300000,190705.5L2088321900000,160635L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_14: To verify smooth area path string with given data.",function(){line.__setDefaultConfig();line.config.type="smooth-area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0C2087321900000,0,2087821900000,0,2088321900000,0C2087823700000,0,2087325500000,0,2086827300000,0C2086829100000,0,2086830900000,0,2086832700000,0L2086832700000,92737.5C2086830900000,141685.28502609394,2086829100000,190633.0700521879,2086827300000,190705.5C2087325500000,170658.5,2087823700000,160635,2088321900000,160635C2087821900000,160635,2087321900000,160635,2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)});it("FASA_TC_15: To verify step area path string with given data.",function(){line.__setDefaultConfig();line.config.type="step-area";line.configureAttributes(dataObj);line._drawPlot();var pathString="M2086821900000,0L2087571900000,0L2087571900000,0L2087574600000,0L2087574600000,0L2086830000000,0L2086830000000,0L2086832700000,0L2086832700000,92737.5L2086830000000,92737.5L2086830000000,190705.5L2087574600000,190705.5L2087574600000,160635L2087571900000,160635L2087571900000,160635L2086821900000,160635Z",path=graphicalElements[Object.keys(graphicalElements)[0]].attr.path;expect(path).toBe(pathString)})});describe("Tooltip when hovered",function(){var data=[["11-Apr-19",0,0],["15-Apr-19",1.22,1.06],["12-Apr-19",1.22,1.06]],schema=[{name:"Time",type:"date",format:"%d-%b-%y"},{name:"test",type:"number"},{name:"Peer Median",type:"number"}],fusionDataStore=new DataStore,fusionTable=fusionDataStore.createDataTable(data,schema);var chartData={type:"timeseries",renderAt:CONTAINER_ID,width:600,height:400,dataSource:{data:fusionTable,yaxis:[{title:" ",style:{"grid-line":{"stroke-dasharray":"4 3","stroke-width":2,"stroke-opacity":"3"}},format:{prefix:"",suffix:"%"},plot:[{value:"test",type:"line"},{value:"Peer Median",type:"line",style:{plot:{"stroke-dasharray":"5 2"}}}]}],chart:{palettecolors:["#EE6761","#1A82C2"],showLegend:"0"},extensions:{standardRangeSelector:{enabled:0},customRangeSelector:{enabled:"0"}},plotConfig:{generic:{connectNullData:true}}}},chart;beforeEach(function(){chart=setup(FusionCharts,chartData)});afterEach(function(){return chart.dispose()});it("will be visible for last data even its one day binning",function(done){chart.addEventListener("renderComplete",function(e){e.detachHandler();var canvasGroup=document.querySelectorAll('[class$="canvas-strato"]')[0];canvasGroup.dispatchEvent(new MouseEvent("mouseover",{bubbles:true,clientX:581.5768432617188,clientY:50}));setTimeout(function(){var tooltip=document.querySelectorAll('[class$="fc__tooltip fusioncharts-div"]')[0];expect(tooltip.innerText).not.toBe("");done()},32)});chart.render()})});describe("Continuous Dataset",function(){var data=[["11-Apr-19",-10],["12-Apr-19",-5],["13-Apr-19",-2],["14-Apr-19",null],["15-Apr-19",null],["16-Apr-19",-2],["17-Apr-19",null],["18-Apr-19",10],["19-Apr-19",7],["20-Apr-19",3]],schema=[{name:"Time",type:"date",format:"%d-%b-%y"},{name:"MeasureX",type:"number"}],table=(new DataStore).createDataTable(data,schema),dataSource={data:table,yAxis:[{plot:[{value:"MeasureX",type:"line"}]},{plot:[{value:"MeasureX",type:"smooth-line"}]},{plot:[{value:"MeasureX",type:"step-line"}]},{plot:[{value:"MeasureX",type:"area"}]},{plot:[{value:"MeasureX",type:"smooth-area"}]},{plot:[{value:"MeasureX",type:"step-area"}]}]},dsSelector=function dsSelector(s){if(s===void 0){s=""}return s===""?'[class*="line-plot"]':'[class*="line-plot-'+s+'"]'},dsSelectorAll=dsSelector();beforeEach(function(){return domSetup()});afterEach(function(){return domTeardown()});it("should not connect null data by default",function(done){var chart=new FusionCharts({type:"timeseries",height:"550",renderAt:"chart-container",dataSource:dataSource}).render();chart.addEventListener("rendercomplete",function(_ref){var chart=_ref.sender;var viz=chart.apiInstance,datasets=viz.getDatasets(),dsPaths=Array.from(document.querySelectorAll(dsSelectorAll)).filter(function(g){return g.children.length}).map(function(g){return g.children[0].getAttribute("d")});datasets.forEach(function(ds){expect(ds.config.connectNullData).toBeFalsy()});dsPaths.forEach(function(p){return expect(typeof p).toBe("string")});chart.dispose()});FusionCharts.addEventListener("disposed",function(){return done()})})});