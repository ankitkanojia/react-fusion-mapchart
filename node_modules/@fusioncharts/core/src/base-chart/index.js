import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{POSITION_BOTTOM,CREDIT_HREF,CREDIT_STRING,creditLabel,POSITION_START,BLANK,POINTER,HAND,componentFactory,ROUND,getMouseCoordinate,pluck}from"../lib";import{triggerEvent}from"../event-api";import ChartMessage from"../chart-message";import{ComponentInterface}from"../component-interface";import AnimationManager from"../animation-manager";import{getDep}from"../dependency-manager";import EiList from"../_internal/ei-method-list";var MOUSEOUT="fc-mouseout",DEFAULT_CREDITLABEL=creditLabel,addEiMethods=function addEiMethods(chartInstance,eiMethods){var methodName;for(methodName in eiMethods){if(eiMethods.hasOwnProperty(methodName)){chartInstance[methodName]=eiMethods[methodName]}}},getEIList=function getEIList(type){var specific=EiList[type]||[];return specific.concat(EiList["*"])},_mouseEvtHandler2=function _mouseEvtHandler(iapi,e,data){var mouseTracker=data.mouseTracker,oriEvent=e.originalEvent,chartConfig=iapi.config,datasets=chartConfig.datasetOrder||iapi.getDatasets(),coordinate,chartX,chartY,dataset,hoveredInfo,pointFound=false,i=datasets.length,j,l,derivedEvensInfo,_lastDatasetIndex=mouseTracker._lastDatasetIndex,_lastPointIndex=mouseTracker._lastPointIndex;coordinate=getMouseCoordinate(iapi.getFromEnv("chart-container"),oriEvent,iapi);chartX=coordinate.chartX;chartY=coordinate.chartY;while(i--&&!pointFound){dataset=datasets[i];if(dataset&&dataset.getState("visible")){hoveredInfo=dataset._getHoveredPlot&&dataset._getHoveredPlot(chartX,chartY);if(hoveredInfo&&hoveredInfo.hovered){pointFound=true;hoveredInfo.datasetIndex=i;derivedEvensInfo=mouseTracker.getMouseEvents(e,hoveredInfo.datasetIndex,hoveredInfo.pointIndex)}}}if((!pointFound||derivedEvensInfo&&derivedEvensInfo.fireOut)&&typeof _lastDatasetIndex!=="undefined"){if(datasets[_lastDatasetIndex]&&datasets[_lastDatasetIndex]._firePlotEvent){if(derivedEvensInfo&&!derivedEvensInfo.events.length){mouseTracker.mouseoutTimer=setTimeout(function(){iapi.mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex)},20)}else{iapi.mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex);clearTimeout(mouseTracker.mouseoutTimer)}}}if(pointFound){l=derivedEvensInfo.events&&derivedEvensInfo.events.length;if(l){mouseTracker._lastDatasetIndex=hoveredInfo.datasetIndex;_lastPointIndex=mouseTracker._lastPointIndex=hoveredInfo.pointIndex}for(j=0;j<l;j+=1){if(dataset&&dataset._firePlotEvent){dataset&&dataset._firePlotEvent&&dataset._firePlotEvent(derivedEvensInfo.events[j],_lastPointIndex,e,hoveredInfo.datasetIndex)}}}};var BaseChart=function(_ComponentInterface){_inheritsLoose(BaseChart,_ComponentInterface);function BaseChart(){return _ComponentInterface.apply(this,arguments)||this}BaseChart.getName=function getName(){return"base"};var _proto=BaseChart.prototype;_proto.setDummyEImethods=function setDummyEImethods(type){var iapi=this,config=iapi.config,_eiStore=config._eiStore||(config._eiStore={}),methods=getEIList(type),chartInstance=iapi.getFromEnv("chartInstance"),fnGenerator=function fnGenerator(fn){return function(){!_eiStore[fn]&&(_eiStore[fn]=[]);_eiStore[fn].push(arguments)}};methods.forEach(function(method){!chartInstance[method]&&(chartInstance[method]=fnGenerator(method))});chartInstance.addEventListener("renderComplete",function(){var _loop=function _loop(fn){_eiStore[fn].forEach(function(fnCalls){chartInstance[fn].apply(chartInstance,fnCalls)})};for(var fn in _eiStore){_loop(fn)}config._eiStore={}})};BaseChart.getType=function getType(){return"chartAPI"};_proto.mouseoutHandler=function mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex){var chart=this,datasets=chart.config.datasetOrder||chart.getDatasets(),mouseTracker=chart.getChildren("mouseTracker")[0];if(datasets[_lastDatasetIndex]&&datasets[_lastDatasetIndex].components.data[_lastPointIndex]){datasets[_lastDatasetIndex]._firePlotEvent(MOUSEOUT,_lastPointIndex,e)}else{chart.getFromEnv("toolTipController").hideAll()}delete mouseTracker._lastDatasetIndex;delete mouseTracker._lastPointIndex};_proto.getName=function getName(){return"base"};_proto.getType=function getType(){return"chartAPI"};_proto._mouseEvtHandler=function _mouseEvtHandler(e,data){_mouseEvtHandler2(this,e,data)};_proto.getComponents=function getComponents(parentComp,type){var comp=parentComp||this,datasets=[];comp.iterateComponents(function(component){if(component.getType()===type){datasets.push(component)}});return datasets};_proto.getDatasets=function getDatasets(parentComp){var comp=parentComp||this,datasets=[];comp.iterateComponents(function(component){if(component.getType()==="dataset"){datasets.push(component)}});return datasets};_proto.preConfigure=function preConfigure(dataObj){_ComponentInterface.prototype.preConfigure.call(this,dataObj);addEiMethods(this.getFromEnv("chartInstance"),this.eiMethods)};_proto.configureAttributes=function configureAttributes(dataObj){_ComponentInterface.prototype.configureAttributes.call(this,dataObj);this.createBaseComponent()};_proto.createBaseComponent=function createBaseComponent(){var iapi=this,animationManager;if(animationManager=iapi.getFromEnv("animationManager")){animationManager.configure()}else{animationManager=new AnimationManager;iapi.addToEnv("animationManager",animationManager);animationManager.addToEnv("chart",iapi);animationManager.addToEnv("animationManager",animationManager);animationManager.configure();iapi.addExtEventListener("animationstart",function(e){var duration=e.data.duration;duration&&iapi.fireChartInstanceEvent("animationinvoked",{duration:duration})},animationManager)}};_proto.setChartMessage=function setChartMessage(message,chartObj,_container){var iapi=this,paper,Raphael,chartMessage,container=_container;componentFactory(this,ChartMessage,"chartMessage");chartMessage=iapi.getChildren("chartMessage")[0];if(container){iapi.addToEnv("chart-container",container)}else{container=iapi.getFromEnv("chart-container")}paper=iapi.getFromEnv("paper");if(!paper){Raphael=getDep("redraphael","plugin");paper=new Raphael(container,iapi.getFromEnv("chartWidth"),iapi.getFromEnv("chartHeight"));paper.setHTMLClassName("fusioncharts-div");iapi.addToEnv("paper",paper)}paper.setConfig("stroke-linecap",ROUND);!iapi.getChildContainer("messageGroup")&&iapi.addChildContainer("messageGroup",paper.group("messageGroup"));iapi.config.hasChartMessage=true;chartMessage.setData({message:message,chartObj:chartObj,visible:true},true)};_proto.drawChartMessage=function drawChartMessage(){var iapi=this;iapi.config.hasChartMessage=true;iapi._drawCreditLabel()};_proto._dispose=function _dispose(){this._clearTimers&&this._clearTimers();var paper=this.getFromEnv("paper");paper&&paper.remove&&paper.remove();_ComponentInterface.prototype._dispose.call(this)};_proto.fireChartInstanceEvent=function fireChartInstanceEvent(name,data,originalEvent,defaultFn,cancelledFn){var chartInstance=this.getFromEnv("chartInstance");triggerEvent(name,chartInstance,data,originalEvent,defaultFn,cancelledFn)};_proto._hideChartMessage=function _hideChartMessage(){var iapi=this,chartMessage=iapi.getChildren("chartMessage");iapi.config.hasChartMessage=false;chartMessage&&chartMessage[0].setData({visible:false},true);iapi.getGraphicalElement("messageText")&&iapi.getGraphicalElement("messageText").hide();iapi.getGraphicalElement("messageVeil")&&iapi.getGraphicalElement("messageVeil").hide()};_proto._removeWaitingJobs=function _removeWaitingJobs(){this.iterateComponents(function(comp){return comp.removeAllJobs()})};_proto._drawCreditLabel=function _drawCreditLabel(){var iapi=this,coreOptions=iapi.getFromEnv("core-options"),paper=iapi.getFromEnv("paper"),globalCreditLabel=coreOptions.creditLabel,chartCreditLabel=iapi.getFromEnv("chartInstance").args.creditLabel,hasCreditLabel,chartHeight=+iapi.getFromEnv("chartHeight"),creditLabelElemCheck=iapi.getGraphicalElement("creditLabel"),creditLabelElem,creditGroup,parentGroup=iapi.getContainer("parentgroup"),attr,css,credits={href:CREDIT_HREF,text:CREDIT_STRING};hasCreditLabel=pluck(chartCreditLabel,globalCreditLabel,DEFAULT_CREDITLABEL);if(hasCreditLabel){creditGroup=iapi.getContainer("creditgroup")||iapi.addContainer("creditgroup",paper.group("creditgroup"));parentGroup&&creditGroup.insertAfter(parentGroup);attr={text:credits.text,x:6,y:chartHeight-4,"vertical-align":POSITION_BOTTOM,"text-anchor":POSITION_START,fill:"rgba(0,0,0,0.5)",title:credits.title||BLANK};css={fontSize:9,fontFamily:"Verdana,sans",cursor:POINTER,_cursor:HAND};if(!creditLabelElemCheck){creditLabelElem=paper.text(attr,css,creditGroup);iapi.addGraphicalElement("creditLabel",creditLabelElem);creditLabelElem.on("fc-click",function(){try{open(credits.href)}catch(err){(top||window).location.href=credits.href}})}else{creditLabelElemCheck.attr(attr).css(css)}}else if(creditLabelElem&&creditLabelElem.remove){iapi.removeGraphicalElement("creditLabel")}};_proto._hideModal=function _hideModal(){this.getChildContainer("messageGroup").hide()};_proto.remove=function remove(config){var animationManager=this.getFromEnv("animationManager");_ComponentInterface.prototype.remove.call(this,config);animationManager&&animationManager.remove(config)};return BaseChart}(ComponentInterface);BaseChart.stringConstants={BACKGROUNDLOADED:"BackgroundLoaded",BACKGROUNDLOADERROR:"BackgroundLoadError",clipRectStr:"clip-rect"};export{_mouseEvtHandler2 as _mouseEvtHandler};export default BaseChart;