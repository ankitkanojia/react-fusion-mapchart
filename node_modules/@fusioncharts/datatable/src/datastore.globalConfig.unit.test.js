import DataStore from"./datastore";import{groupBy,pivot}from"./operators";import{setConfig}from"./globalConfig";import{DatetimeUnits}from"../../fc-utils/src/datetime-enums";var DS,DT,DT1,ops,result,dataArr=[["01-Jan-2015 9:50","55","100"],["01-Jan-2015 14:50","55","100"],["02-Jan-2015 11:09","56","106"],["02-Jan-2015 14:47","56","106"],["03-Jan-2015 00:31","59","108"],["04-Jan-2015 2:44","50","102"],["04-Jan-2015 10:31","50","102"],["04-Jan-2015 15:05","50","102"],["05-Jan-2015 13:00","56","108"]],schemaArr=[{name:"Time",type:"date",format:"%e-%b-%Y %-H:%M"},{name:"Downloads",type:"number"},{name:"Web Visits",type:"number"}];describe("enableUTC testing",function(){describe("getData in master data table",function(){it("test default enableUTC to be false",function(){DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();result=DT.getData();expect(result.data[0][0]).toBe(1420086e6)});it("set enableUTC to be true to work",function(){setConfig("enableUTC",true);DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();result=DT.getData();expect(result.data[0][0]).toBe(14201058e5)})});describe("groupby operation with interval data",function(){it("single sorted - set enableUTC to be false to work",function(){setConfig("enableUTC",false);DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();ops=groupBy([{column:"Time",timeUnit:DatetimeUnits.Day}],[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200506e5)});it("single sorted - set enableUTC to be true to work",function(){setConfig("enableUTC",true);DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();ops=groupBy([{column:"Time",timeUnit:DatetimeUnits.Day}],[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200704e5)});it("unsorted/multiple - set enableUTC to be false to work",function(){setConfig("enableUTC",false);DS=new DataStore(dataArr,schemaArr,{enableIndex:false});DT=DS.getDataTable();ops=groupBy([{column:"Time",timeUnit:DatetimeUnits.Day}],[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200506e5)});it("unsorted/multiple - set enableUTC to be true to work",function(){setConfig("enableUTC",true);DS=new DataStore(dataArr,schemaArr,{enableIndex:false});DT=DS.getDataTable();ops=groupBy([{column:"Time",timeUnit:DatetimeUnits.Day}],[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200704e5)})});describe("pivot operation with interval data",function(){it("set enableUTC to be false to work",function(){setConfig("enableUTC",false);DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();ops=pivot([{column:"Time",timeUnit:DatetimeUnits.Day}],"Web Visits",[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200506e5)});it("set enableUTC to be true to work",function(){setConfig("enableUTC",true);DS=new DataStore(dataArr,schemaArr,{enableIndex:true,indexBy:"Time"});DT=DS.getDataTable();ops=pivot([{column:"Time",timeUnit:DatetimeUnits.Day}],"Web Visits",[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200704e5)});it("unsorted/multiple - set enableUTC to be false to work",function(){setConfig("enableUTC",false);DS=new DataStore(dataArr,schemaArr,{enableIndex:false});DT=DS.getDataTable();ops=pivot([{column:"Time",timeUnit:DatetimeUnits.Day}],"Web Visits",[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200506e5)});it("unsorted/multiple - set enableUTC to be true to work",function(){setConfig("enableUTC",true);DS=new DataStore(dataArr,schemaArr,{enableIndex:false});DT=DS.getDataTable();ops=pivot([{column:"Time",timeUnit:DatetimeUnits.Day}],"Web Visits",[{column:"Downloads",operation:"sum"}]);DT1=DT.query(ops);result=DT1.getData();expect(result.data[0][0].start).toBe(14200704e5)})})});