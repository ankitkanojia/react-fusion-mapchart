import _extends from"@babel/runtime/helpers/extends";import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import AreaDataset from"../area";import{parseConfiguration,touchEnabled,getPosition,COMMASPACE,ZEROSTRING,hasSVG,pluck,parsexAxisStyles,pluckNumber,toRaphaelColor,parseUnsafeString,ONESTRING,HUNDREDSTRING,getDashStyle,getValidValue,parseTooltext,COMMASTRING,convertColor,getLightColor,getFirstAlpha,getFirstColor,BLANKSTRING,normalizeAngle}from"@fusioncharts/core/src/lib";import{addDep,getDep}from"@fusioncharts/core/src/dependency-manager";import pie2dAnimation from"./index.animation";import raphaelShapesRingpath from"@fusioncharts/core/src/_internal/redraphael/redraphael-shapes/redraphael-shapes.ringpath";import{priorityList}from"@fusioncharts/core/src/schedular";import pointColor from"@fusioncharts/core/src/print-color";import{getCleanAngle,getQuadrant,getConnectorPath}from"./pie-label-utils";var UNDEF;var Raphael=getDep("redraphael","plugin"),win=window,doc=win.document,MIDDLE_STR="middle",isVML=!hasSVG,supportsTouch="createTouch"in doc,supportsOnlyTouch=supportsTouch&&!(win.navigator.maxTouchPoints||win.navigator.msMaxTouchPoints),ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",EVENTARGS="eventArgs",TRANSFORMSTR="t",DASH_DEF="none",POINTER="pointer",OUTSIDE="outside",INSIDE="inside",math=Math,mathATan2=math.atan2,mathSin=math.sin,mathCos=math.cos,mathMax=math.max,mathMin=math.min,mathAbs=math.abs,mathFloor=math.floor,pi=math.PI,rad2deg=180/math.PI,pi2=2*pi,QUADRANT_COUNT=4,segregateLabelsInQuadrant=function segregateLabelsInQuadrant(labelAr){var i,len,angle,quadrant,quadrantAr=[[],[],[],[]];for(i=0,len=labelAr.length;i<len;i++){angle=getCleanAngle(labelAr[i].point.config.angle);quadrant=getQuadrant(angle);quadrantAr[quadrant].push({point:labelAr[i].point,angle:angle})}return quadrantAr},createGroup=function createGroup(groupName,parentContainer,dataset){var animationManager=dataset.getFromEnv("animationManager");return animationManager.setAnimation({el:"group",attr:{name:groupName},container:parentContainer,component:dataset,label:"group"})},singleFillColorFn=function singleFillColorFn(color,defaultRadius){var value=defaultRadius?1:UNDEF;return toRaphaelColor({color:getFirstColor(color.color,value),alpha:getFirstAlpha(color.alpha,value)})},getContainerPosition=function getContainerPosition(elem,noscroll){var p={left:0,top:0},el=elem,clientRect;if(el.getBoundingClientRect){clientRect=el.getBoundingClientRect();p.top=clientRect.top+(win.pageYOffset||doc.scrollTop||0)-(doc.clientTop||0);p.left=clientRect.left+(win.pageXOffset||doc.scrollLeft||0)-(doc.clientLeft||0)}else{while(el){p.left+=el.offsetLeft||0;p.top+=el.offsetTop||0;if(el!==doc.body&&el!==doc.documentElement&&!noscroll){p.left-=el.scrollLeft||0;p.top-=el.scrollTop||0}el=el.offsetParent}}return p},getClickArcTangent=function getClickArcTangent(x,y,center,ref,pieYScale){return mathATan2((y-center[1]-ref.top)/pieYScale,x-center[0]-ref.left)},plotClickHandler=function plotClickHandler(dataSet,ele){return function(e){var plotItem=ele.data("plotItem"),seriesData=plotItem.seriesData;!seriesData.isRotating&&dataSet.plotGraphicClick.call(ele,e)}},plotGraphicClick=function plotGraphicClick(dataset){return function(evt){var o=this.element||this,plotItem=o.plotItem||o.data("plotItem"),elData=o.data("eventArgs")||{},prevTextPos,chart=plotItem.chart,animationManager=dataset.getFromEnv("animationManager"),index=plotItem.index,seriesData=dataset.config,enableMultiSlicing=seriesData.enableMultiSlicing,set=dataset.components.data[index],setGraphics=set.graphics,setConfig=set.config,doNotSlice=setConfig.doNotSlice,atleastOneOtherSliced,graphic,dataLabel,innerDataLabel,sliced,slicedTranslation=setConfig.slicedTranslation,transX,transY,connector,connectorPath,lastSliceTimeStamp,minTimeForNextSlice=400,eventArgs,path;!seriesData.isRotating&&evt&&chart.plotEventHandler(o,evt);if(seriesData.isRotating||seriesData.singletonCase||doNotSlice||!chart.config){return}atleastOneOtherSliced=!enableMultiSlicing&&dataset.sliceInOtherPies(index);if((sliced=setConfig.sliced)&&atleastOneOtherSliced){return}if(supportsTouch&&!supportsOnlyTouch){lastSliceTimeStamp=(new Date).getTime();if(plotItem.lastSliceTimeStamp&&lastSliceTimeStamp-plotItem.lastSliceTimeStamp<minTimeForNextSlice){return}plotItem.lastSliceTimeStamp=lastSliceTimeStamp}graphic=setGraphics.element;connector=setGraphics.connector;dataLabel=setGraphics.label||setGraphics.dataLabel;innerDataLabel=setGraphics.innerLabel;slicedTranslation=typeof slicedTranslation==="object"?"t"+slicedTranslation:slicedTranslation;connectorPath=setConfig.connectorPath;transX=(sliced?-1:1)*setConfig.transX;transY=(sliced?-1:1)*setConfig.transY;eventArgs=graphic.data(EVENTARGS)||graphic.data(EVENTARGS,{});chart.fireChartInstanceEvent("slicingStart",{slicedState:sliced,dataIndex:"index"in elData&&elData.index,data:dataset.getPlotData(index,sliced)});animationManager.setAnimationState("slicing");animationManager.setAnimation({el:graphic,attr:{transform:sliced?"t0,0":slicedTranslation},component:dataset,label:"slice",callback:function callback(){chart.fireChartInstanceEvent("slicingEnd",{slicedState:sliced,dataIndex:"index"in elData&&elData.index,data:dataset.getPlotData(index,!sliced)})}});if(dataLabel&&dataLabel.x){if(!(prevTextPos=dataLabel.data("textPos"))){prevTextPos=dataLabel.data("textPos",{x:dataLabel.x,y:dataLabel.y})}animationManager.setAnimation({el:dataLabel,attr:{x:dataLabel.x+(sliced?0:transX),y:dataLabel.y+(sliced?0:transY)},label:"label-sliced",component:dataset});prevTextPos.x=dataLabel.x+(sliced?0:transX)}innerDataLabel&&animationManager.setAnimation({el:innerDataLabel,attr:{x:innerDataLabel.x+(sliced?0:transX),y:innerDataLabel.y+(sliced?0:transY)},label:"label-sliced",component:dataset});if(connector&&connectorPath){path=connectorPath.slice(0);path[1]+=transX;path[2]+=transY;path[4]+=transX;path[5]+=transY;path[6]+=transX;path[7]+=transY;animationManager.setAnimation({el:connector,attr:{path:path},label:"connector-sliced",component:dataset});setConfig.connectorPath=path}eventArgs.isSliced=sliced=setConfig.sliced=!sliced;return sliced}},handlers=function handlers(dataset){var animationManager=dataset.getFromEnv("animationManager");return{plotDragMove:function plotDragMove(evt){var o=this,plotItem=o.data("plotItem"),chart=plotItem.chart,evtData=evt.data,dx=evtData[0],dy=evtData[1],x=evtData[2],y=evtData[3],seriesData=plotItem.seriesData,datasetConf=dataset.config,angle;if(isNaN(dx)||isNaN(dy)||!datasetConf.enableRotation||seriesData.singletonCase||seriesData.isRightClicked){return}angle=getClickArcTangent.call(evt,x,y,seriesData.pieCenter,seriesData.chartPosition,1);if(seriesData.dragStartAngle!==angle&&!seriesData.isRotating){seriesData.isRotating=true;chart.fireChartInstanceEvent("RotationStart",{startingAngle:seriesData._rotationalStartAngle=chart._startingAngle()})}datasetConf.startAngle+=angle-seriesData.dragStartAngle;seriesData.dragStartAngle=angle;seriesData.moveDuration=0;if(!datasetConf.updateInited){datasetConf.updateInited=true;chart.addJob("pie_batch_rotate",chart._batchRotate||(chart._batchRotate=function(){dataset._rotate();datasetConf.updateInited=false}),priorityList.draw,{oneInAFrame:true})}},plotDragStart:function plotDragStart(evt){var o=this,plotItem=o.data("plotItem"),chart=plotItem.chart,seriesData=plotItem.seriesData,datasetConf=dataset.config,button=pluckNumber(evt.button,evt.originalEvent.button),startingAng=-datasetConf.startAngle*rad2deg,angle,x=evt.data[0],y=evt.data[1];seriesData.isRightClicked=!!(!touchEnabled&&button!==0&&button!==1);if(!datasetConf.enableRotation||seriesData.isRightClicked){return}seriesData.isRotating=false;seriesData.chartPosition=getContainerPosition(chart.getFromEnv("chart-container"));angle=getClickArcTangent.call(evt,x,y,seriesData.pieCenter,seriesData.chartPosition,1);seriesData.dragStartAngle=angle;seriesData.startingAngleOnDragStart=startingAng},plotDragEnd:function plotDragEnd(){var o=this,plotItem=o.data("plotItem"),chart=plotItem.chart,dataSet=chart.getChildren("dataset")[0],dataSetConfig=dataSet.config,chartConfig=chart.config,seriesData=plotItem.seriesData,startingAng=-dataSetConfig.startAngle*rad2deg;if(seriesData.isRightClicked){return}chartConfig.clicked=true;if(!chart.disposed){dataset._rotate()}delete chartConfig.clicked;if(seriesData.isRotating){setTimeout(function(){seriesData.isRotating=false},0);chart.fireChartInstanceEvent("RotationEnd",{startingAngle:normalizeAngle(startingAng,true),changeInAngle:startingAng-dataSetConfig.startingAngleOnDragStart})}!seriesData.isHovered&&dataset.config.handlersAPI.onPlotHover(o,false)},plotRollOver:function plotRollOver(e){var ele=this,plotItem=ele.plotItem||ele.data("plotItem"),chart=plotItem.chart,conf=plotItem.seriesData,dataSet=chart.getDatasets()[0],animationmanager=dataSet.getFromEnv("animationManager");if(!conf.isRotating){chart.plotEventHandler(ele,e,ROLLOVER);dataSet.config.handlersAPI.onPlotHover(ele,true,animationmanager)}dataSet.fireEvent("datasetrollover",plotItem);conf.isHovered=true},plotRollOut:function plotRollOut(e){var ele=this,plotItem=ele.plotItem||ele.data("plotItem"),chart=plotItem.chart,conf=plotItem.seriesData,dataSet=chart.getDatasets()[0];if(!conf.isRotating){chart.plotEventHandler(ele,e,ROLLOUT);dataSet.config.handlersAPI.onPlotHover(ele,false)}dataSet.fireEvent("datasetrollout",plotItem);conf.isHovered=false},onPlotHover:function onPlotHover(plot,hover){var plotItem=plot.data("plotItem"),center=plotItem.center,rolloverProps=plotItem.rolloverProperties||{},color=hover?rolloverProps.color:plotItem.color,borderWidth=hover?rolloverProps.borderWidth:plotItem.borderWidth,borderColor=hover?rolloverProps.borderColor:plotItem.borderColor;if(color){if(hover){color.cx=center[0];color.cy=center[1];color.r=plotItem.radius}rolloverProps.enabled&&animationManager.setAnimation({el:plotItem.graphic,component:dataset,attr:{fill:toRaphaelColor(color),"stroke-width":borderWidth,stroke:borderColor}})}}}},sortArrayByPoint=function sortArrayByPoint(a,b){return a.point.config.value-b.point.config.value},sortArrayByAngle=function sortArrayByAngle(a,b){return a.angle-b.angle},labelClickFn=function labelClickFn(chart,link){link&&chart.getFromEnv("linkClickFN")&&chart.getFromEnv("linkClickFN").call({link:link},true)},hideFn=function hideFn(){this.hide()},removeFn=function removeFn(){this.remove()},ySign=[1,1,-1,-1],xSign=[1,-1,-1,1];function _trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,i,len,removeDataArr,legend=dataSet.getFromEnv("legend"),config,prevData=dataSet.config.JSONData,prevDataLength=prevData.data&&prevData.data.length,currDataLength=datasetJSON.data&&datasetJSON.data.length||0,dataDiff=prevDataLength-currDataLength;if(dataDiff>0){dataSet.removeData(currDataLength,dataDiff,false)}removeDataArr=dataSet.components.removeDataArr||[];for(i=0,len=removeDataArr.length;i<len;i++){config=removeDataArr[i].config;config.legendItemId&&legend.disposeItem(config.legendItemId)}}addDep({name:"pie2dAnimation",type:"animationRule",extension:pie2dAnimation});raphaelShapesRingpath(Raphael);var Pie2DDataset=function(_AreaDataset){_inheritsLoose(Pie2DDataset,_AreaDataset);function Pie2DDataset(){var _this;_this=_AreaDataset.call(this)||this;_this.plotGraphicClick=plotGraphicClick(_assertThisInitialized(_this));return _this}var _proto=Pie2DDataset.prototype;_proto.getType=function getType(){return"dataset"};_proto.getName=function getName(){return"pie2D"};_proto.__setDefaultConfig=function __setDefaultConfig(){_AreaDataset.prototype.__setDefaultConfig.call(this);this.config.doughnutradius=0};_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return false}this.trimData(datasetJSON);this.config.JSONData=datasetJSON;var dataSet=this,chart=dataSet.getFromEnv("chart"),chartConfig=chart.config,conf=dataSet.config,JSONData=dataSet.config.JSONData,chartAttr=dataSet.getFromEnv("chart-attrib"),is3D=chart.config.is3D,isPie=/pie/.test(dataSet.getName()),radius3D,use3DLighting,toolTipSepChar,enableMultiSlicing,enableAnimation;conf.handlersAPI=handlers(dataSet);dataSet.setState("visible",pluckNumber(dataSet.config.JSONData.visible,!Number(dataSet.config.JSONData.initiallyhidden),1)===1);parseConfiguration({},dataSet.config,chart&&chart.config);enableAnimation=conf.enableAnimation=pluckNumber(chartAttr.animation,chartAttr.defaultanimation,1);conf.animation=!enableAnimation?false:{duration:pluckNumber(chartAttr.animationduration,chartAttr.moveduration,1)*1e3};conf.transposeAnim=!enableAnimation&&!pluckNumber(conf.transposeanimation,1)?false:{duration:pluckNumber(chartAttr.transposeanimduration,.2)*1e3};conf.showPlotBorder=pluckNumber(chartAttr.showplotborder,1);conf.showHoverEffect=pluckNumber(chartAttr.plothovereffect,chartAttr.showhovereffect,UNDEF);conf.showTooltip=pluckNumber(chartAttr.showtooltip,1);conf.toolText=getValidValue(parseUnsafeString(pluck(JSONData.plottooltext,chartAttr.plottooltext)));enableMultiSlicing=conf.enableMultiSlicing=pluckNumber(chartAttr.enablemultislicing,1);use3DLighting=conf.use3DLighting=pluckNumber(chartAttr.use3dlighting,1);radius3D=conf.radius3D=use3DLighting?pluckNumber(chartAttr.radius3d,90):100;conf.showZeroPies=pluckNumber(chartAttr.showzeropies,1);conf.showPercentInToolTip=pluckNumber(chartAttr.showpercentintooltip,1);conf.showLabels=pluckNumber(chartAttr.showlabels,1);conf.showTextOutline=pluckNumber(chartAttr.textoutline,0);conf.showValues=pluckNumber(JSONData.showvalues,chartAttr.showvalues,1);conf.showPercentValues=pluckNumber(chartAttr.showpercentvalues,chartAttr.showpercentagevalues,0);toolTipSepChar=conf.toolTipSepChar=pluck(chartAttr.tooltipsepchar,chartAttr.hovercapsepchar,COMMASPACE);conf.labelSepChar=pluck(chartAttr.labelsepchar,toolTipSepChar);conf.pieBorderColor=pluck(chartAttr.plotbordercolor,chartAttr.piebordercolor);conf.pieBorderAlpha=pluckNumber(chartAttr.plotborderalpha,chartAttr.pieborderalpha);conf.pieBorderThickness=conf.showPlotBorder?pluckNumber(chartAttr.plotborderthickness,chartAttr.pieborderthickness,chartConfig.plotborderthickness,1):0;conf.plotDashLen=pluckNumber(chartAttr.plotborderdashlen,5);conf.plotDashGap=pluckNumber(chartAttr.plotborderdashgap,4);conf.showValueInLegend=pluckNumber(chartAttr.showvalueinlegend,0);conf.showLabelInLegend=pluckNumber(chartAttr.showlabelinlegend,1);conf.valueBeforeLabelInLegend=pluckNumber(chartAttr.valuebeforelabelinlegend,0);conf.showValueAsPercentInLegend=pluckNumber(chartAttr.showvalueaspercentinlegend,1);conf.legendSepChar=pluck(chartAttr.legendsepchar,", ");conf.showvalues=pluckNumber(chartAttr.showvalues,1);conf.chartPosition=getPosition(chart.getFromEnv("chart-container"),chart);conf.timerThreshold=30;if(radius3D>100){radius3D=100}if(radius3D<0){radius3D=0}conf.showLegend=pluckNumber(chartAttr.showlegend,0);conf.reverselegend=!pluckNumber(chartAttr.reverselegend,0);chart.config.is3D=is3D;conf.pieYScale=pluckNumber(chartAttr.pieyscale,40);if(conf.pieYScale<1){conf.pieYScale=1}if(conf.pieYScale>=100){conf.pieYScale=80}conf.pieYScale/=100;conf.pieSliceDepth=pluckNumber(chartAttr.pieslicedepth,15);if(conf.pieSliceDepth<1){conf.pieSliceDepth=1}conf.managedPieSliceDepth=conf.pieSliceDepth;conf.enableMultiSlicing=!!enableMultiSlicing;conf.startAngle=pluckNumber(chartAttr.startingangle,0)%360*-(pi/180);conf.usePerPointLabelColor=chartAttr.colorlabelsfromplot===ONESTRING;conf.reversePlotOrder=pluckNumber(chartAttr.reverseplotorder,0);conf.animateClockWise=pluckNumber(chartAttr.animateclockwise,conf.reversePlotOrder);conf.showShadow=pluckNumber(chartAttr.showshadow,1);conf.innerLabelRadiusPercent=pluckNumber(chartAttr.innerlabelradiuspercent,67)/100;conf.minAngleForValue=pluckNumber(chartAttr.minangleforvalue,0)*(pi/180);conf.minAngleForLabel=pluckNumber(chartAttr.minangleforlabel,0)*(pi/180);conf.singletonCase=JSONData.data.length===1;conf.labelPosition=pluck(chartAttr.labelposition,conf.singletonCase&&isPie?INSIDE:OUTSIDE).toLowerCase();conf.valuePosition=pluck(chartAttr.valueposition,conf.singletonCase&&isPie?INSIDE:OUTSIDE).toLowerCase();conf.valueTotal=0;dataSet._setConfigure();chartConfig.showLegend&&dataSet._addLegend()};_proto.trimData=function trimData(datasetJSON){_trimData.call(this,datasetJSON)};_proto._parseDisplayProperties=function _parseDisplayProperties(dataJSON,config){var setTooltext,pValue,toolText=BLANKSTRING,TTValue,value,labelText,displayValueText,displayValue,displayValueArgs,showValue,dataSet=this,chart=dataSet.getFromEnv("chart"),numberFormatter=dataSet.getFromEnv("number-formatter"),chartAttr=chart.getFromEnv("chart-attrib"),conf=dataSet.config,dataValue=pluckNumber(config.y,numberFormatter.getCleanValue(dataJSON.value,true)),totalValue=conf.valueTotal,showLabels=conf.showLabels,name=parseUnsafeString(pluck(config.seriesName,dataJSON.label,dataJSON.name,BLANKSTRING)),showPercentValues=conf.showPercentValues,showPercentInToolTip=conf.showPercentInToolTip,minAngleForLabel,minAngleForValue,labelSepChar=conf.labelSepChar,toolTipSepChar=conf.toolTipSepChar,showTooltip=conf.showTooltip;setTooltext=getValidValue(parseUnsafeString(pluck(dataJSON.tooltext,conf.toolText)));pValue=config.pValue=numberFormatter.percentValue(dataValue/totalValue*100);value=config.value=numberFormatter.dataLabels(dataValue)||BLANKSTRING;labelText=config.labelText=pluckNumber(dataJSON.showlabel,showLabels)===1?name:BLANKSTRING;displayValueText=config.valueText=(showValue=pluckNumber(dataJSON.showvalue,conf.showValues))===1?showPercentValues===1?pValue:value:BLANKSTRING;TTValue=showPercentInToolTip?pValue:value;displayValue=getValidValue(parseUnsafeString(dataJSON.displayvalue));config.labelPosition=pluck(dataJSON.labelposition,conf.labelPosition).toLowerCase();config.valuePosition=pluck(dataJSON.valueposition,conf.valuePosition).toLowerCase();minAngleForLabel=pluckNumber(dataJSON.minangleforlabel);if(!isNaN(minAngleForLabel)){config.minAngleForLabel=minAngleForLabel%360*(pi/180)}else{config.minAngleForLabel=conf.minAngleForLabel}minAngleForValue=pluckNumber(dataJSON.minangleforvalue);if(!isNaN(minAngleForValue)){config.minAngleForValue=minAngleForValue%360*(pi/180)}else{config.minAngleForValue=conf.minAngleForValue}config.innerLabelRadiusPercent=pluckNumber(dataJSON.innerlabelradiuspercent,conf.innerLabelRadiusPercent);displayValueArgs=pluck(displayValue,name+labelSepChar+(showPercentValues?pValue:value),BLANKSTRING);if(displayValue!==UNDEF&&showValue){displayValueText=displayValue}else{if(displayValueText!==BLANKSTRING&&labelText!==BLANKSTRING){displayValueText=labelText+labelSepChar+displayValueText}else{displayValueText=pluck(labelText,displayValueText)}}if(showTooltip){if(setTooltext!==UNDEF){toolText=parseTooltext(setTooltext,[1,2,3,5,6,7,14,24,25],{formattedValue:value,label:name,yaxisName:parseUnsafeString(chartAttr.yaxisname),xaxisName:parseUnsafeString(chartAttr.xaxisname),percentValue:pValue,sum:numberFormatter.dataLabels(totalValue),unformattedSum:totalValue},dataJSON,chartAttr)}else{toolText=name;if(toolText!==BLANKSTRING){toolText=toolText+toolTipSepChar+TTValue}else{toolText=TTValue}}}config.displayValue=displayValueText;config.displayValueArgs=displayValueArgs;config.toolText=toolText;config.seriesName=name;config.categoryLabel=name};_proto._isStyled=function _isStyled(dataJSON){var dataSet=this,chart=dataSet.getFromEnv("chart"),chartConfig=chart.config;if(chartConfig.usedataplotcolorforlabels||dataJSON.labelbordercolor||dataJSON.labelbgcolor||dataJSON.labelborderthickness||dataJSON.labelborderalpha||dataJSON.labelalpha||dataJSON.labelfont||dataJSON.labelfontsize||dataJSON.labelfontcolor||dataJSON.labelfontalpha||dataJSON.labelalpha||dataJSON.labelfontbold||dataJSON.labelfontitalic||dataJSON.labelborderpadding||dataJSON.labelborderradius||dataJSON.labelbgalpha||dataJSON.labelborderdashed||dataJSON.labelborderdashlen||dataJSON.labelborderdashgap){return true}};_proto._setConfigure=function _setConfigure(newDataset,newIndex){var index,name,setColor,setAlpha,borderConfig,setPlotBorderColor,setPlotBorderAlpha,pointShadow,legendText,legValue,isSliced,centerLabelConfig,setBorderDashed,pointDashStyle,dataObj,tempIndex,config,dataValue,dataConfig,dataJSON,dataSet=this,dataSetComponents=dataSet.components,removeDataArr=dataSetComponents.removeDataArr=dataSetComponents.removeDataArr||[],chart=dataSet.getFromEnv("chart"),chartAttr=chart.getFromEnv("dataSource").chart,chartConfig=chart.config,conf=dataSet.config,JSONData=dataSet.config.JSONData,setDataArr=(newDataset||JSONData).data,setDataLen=setDataArr&&setDataArr.length,showZeroPies=conf.showZeroPies,totalValue=conf.valueTotal||0,dataArr=[],plotBorderDash=pluckNumber(chartAttr.plotborderdashed,0),dataStore=dataSet.components.data||(dataSet.components.data=[]),numberFormatter=dataSet.getFromEnv("number-formatter"),colorM=dataSet.getFromEnv("color-manager"),labelInLeg=conf.labelInLeg,valInLeg=conf.valInLeg,setBorderWidth=conf.pieBorderThickness,reversePlotOrder=conf.reversePlotOrder,radius3D=conf.radius3D,enableMultiSlicing=conf.enableMultiSlicing,lastSlicedid=conf.lastSlicedid||0,seriesDashLen=pluckNumber(chartAttr.plotBorderDashed,5),seriesDashGap=pluckNumber(chartAttr.plotborderdashgap,4),valBefore=pluckNumber(chartAttr.valuebeforelabelinlegend,0),valAsPerInLeg=pluckNumber(chartAttr.showvalueaspercentinlegend,1),nullCount=0,sepChar=pluck(chartAttr.legendsepchar,", ");chartConfig.dataLabelStyle=parsexAxisStyles({},{},chartAttr,chartConfig.dataLabelStyle,setColor);for(index=0;index<setDataLen;index+=1){dataObj=setDataArr[index];dataValue=numberFormatter.getCleanValue(dataObj.value,true);if(!(dataValue===null||!showZeroPies&&dataValue===0)){dataArr.push(dataObj);totalValue+=dataValue}else{nullCount+=1}}!conf.singletonCase&&(conf.singletonCase=setDataLen-nullCount===1);if(nullCount&&dataStore.length>setDataLen-nullCount){for(index=dataStore.length-1;nullCount>0;index-=1,nullCount-=1){if(dataStore[index]){dataObj=dataStore[index];dataConfig=dataObj.config;removeDataArr.push(dataObj);dataConfig.y=null}}}if(totalValue===0){dataArr=[]}conf.valueTotal=totalValue;conf.dataLabelCounter=0;chartConfig.allPlotSliceEnabled=chartConfig.enableslicing;for(index=(setDataLen=dataArr.length)-1;index>=0;index-=1){tempIndex=index;if(newDataset){dataJSON=dataArr[index];if(newIndex!==UNDEF){tempIndex=newIndex+index;dataObj=dataStore[tempIndex]}else{tempIndex=dataStore.length-setDataLen+index;dataObj=dataStore[tempIndex]}}else{dataObj=dataStore[index]||(dataStore[index]={graphics:{},config:{}});dataJSON=dataArr[index]}config=dataObj&&dataObj.config;if(!config){config=dataStore[tempIndex].config={}}if(!dataObj.graphics){dataStore[tempIndex].graphics={}}config.y=dataValue=numberFormatter.getCleanValue(dataJSON.value,true);config.seriesName=name=parseUnsafeString(pluck(dataJSON.label,dataJSON.name,BLANKSTRING));config.labellink=pluck(dataJSON.labellink,chartAttr.labellink);setColor=pluck(dataJSON.color,colorM.getPlotColor(index));setAlpha=pluck(dataJSON.alpha,chartAttr.plotfillalpha,HUNDREDSTRING);borderConfig=config.borderConfig=dataSet._parseBorderConfig(setColor,setAlpha,dataJSON);setPlotBorderColor=borderConfig.setPlotBorderColor;setPlotBorderAlpha=borderConfig.setPlotBorderAlpha;pointShadow={opacity:mathMax(setAlpha,setPlotBorderAlpha)/100};isSliced=Boolean(pluckNumber(dataJSON.issliced,chartAttr.issliced,0));if(isSliced){if(!enableMultiSlicing){if(lastSlicedid!==-1){dataStore[dataStore.length-lastSlicedid-1].sliced=false}conf.lastSlicedid=index}conf.preSliced=isSliced}setBorderDashed=pluckNumber(dataJSON.dashed,plotBorderDash);pointDashStyle=setBorderDashed?getDashStyle(pluck(dataJSON.dashlen,seriesDashLen),pluck(dataJSON.dashgap,seriesDashGap),setBorderWidth):DASH_DEF;dataSet._parseDisplayProperties(dataJSON,config);legendText=labelInLeg?name:BLANKSTRING;if(valInLeg){legValue=valAsPerInLeg?numberFormatter.legendPercentValue(dataValue/totalValue*100):numberFormatter.legendValue(dataValue);legendText=valBefore?legValue+(legendText&&sepChar+legendText):(legendText&&legendText+sepChar)+legValue}conf.dataLabelCounter+=1;if(dataSet._isStyled(dataJSON)){config.style=parsexAxisStyles(dataJSON,{},chartAttr,chartConfig.dataLabelStyle,setColor)}else if(config.style){delete config.style}config.showInLegend=legendText!==BLANKSTRING;config.isVisible=true;config.name=legendText;config.shadow=pointShadow;config.setColor=setColor;config.color=pointColor(setColor,setAlpha,radius3D,conf.doughnutradius);config._3dAlpha=setAlpha;config.borderColor=convertColor(setPlotBorderColor,setPlotBorderAlpha);config.borderWidth=setBorderWidth;config.link=getValidValue(dataJSON.link);config.sliced=isSliced;config.dashStyle=pointDashStyle;if(!(config.doNotSlice=pluck(dataJSON.enableslicing,chartConfig.enableslicing)!==ONESTRING)&&chartConfig.allPlotSliceEnabled===ZEROSTRING){chartConfig.allPlotSliceEnabled=ONESTRING}dataSet._parseHoverEffectOptions(index);config.centerLabelConfig=centerLabelConfig;config.radius3D=radius3D}if(reversePlotOrder){dataStore&&dataStore.reverse()}conf.dataArr=dataArr;conf.enableRotation=dataStore.length>1?pluckNumber(chartAttr.enablerotation,1):0};_proto._parseHoverEffectOptions=function _parseHoverEffectOptions(index){var highlight,hoverColor,hoverAlpha,hoverBorderColor,hoverBorderAlpha,hoverBorderThickness,isHoverColorString,highlightColors,hColorsLen,hColorsLoop,dataSet=this,chart=dataSet.getFromEnv("chart"),chartAttr=chart.getFromEnv("dataSource").chart,conf=dataSet.config,config=dataSet.components.data[index].config,JSONData=dataSet.config.JSONData,dataJSON=JSONData.data[index],setColor=config.setColor,setAlpha=config._3dAlpha,radius3D=conf.radius3D,borderConfig=config.borderConfig,setPlotBorderAlpha=borderConfig.setPlotBorderAlpha,setPlotBorderColor=borderConfig.setPlotBorderColor,setBorderWidth=conf.setBorderWidth,hoverEffect=pluckNumber(config.hovereffect,conf.showHoverEffect),hoverEffects=config.hoverEffects={enabled:hoverEffect};if(hoverEffect===UNDEF){hoverEffect=hoverEffects.enabled=pluck(dataJSON.hovercolor,JSONData.hovercolor,chartAttr.plotfillhovercolor,dataJSON.hoveralpha,JSONData.hoveralpha,chartAttr.plotfillhoveralpha,dataJSON.borderhovercolor,JSONData.borderhovercolor,chartAttr.plotborderhovercolor,dataJSON.borderhoveralpha,JSONData.borderhoveralpha,chartAttr.plotborderhoveralpha,chartAttr.plotfillhoveralpha,dataJSON.borderhoverthickness,JSONData.borderhoverthickness,chartAttr.plotborderhoverthickness,UNDEF)!==UNDEF}if(hoverEffect){highlight=pluckNumber(dataJSON.highlightonhover,JSONData.highlight,chartAttr.highlight,1);hoverColor=pluck(dataJSON.hovercolor,JSONData.hovercolor,chartAttr.plotfillhovercolor);if(hoverColor&&highlight){highlight=0}hoverColor=pluck(hoverColor,setColor);hoverAlpha=pluck(dataJSON.hoveralpha,JSONData.hoveralpha,chartAttr.plotfillhoveralpha,setAlpha);hoverBorderColor=pluck(dataJSON.borderhovercolor,JSONData.borderhovercolor,chartAttr.plotborderhovercolor,setPlotBorderColor);hoverBorderAlpha=pluck(dataJSON.borderhoveralpha,JSONData.borderhoveralpha,chartAttr.plotborderhoveralpha,chartAttr.plotfillhoveralpha,setPlotBorderAlpha);hoverBorderThickness=pluckNumber(dataJSON.borderhoverthickness,JSONData.borderhoverthickness,chartAttr.plotborderhoverthickness,setBorderWidth);hoverColor.replace(/,+?$/,"");if(highlight===1){isHoverColorString=typeof hoverColor==="string";highlightColors=isHoverColorString?hoverColor.split(/\s{0,},\s{0,}/):hoverColor.color.split(/\s{0,},\s{0,}/);hColorsLen=highlightColors.length;for(hColorsLoop=0;hColorsLoop<hColorsLen;hColorsLoop++){highlightColors[hColorsLoop]=getLightColor(highlightColors[hColorsLoop],70)}if(isHoverColorString){hoverColor=highlightColors.join(",")}else{hoverColor.color=highlightColors.join(",")}}dataSet._setHoverColor(hoverEffects,hoverColor,hoverAlpha,radius3D);hoverEffects.alpha=hoverAlpha;hoverEffects.borderColor=convertColor(hoverBorderColor,hoverBorderAlpha);hoverEffects.borderAlpha=hoverBorderAlpha;hoverEffects.borderWidth=hoverBorderThickness}else{hoverEffects.enabled=false}};_proto.organizeDatalabels=function organizeDatalabels(){var dataset=this,dsConfig=dataset.config,data=dataset.components.data,labelsPlacedOutside=[],labelsPlacedInside=[],i,len=data.length,pointConfig,quadrantAr,labelPosition,valuePosition;for(i=0;i<len;i++){pointConfig=data[i].config;labelPosition=pointConfig.labelPosition;valuePosition=pointConfig.valuePosition;if(pointConfig.y===null||typeof pointConfig.y==="undefined"||pointConfig.isVisible===false){continue}if(labelPosition===OUTSIDE&&valuePosition===OUTSIDE){labelsPlacedOutside.push({point:data[i]})}else if(labelPosition===INSIDE&&valuePosition===INSIDE){labelsPlacedInside.push({point:data[i]})}else{labelsPlacedOutside.push({point:data[i]});labelsPlacedInside.push({point:data[i]})}}quadrantAr=segregateLabelsInQuadrant(labelsPlacedOutside);dsConfig.labelsPlacedOutside=dataset.skipOverlappingLabels(quadrantAr);dsConfig.labelsPlacedInside=labelsPlacedInside;this.rotateDataLabels()};_proto.skipOverlappingLabels=function skipOverlappingLabels(_quadrantAr){var quadrantAr=_quadrantAr,dataset=this,dsConfig=dataset.config,dataLabelOptions=dsConfig.dataLabelOptions,labelsRadius=dataLabelOptions.distance+dsConfig.pieMinRadius,extraLabels,i,j,len,labelLineHeight,eligibleLabelAr=[],labelsMaxInQuadrant;labelLineHeight=dsConfig.labelLineHeight=parseInt(dataLabelOptions.style.fontSize,10);dsConfig.labelsMaxInQuadrant=labelsMaxInQuadrant=mathFloor(labelsRadius/labelLineHeight);for(i=0;i<QUADRANT_COUNT;i++){if(dataLabelOptions.skipOverlapLabels){extraLabels=quadrantAr[i].length-labelsMaxInQuadrant;if(extraLabels>0){quadrantAr[i].sort(sortArrayByPoint);extraLabels=quadrantAr[i].splice(0,extraLabels);for(j=0,len=extraLabels.length;j<len;j++){dataset.disposeLabelAndConnector(extraLabels[j].point.graphics,[{el:"label",animLabel:"label"},{el:"innerLabel",animLabel:"label"},{el:"connector",animLabel:"connector"}])}}}}for(i=0;i<QUADRANT_COUNT;i++){for(j=0,len=quadrantAr[i].length;j<len;j++){eligibleLabelAr.push(quadrantAr[i][j])}}return eligibleLabelAr};_proto.rotateDataLabels=function rotateDataLabels(){this.rotateOuterLabels();this.rotateInnerLabels()};_proto.rotateOuterLabels=function rotateOuterLabels(){var dataset=this,dsConfig=dataset.config,chart=dataset.getFromEnv("chart"),animationManager=chart.getFromEnv("animationManager"),legend=chart.getChildren("legend")[0],legendConfig=legend&&legend.config||{},smartLabel=dataset.getFromEnv("smartLabel"),smartLabelObj,chartConfig=chart.config,dataLabelOptions=dsConfig.dataLabelOptions,labelLineHeight=dsConfig.labelLineHeight,pieRadius=dsConfig.pieMinRadius,_chart$config=chart.config,canvasLeft=_chart$config.canvasLeft,canvasWidth=_chart$config.canvasWidth,useEllipsesWhenOverflow=_chart$config.useEllipsesWhenOverflow,connectorPadding=dataLabelOptions.connectorPadding,manageLabelOverflow=dataLabelOptions.manageLabelOverflow,distance=dataLabelOptions.distance,enableSmartLabels=dataLabelOptions.enableSmartLabels,quadrantAr=segregateLabelsInQuadrant(dsConfig.labelsPlacedOutside),labelsRadius=distance+pieRadius,mostPopulatedQuadrantCount=mathMax(quadrantAr[0].length,quadrantAr[1].length,quadrantAr[2].length,quadrantAr[3].length),quadrantRadius,cx=canvasLeft+canvasWidth*.5,cy=chartConfig.canvasTop+chartConfig.canvasHeight*.5,_dsConfig$handlersAPI=dsConfig.handlersAPI,plotDragStart=_dsConfig$handlersAPI.plotDragStart,plotDragEnd=_dsConfig$handlersAPI.plotDragEnd,plotDragMove=_dsConfig$handlersAPI.plotDragMove,plotRollOver=_dsConfig$handlersAPI.plotRollOver,plotRollOut=_dsConfig$handlersAPI.plotRollOut,i,q,len,point,oriY,oriX,unslicedX,unslicedY,firstPassY=[],secondPassY=[],maxAllowedWidth,tooltext,toolTipController=dataset.getFromEnv("toolTipController"),labelGroup=dataset.getContainer("label-group"),pointConfig,pointGraphics,connectorAttr,connectorPath,quadItem,sliceMidPoint,minYPossible,maxYPossible,textAttrs,connector,connectorCheck,dataLabel,dataLabelCheck;quadrantRadius=mathMax(mathMin(mostPopulatedQuadrantCount,dsConfig.labelsMaxInQuadrant)*labelLineHeight,labelsRadius+labelLineHeight);for(i=0;i<QUADRANT_COUNT;i++){quadrantAr[i].sort(sortArrayByAngle)}quadrantAr[0].reverse();quadrantAr[2].reverse();for(q=0;q<QUADRANT_COUNT;q++){maxYPossible=quadrantRadius;minYPossible=quadrantAr[q].length*labelLineHeight;firstPassY=[];for(i=0,len=quadrantAr[q].length;i<len;i++){quadItem=quadrantAr[q][i];oriY=mathAbs(quadrantRadius*mathSin(quadItem.angle));if(oriY>maxYPossible){oriY=maxYPossible}else if(oriY<minYPossible){oriY=minYPossible}minYPossible-=labelLineHeight;maxYPossible=oriY-labelLineHeight;firstPassY.push(oriY)}minYPossible=0;maxYPossible=quadrantRadius-(len-1)*labelLineHeight;secondPassY=[];for(i=quadrantAr[q].length-1;i>=0;i--){quadItem=quadrantAr[q][i];oriY=mathAbs(quadrantRadius*mathSin(quadItem.angle));if(oriY<minYPossible){oriY=minYPossible}else if(oriY>maxYPossible){oriY=maxYPossible}minYPossible=oriY+labelLineHeight;maxYPossible+=labelLineHeight;secondPassY.push(oriY)}for(i=0;i<len;i++){oriY=mathMin(quadrantRadius,(firstPassY[i]+secondPassY[len-1-i])/2);oriX=quadrantRadius*mathCos(Math.asin(oriY/quadrantRadius));quadItem=quadrantAr[q][i];point=quadItem.point;pointConfig=point.config;pointGraphics=point.graphics;connectorAttr=pointConfig.props.connector.attr;tooltext=BLANKSTRING;textAttrs=Object.assign({},pointConfig.props.label.attr);textAttrs["text-anchor"]=q===0||q===3?"start":"end";textAttrs.y=unslicedY=cy+ySign[q]*oriY;textAttrs.x=unslicedX=cx+xSign[q]*(oriX+2*connectorPadding);if(pointConfig.sliced){textAttrs.y+=pointConfig.transY;textAttrs.x+=pointConfig.transX}if(pointConfig.labelPosition===OUTSIDE&&pointConfig.valuePosition===OUTSIDE){dataset.disposeLabelAndConnector(pointGraphics,[{el:"innerLabel",animLabel:"label"}])}else{textAttrs.text=pointConfig.labelPosition===OUTSIDE?pointConfig.labelText:pointConfig.valueText}if(textAttrs.text){sliceMidPoint={x:cx+pieRadius*mathCos(quadItem.angle),y:cy+pieRadius*mathSin(quadItem.angle)};connectorPath=pointConfig.connectorPath=getConnectorPath(sliceMidPoint,{x:cx+xSign[q]*oriX,y:cy+ySign[q]*oriY},{isSlanted:dataLabelOptions.isSmartLineSlanted,padding:connectorPadding,quadrant:q,transX:pointConfig.sliced?pointConfig.transX:0,transY:pointConfig.sliced?pointConfig.transY:0});if(manageLabelOverflow){maxAllowedWidth=q===1||q===2?textAttrs.x-canvasLeft:canvasLeft+canvasWidth-textAttrs.x;if(legendConfig.align==="right"||legendConfig.align==="left"){maxAllowedWidth-=legendConfig.symbolWidth+2*legendConfig.borderWidth}smartLabel.useEllipsesOnOverflow(useEllipsesWhenOverflow);smartLabel.setStyle(pointConfig.style);smartLabelObj=smartLabel.getSmartText(textAttrs.text,maxAllowedWidth,parseFloat(smartLabel.style.lineHeight));textAttrs.text=smartLabelObj.text;tooltext=smartLabelObj.tooltext}dataLabelCheck=pointGraphics.label;pointGraphics.label=dataLabel=animationManager.setAnimation({el:dataLabelCheck||"text",attr:textAttrs,css:pointConfig.props.label.css,component:dataset,container:labelGroup,label:"label"});dataLabel.outlineText(dsConfig.showTextOutline,textAttrs.fill);if(!dataLabelCheck){dataLabel.on("fc-dragstart",plotDragStart).on("fc-dragmove",plotDragMove).on("fc-dragend",plotDragEnd).on("fc-click",labelClickFn.bind(dataLabel,chart,pointConfig.labellink)).on("fc-click",plotClickHandler(dataset,dataLabel)).on("fc-mouseover",plotRollOver).on("fc-mouseout",plotRollOut)}if(tooltext){tooltext&&toolTipController.enableToolTip(dataLabel,tooltext)}else{toolTipController.disableToolTip(dataLabel)}dataLabel.x=unslicedX;dataLabel.y=unslicedY;dataLabel&&dataLabel.data("textPos",{x:textAttrs.x,y:textAttrs.y}).data("plotItem",pointConfig.plotItem).data(EVENTARGS,pointConfig.eventArgs);connectorCheck=pointGraphics.connector;if(enableSmartLabels){pointGraphics.connector=connector=animationManager.setAnimation({el:connectorCheck||"path",attr:_extends({path:connectorPath},connectorAttr),container:labelGroup,component:dataset,label:"connector"});if(!connectorCheck){connector.on("fc-dragstart",plotDragStart).on("fc-dragmove",plotDragMove).on("fc-dragend",plotDragEnd).on("fc-mouseover",plotRollOver).on("fc-mouseout",plotRollOut)}connector.data("connectorPath",{path:connectorPath}).data("plotItem",pointConfig.plotItem).data(EVENTARGS,pointConfig.eventArgs)}else if(connectorCheck){dataset.disposeLabelAndConnector(pointGraphics,[{el:"connector",animLabel:"connector"}])}}else{dataset.disposeLabelAndConnector(pointGraphics,[{el:"label",animLabel:"label"},{el:"connector",animLabel:"connector"}])}}}};_proto.rotateInnerLabels=function rotateInnerLabels(){var dataset=this,dsConfig=dataset.config,pointAr=dsConfig.labelsPlacedInside,pieCenter=dsConfig.pieCenter,animationManager=dataset.getFromEnv("animationManager"),cx=pieCenter[0],cy=pieCenter[1],unslicedX,unslicedY,i,len=pointAr.length,oriDataLen=dataset.components.data.length,_dsConfig$handlersAPI2=dsConfig.handlersAPI,plotDragStart=_dsConfig$handlersAPI2.plotDragStart,plotDragEnd=_dsConfig$handlersAPI2.plotDragEnd,plotDragMove=_dsConfig$handlersAPI2.plotDragMove,plotRollOver=_dsConfig$handlersAPI2.plotRollOver,plotRollOut=_dsConfig$handlersAPI2.plotRollOut,point,pointConfig,pointGraphics,angle,radius,minAngleForLabel,minAngleForValue,sectorAngle,textAttrs,dataLabel,dataLabelCheck;for(i=0;i<len;i++){point=pointAr[i].point;pointConfig=point.config;pointGraphics=point.graphics;textAttrs=Object.assign({},pointConfig.props.label.attr);sectorAngle=mathAbs(pointConfig.startAngle-pointConfig.endAngle);minAngleForLabel=pointConfig.minAngleForLabel;minAngleForValue=pointConfig.minAngleForValue;if(pointConfig.valuePosition===INSIDE&&pointConfig.labelPosition===INSIDE){dataset.disposeLabelAndConnector(pointGraphics,[{el:"label",animLabel:"label"},{el:"connector",animLabel:"connector"}]);if(sectorAngle>=minAngleForValue&&sectorAngle<minAngleForLabel){textAttrs.text=pointConfig.valueText}else if(sectorAngle<minAngleForValue&&sectorAngle>=minAngleForLabel){textAttrs.text=pointConfig.labelText}else if(sectorAngle<minAngleForValue&&sectorAngle<minAngleForLabel){textAttrs.text=BLANKSTRING}}else{if(pointConfig.valuePosition===INSIDE){textAttrs.text=sectorAngle>=minAngleForValue?pointConfig.valueText:BLANKSTRING}else{textAttrs.text=sectorAngle>=minAngleForLabel?pointConfig.labelText:BLANKSTRING}}if(textAttrs.text){radius=dsConfig.pieMinRadius*pointConfig.innerLabelRadiusPercent;angle=getCleanAngle(pointConfig.angle);textAttrs.x=unslicedX=cx+(oriDataLen>1?radius*mathCos(angle):0);textAttrs.y=unslicedY=cy+(oriDataLen>1?radius*mathSin(angle):0);if(pointConfig.sliced){textAttrs.y+=pointConfig.transY;textAttrs.x+=pointConfig.transX}textAttrs["text-anchor"]=MIDDLE_STR;dataLabelCheck=pointGraphics.innerLabel;pointGraphics.innerLabel=dataLabel=animationManager.setAnimation({el:dataLabelCheck||"text",attr:textAttrs,css:pointConfig.props.label.css,component:dataset,container:dataset.getContainer("label-group"),label:"label"});dataLabel.outlineText(dsConfig.showTextOutline,textAttrs.fill);if(!dataLabelCheck){dataLabel.on("fc-dragstart",plotDragStart).on("fc-dragmove",plotDragMove).on("fc-dragend",plotDragEnd).on("fc-click",labelClickFn.bind(dataLabel,dataset.getFromEnv("chart"),pointConfig.labellink)).on("fc-click",plotClickHandler(dataset,dataLabel)).on("fc-mouseover",plotRollOver).on("fc-mouseout",plotRollOut)}dataLabel.x=unslicedX;dataLabel.y=unslicedY;dataLabel&&dataLabel.data("textPos",{x:textAttrs.x,y:textAttrs.y}).data("plotItem",pointConfig.plotItem).data(EVENTARGS,pointConfig.eventArgs)}else{dataset.disposeLabelAndConnector(pointGraphics,[{el:"innerLabel",animLabel:"label"}])}}};_proto.disposeLabelAndConnector=function disposeLabelAndConnector(pointGraphics,props){if(props===void 0){props=[]}var dataset=this,animationManager=dataset.getFromEnv("animationManager"),i,len=props.length,prop,el;for(i=0;i<len;i++){prop=props[i];el=prop.el;pointGraphics[el]&&(pointGraphics[el]=animationManager.setAnimation({el:pointGraphics[el],component:dataset,label:prop.animLabel}));delete pointGraphics[el]}};_proto._setHoverColor=function _setHoverColor(hoverEffects,hoverColor,hoverAlpha,radius3D){var dataSet=this;if(radius3D){hoverEffects.color=pointColor(hoverColor,hoverAlpha,radius3D,dataSet.config.doughnutradius)}else{hoverEffects.color=hoverColor;hoverEffects.alpha=hoverAlpha}};_proto.updateData=function updateData(){var dataSet=this,conf=dataSet.config,dataStore=dataSet.components.data;conf.valueTotal-=dataStore[arguments[1]].config.y;_AreaDataset.prototype.updateData.call(this,arguments)};_proto._rotate=function _rotate(){var _ringPath,_rotateAttrs,dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,plotData=dataSet.components.data,chartConfig=chart.config,piePlotOptions=conf.piePlotOptions,startAngle=(conf.startAngle||0)%pi2,slicedOffset=conf.slicingDistance,valueTotal=conf.valueTotal,factor=pi2/valueTotal,cx=chartConfig.canvasLeft+chartConfig.canvasWidth*.5,cy=chartConfig.canvasTop+chartConfig.canvasHeight*.5,r=conf.pieMinRadius,r2=(piePlotOptions.innerSize||0)*.5,val,angle,angle1,angle2,setConfig,setGraphics,i;angle1=angle2=startAngle;for(i=0;i<plotData.length;i+=1){setConfig=plotData[i].config;setGraphics=plotData[i].graphics;val=setConfig.y;if(val===null||val===UNDEF){continue}angle2=angle1;angle1-=!conf.singletonCase?val*factor:pi2;angle=(angle1+angle2)*.5;setConfig.angle=angle;setConfig.transX=mathCos(angle)*slicedOffset;setConfig.transY=mathSin(angle)*slicedOffset;setConfig.slicedTranslation=TRANSFORMSTR+mathCos(angle)*slicedOffset+COMMASTRING+mathSin(angle)*slicedOffset;if(!(_rotateAttrs=setConfig._rotateAttrs)){_rotateAttrs=setConfig._rotateAttrs={ringpath:[],transform:BLANKSTRING}}_ringPath=_rotateAttrs.ringpath;_ringPath[0]=cx;_ringPath[1]=cy;_ringPath[2]=r;_ringPath[3]=r2;_ringPath[4]=angle1;_ringPath[5]=angle2;setGraphics.element.attr({ringpath:_rotateAttrs.ringpath,transform:setConfig.sliced?setConfig.slicedTranslation:""})}dataSet.organizeDatalabels()};_proto._parsePiePlotOptions=function _parsePiePlotOptions(){var dataSet=this,conf=dataSet.config;return{size:conf.pieMinRadius,slicedOffset:conf.slicingDistance}};_proto._parseDataLabelOptions=function _parseDataLabelOptions(){return{style:this.getFromEnv("chart").config.dataLabelStyle}};_proto._addLegend=function _addLegend(){var i,config,dataObj,dataset=this,legend=dataset.getFromEnv("legend"),legendItem,configObject,dataStore=dataset.components.data;for(i=0;i<dataStore.length;i++){dataObj=dataStore[i];config=dataObj.config;if(config.y!==null&&config.seriesName){configObject={index:i,type:dataset.getName(),label:config.seriesName,enabled:pluckNumber(config.includeInLegend,1)};legendItem=legend.getItem(config.legendItemId);if(!legendItem){config.legendItemId=legend.createItem(dataset);legendItem=legend.getItem(config.legendItemId);dataset.addExtEventListener("fc-click",legendItem.itemClickFn,legendItem)}legendItem.configure(configObject);legendItem.setStateCosmetics("default",{symbol:{fill:toRaphaelColor(config.setColor),rawFillColor:config.setColor,stroke:toRaphaelColor(config.borderColor)}})}else{if(!config.legendItemId){continue}legendItem=legend.getItem(config.legendItemId);legendItem&&legend.disposeItem(legendItem.getId());delete config.legendItemId}}};_proto.getPlotData=function getPlotData(id,slicedState){var dataset=this,data=dataset.components.data[id].config,userData=dataset.config.userData||(dataset.config.userData=[]),plotData,value,prop;if(!userData[id]){plotData=userData[id]={};for(prop in data){typeof(value=data[prop])!=="object"&&typeof value!=="function"&&prop.indexOf("_")!==0&&(plotData[prop]=value)}plotData.value=plotData.y;plotData.categoryLabel=plotData.label=plotData.seriesName;delete plotData.y;delete plotData.total;delete plotData.doNotSlice;delete plotData.name;delete plotData.seriesName;delete plotData.centerAngle;delete plotData.showInLegend;delete plotData.angle;delete plotData.endAngle;delete plotData.isVisible;delete plotData.setColor;delete plotData.slicedTranslation;delete plotData.startAngle;delete plotData.transX;delete plotData.transY;delete plotData.pValue}else{plotData=userData[id]}plotData.sliced=slicedState;return plotData};_proto._parseBorderConfig=function _parseBorderConfig(setColor,setAlpha,dataJSON){var dataSet=this,conf=dataSet.config,pieBorderColor=conf.pieBorderColor,chart=dataSet.getFromEnv("chart"),chartAttr=chart.getFromEnv("dataSource").chart,setPlotBorderColor=pluck(dataJSON.bordercolor,pieBorderColor),setPlotBorderAlpha=pluck(dataJSON.borderalpha,chartAttr.plotborderalpha,chartAttr.pieborderalpha);setPlotBorderColor=pluck(setPlotBorderColor,getLightColor(setColor,25)).split(COMMASTRING)[0];setPlotBorderAlpha=chartAttr.showplotborder===ZEROSTRING?ZEROSTRING:pluck(setPlotBorderAlpha,setAlpha,"80");return{setPlotBorderColor:setPlotBorderColor,setPlotBorderAlpha:setPlotBorderAlpha}};_proto.legendInteractivity=function legendInteractivity(legendItem){var dataset=this,dataStore=dataset.components.data,len,i,legendItemId=legendItem.getId(),setGraphics,config;for(i=0,len=dataStore.length;i<len;i++){config=dataStore[i].config;if(config.legendItemId===legendItemId){setGraphics=dataStore[i].graphics;dataset.plotGraphicClick.call(setGraphics.element)}}};_proto._createContainer=function _createContainer(){var dataset=this,dsType=dataset.getName(),parentContainer,pieGroups,piePlotGroups,pieLabelGroups,groupName=dataset.groupName,parent=dataset.getLinkedParent(),group=groupName||dataset.dsGroup||dsType;!parent.getChildContainer(group+"Group")&&(group="default");parentContainer=parent.getChildContainer("datalabelsGroup");pieGroups=dataset.getContainer("pie-groups")||dataset.addContainer("pie-groups",createGroup("pie",parentContainer,dataset));piePlotGroups=dataset.getContainer("pie-plot-groups")||dataset.addContainer("pie-plot-groups",createGroup("pie-plot",pieGroups,dataset));pieLabelGroups=dataset.getContainer("pie-label-groups")||dataset.addContainer("pie-label-groups",createGroup("pie-label",pieGroups,dataset));dataset.getContainer("plot-group")||dataset.addContainer("plot-group",createGroup("plots",piePlotGroups,dataset));dataset.getContainer("plot-shadow-group")||dataset.addContainer("plot-shadow-group",createGroup("plot-shadows",piePlotGroups,dataset).toBack());dataset.getContainer("label-group")||dataset.addContainer("label-group",createGroup("labels",pieLabelGroups,dataset));dataset.getContainer("connector-shadow-group")||dataset.addContainer("connector-shadow-group",createGroup("connector-shadows",pieLabelGroups,dataset));dataset.getContainer("anchor-shadow-group")||dataset.addContainer("anchor-shadow-group",createGroup("anchor-shadows",pieLabelGroups,dataset))};_proto.allocatePosition=function allocatePosition(){var dataset=this,plotData=dataset.components.data,i,dataObj,len=plotData.length;for(i=0;i<len;i++){dataObj=plotData[i];dataset.parsePlotAttributes(dataObj,i);dataset.parseLabelAttributes(dataObj,i)}};_proto.parsePlotAttributes=function parsePlotAttributes(dataObj,index){var j,singleFillColor,dataSet=this,plotData=dataSet.components.data,chart=dataSet.getFromEnv("chart"),chartConfig=chart.config,conf=dataSet.config,i=index,toolText,setLink,ringPath,angle1,angle2,set,val,displayValue,sliced,color,angle,dataLength=plotData.length,canvasWidth=chartConfig.canvasWidth,canvasHeight=chartConfig.canvasHeight,cx=chartConfig.canvasLeft+canvasWidth*.5,cy=chartConfig.canvasTop+canvasHeight*.5,previousData,valueTotal=conf.valueTotal,factor,piePlotOptions=conf.piePlotOptions=dataSet._parsePiePlotOptions(),slicedOffset=piePlotOptions.slicedOffset,connector,r=piePlotOptions.size,r2=(conf.innerSize||0)*.5,startAngle=(conf.startAngle||0)%pi2,initialAngle,isTranspose,endAngle=startAngle-pi2,animateClockWise=conf.animateClockWise,setElAttr;factor=valueTotal&&pi2/valueTotal;conf.pieCenter=[cx,cy];angle1=startAngle;angle2=startAngle;if(index>0){angle1=plotData[index-1].config.startAngle;angle2=plotData[index-1].config.endAngle}set=dataObj.config;val=set.y;displayValue=set.displayValue;sliced=set.sliced;toolText=set.toolText;setLink=!!set.link;if(val===null||val===UNDEF||set.isVisible===false){return}color=set.color;color.r=r;color.cx=cx;color.cy=cy;angle2=angle1;angle1-=!conf.singletonCase?val*factor:pi2;angle=(angle1+angle2)*.5;if(isTranspose){if(i<dataLength){initialAngle=UNDEF;for(j=i+1;j<dataLength&&initialAngle===UNDEF;j+=1){initialAngle=plotData[j].config.endAngle}}if(initialAngle===UNDEF){initialAngle=endAngle}}else{initialAngle=animateClockWise?endAngle:startAngle}previousData=conf.previousData={cx:cx,cy:cy,r:r,r2:r2};ringPath=!dataSet.config.drawn?[cx,cy,r,r2,angle1,angle2]:[previousData.cx,previousData.cy,previousData.r,previousData.r2,angle1,angle2];set.eventArgs={index:conf.reversePlotOrder?dataLength-1-i:i,link:set.link,value:set.y,displayValue:set.displayValueArgs,categoryLabel:set.categoryLabel,isSliced:sliced,toolText:toolText,pValue:set.pValue};sliced&&(set.slicedTranslation="t"+mathCos(angle)*slicedOffset+","+mathSin(angle)*slicedOffset);setElAttr={"stroke-width":set.borderWidth,stroke:set.borderColor,fill:isVML||isTranspose&&singleFillColor?singleFillColorFn(set.color,conf.doughnutradius):toRaphaelColor(set.color),transform:sliced?set.slicedTranslation:"","stroke-dasharray":set.dashStyle,redrawDataLabels:startAngle,ringpath:ringPath,cursor:setLink?POINTER:""};set.props={element:{attr:setElAttr}};set.eventArgs={index:conf.reversePlotOrder?dataLength-1-i:i,link:set.link,value:set.y,displayValue:set.displayValueArgs,categoryLabel:set.categoryLabel,isSliced:sliced,toolText:toolText,pValue:set.pValue};set.plotItem={chart:chart,index:i,seriesData:conf,value:val,pValue:set.pValue,displayValue:set.displayValue||"",angle:set.angle=angle,angle1:set.startAngle=angle1,angle2:set.endAngle=angle2,slicedX:mathCos(angle)*slicedOffset,slicedY:mathSin(angle)*slicedOffset,sliced:sliced,labelText:displayValue,toolText:toolText,name:set.name,link:set.link,percentage:valueTotal?val*valueTotal/100:0,originalIndex:dataLength-i-1,style:set.style,color:toRaphaelColor(set.color),borderColor:set.borderColor,borderWidth:set.borderWidth,rolloverProperties:set.hoverEffects,radius:r,center:[cx,cy],innerDiameter:2*r2,centerLabelConfig:set.centerLabelConfig,isVisible:set.isVisible,label:set.seriesName,connector:connector,transX:set.transX=mathCos(angle)*slicedOffset,transY:set.transY=mathSin(angle)*slicedOffset,slicedTranslation:set.slicedTranslation="t"+mathCos(angle)*slicedOffset+","+mathSin(angle)*slicedOffset}};_proto.parseLabelAttributes=function parseLabelAttributes(dataObj){var dataSet=this,chart=dataSet.getFromEnv("chart"),chartConfig=chart.config,dataLabelStyle=chartConfig.dataLabelStyle,conf=dataSet.config,style=chartConfig.style,set,val,displayValue,colorLabelFromPoint=false,textDirection=chartConfig.textDirection,dataLabelOptions=conf.dataLabelOptions,_textAttrs,_textCss;set=dataObj.config;if(!(_textAttrs=set._textAttrs)){_textAttrs=set._textAttrs={}}val=set.y;displayValue=set.displayValue;style=set.style;if(val===null||val===UNDEF||set.isVisible===false){return}if(displayValue!==UNDEF){if(style){if(!(_textCss=set._textCss)){_textCss=set._textCss={}}_textCss.fontFamily=style.fontFamily;_textCss.fontSize=style.fontSize;_textCss.lineHeight=style.lineHeight;_textCss.fontWeight=style.fontWeight;_textCss.fontStyle=style.fontStyle}set.plotItem.style=set.style=style||(style=dataLabelStyle);_textAttrs.text=displayValue;_textAttrs.fill=(colorLabelFromPoint?toRaphaelColor(set.color):style.color)||"#000000";_textAttrs["text-bound"]=[style.backgroundColor,style.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash];_textAttrs.direction=textDirection;_textAttrs["line-height"]=style.lineHeight}else{_textAttrs.text=BLANKSTRING}set.props.label={attr:_textAttrs,css:_textCss};set.props.connector={attr:{"stroke-width":dataLabelOptions.connectorWidth,stroke:dataLabelOptions.connectorColor||"#606060"}}};_proto.draw=function draw(){var singleFillColor,dataSet=this,animationManager=dataSet.getFromEnv("animationManager"),chart=dataSet.getFromEnv("chart"),chartConfig=chart.config,dataLabelStyle=chartConfig.dataLabelStyle,conf=dataSet.config,showShadow=conf.showShadow,i,dataSetComponents=dataSet.components,removeDataArr=dataSetComponents.removeDataArr=dataSetComponents.removeDataArr||[],dataObj,toolText,setElement,setElementCheck,eventArgs,visible=dataSet.getState("visible"),plotGroup,plotShadow,labelGroup,connectorShadowGroup,anchorShadowGroup,setGraphics,set,val,plotItem,plotData=dataSetComponents.data||[],dataLength=plotData.length,canvasWidth=chartConfig.canvasWidth,canvasHeight=chartConfig.canvasHeight,cx=chartConfig.canvasLeft+canvasWidth*.5,cy=chartConfig.canvasTop+canvasHeight*.5,valueTotal,plotDragStart=conf.handlersAPI.plotDragStart,plotDragEnd=conf.handlersAPI.plotDragEnd,plotDragMove=conf.handlersAPI.plotDragMove,plotRollOver=conf.handlersAPI.plotRollOver,plotRollOut=conf.handlersAPI.plotRollOut,restoreColor=function restoreColor(){var index,dataObject;if(singleFillColor){for(index=0;index<dataLength;index+=1){dataObject=plotData[index];dataObject.graphics.element&&dataObject.graphics.element.attr({fill:toRaphaelColor(dataObject.config.color)})}}},isDimensionModified=function(){var pieCenter=conf.pieCenter||[],piePlotOptions=conf.piePlotOptions||[],oldDimensions={cx:pieCenter[0],cy:pieCenter[1],r:piePlotOptions.size,r2:(conf.innerSize||0)*.5},tolerance=5;return function(newDimesion){var prop,flag=false;for(prop in newDimesion){if(mathAbs(newDimesion[prop]-oldDimensions[prop])>tolerance){flag=true;break}}return flag}}(),piePlotOptions=conf.piePlotOptions=dataSet._parsePiePlotOptions(),r=piePlotOptions.size,r2=(conf.innerSize||0)*.5,toolTipController=dataSet.getFromEnv("toolTipController");if(!dataSet.getContainer("pie-groups")){dataSet._createContainer()}plotGroup=dataSet.getContainer("plot-group");plotShadow=dataSet.getContainer("plot-shadow-group");labelGroup=dataSet.getContainer("label-group");connectorShadowGroup=dataSet.getContainer("connector-shadow-group");anchorShadowGroup=dataSet.getContainer("anchor-shadow-group");if(dataSet.config.drawn){singleFillColor=isDimensionModified({cx:cx,cy:cy,r:r,r2:r2})&&false}labelGroup.css(dataLabelStyle);valueTotal=conf.valueTotal;if(!visible||!valueTotal){plotGroup.hide();plotShadow.hide();labelGroup.hide();connectorShadowGroup.hide();anchorShadowGroup.hide()}else{plotGroup.show();plotShadow.show();labelGroup.show();connectorShadowGroup.show();anchorShadowGroup.show()}removeDataArr.length&&dataSet.removeElement();for(i=0;i<dataLength;i+=1){dataObj=plotData[i];setGraphics=dataObj.graphics;set=dataObj.config;val=set.y;toolText=set.toolText;if(val===null||val===UNDEF||set.isVisible===false){continue}setElementCheck=setGraphics.element;setElement=animationManager.setAnimation({el:setElementCheck||"ringpath",attr:set.props.element.attr,label:"ringpath",props:{startAngle:dataSet.config.startAngle},container:plotGroup,component:dataSet});if(!setElementCheck){setGraphics.element=setElement;setElement.on("fc-dragstart",plotDragStart).on("fc-dragmove",plotDragMove).on("fc-dragend",plotDragEnd).on("fc-click",plotClickHandler(dataSet,setElement)).on("fc-mouseover",plotRollOver).on("fc-mouseout",plotRollOut)}plotItem=set.plotItem;eventArgs=set.eventArgs;plotItem.graphic=setElement;setElement.show().shadow(showShadow&&set.shadow,plotShadow).data("plotItem",plotItem).data("dataset",this).data(EVENTARGS,eventArgs);toolTipController.enableToolTip(setElement,toolText)}dataSet.organizeDatalabels();!dataSet.config.__attachRestoreColor&&dataSet.addExtEventListener("animationComplete",restoreColor,animationManager);dataSet.config.__attachRestoreColor=true;dataSet.config.drawn=true};_proto.sliceInOtherPies=function sliceInOtherPies(mainPieId){var dataset=this,plotItems=dataset.components.data,i=plotItems.length,numSliced=0,plot;dataset.enableMultiSlicing=true;while(i--){i!==mainPieId&&(plot=plotItems[i]).config.sliced&&++numSliced&&dataset.plotGraphicClick.call(plot.graphics)}dataset.enableMultiSlicing=false;return!!numSliced};_proto.removeElement=function removeElement(){var dataSet=this,animationManager=dataSet.getFromEnv("animationManager"),chart=dataSet.getFromEnv("chart"),chartConfig=chart.config,components=dataSet.components,removeDataArr=components.removeDataArr||[],len=removeDataArr.length,conf=dataSet.config,removeData,element,ele,canvasWidth=chartConfig.canvasWidth,canvasHeight=chartConfig.canvasHeight,cx=chartConfig.canvasLeft+canvasWidth*.5,cy=chartConfig.canvasTop+canvasHeight*.5,graphics,r=conf.pieMinRadius,r2=(conf.innerSize||0)*.5,i,startAngle=conf.startAngle,endAngle=startAngle-pi2;for(i=0;i<len;i++){removeData=removeDataArr[0];graphics=removeData.graphics;for(ele in graphics){if(graphics.hasOwnProperty(ele)){element=graphics[ele];if(!element){continue}if(ele==="element"){animationManager.setAnimation({el:element,attr:{ringpath:[cx,cy,r,r2,endAngle,endAngle+.01],transform:""},callback:removeFn,component:dataSet});delete graphics[ele]}else{dataSet.disposeLabelAndConnector(graphics,[{el:"label",animLabel:"label"},{el:"innerLabel",animLabel:"label"},{el:"connector",animLabel:"connector"}])}}}removeDataArr.splice(0,1)}};_proto.getEventArgs=function getEventArgs(legendItem){var dataset=this,index=legendItem.config.index,set=dataset.components.data[index],config=set.config||{},eventArgs;eventArgs={datasetName:config.seriesName,datasetIndex:index,id:config.userID,visible:config.isVisible,label:config.seriesName,value:config.value,percentValue:config.pValue,tooltext:config.toolText,link:config.link,sliced:config.sliced};return eventArgs};_proto.remove=function remove(config){var dataset=this,legendItemId=dataset.config.legendItemId,legend=dataset.getFromEnv("legend");legend&&legendItemId&&legend.disposeItem(legendItemId);_AreaDataset.prototype.remove.call(this,config)};return Pie2DDataset}(AreaDataset);export default Pie2DDataset;export{plotGraphicClick,_trimData as trimData,labelClickFn,plotClickHandler,hideFn};