import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{BLANKSTRING,pluck,pluckNumber,COMMASTRING,parseTooltext,toRaphaelColor,HUNDREDSTRING,getLightColor,getColumnColor}from"@fusioncharts/core/src/lib";import{addDep}from"@fusioncharts/core/src/dependency-manager";import ColumnDataset from"@fusioncharts/charts/src/dataset/column";import sparkcolumnAnimation from"./index.animation";var UNDEF,math=Math,mathMin=math.min;addDep({name:"sparkcolumnAnimation",type:"animationRule",extension:sparkcolumnAnimation});var SparkColumnDataset=function(_ColumnDataset){_inheritsLoose(SparkColumnDataset,_ColumnDataset);function SparkColumnDataset(){return _ColumnDataset.apply(this,arguments)||this}var _proto=SparkColumnDataset.prototype;_proto.getType=function getType(){return"dataset"};_proto.getName=function getName(){return"sparkColumn"};_proto.parseAttributes=function parseAttributes(){_ColumnDataset.prototype.parseAttributes.call(this);var dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=dataSet.config.JSONData,chartAttr=chart.getFromEnv("chart-attrib");conf.showValues=pluckNumber(JSONData.showvalues,chartAttr.showvalues,0)};_proto._setConfigure=function _setConfigure(newDataset){var dataSet=this,chart=dataSet.getFromEnv("chart"),chartAttr=chart.getFromEnv("dataSource").chart,conf=dataSet.config,chartConfig=chart.config,JSONData=dataSet.config.JSONData,setDataArr=newDataset||JSONData.data,setDataLen=setDataArr&&setDataArr.length,xAxis=dataSet.getFromEnv("xAxis"),catLen=xAxis.getTicksLen(),len=newDataset&&newDataset.data.length||mathMin(catLen,setDataLen),showHoverEffect=chartConfig.plothovereffect,colorM=dataSet.getFromEnv("color-manager"),isRoundEdges=chartConfig.useroundedges,plotFillColor,color,borderColor,hoverColor,hoverAlpha,hoverGradientColor,hoverBorderColor,hoverBorderAlpha,borderThickness,config,plotFillAlpha,plotBorderAlpha,plotBorderColor,highColor,lowColor,highBorderColor,lowBorderColor,highDisplayValue,lowDisplayValue,macroIndices,parserConfig,setData,dataObj,colorArr,hoverColorArr,i,cLen,cInd,dataStore,maxValue,minValue;conf.plotgradientcolor=BLANKSTRING;conf.showvalues=pluckNumber(JSONData.showvalues,chartAttr.showvalues,0);conf.showShadow=pluckNumber(chartAttr.showshadow,0);_ColumnDataset.prototype._setConfigure.call(this);dataStore=dataSet.components.data;maxValue=conf.maxValue;minValue=conf.minValue;plotFillColor=pluck(chartAttr.plotfillcolor,colorM.getColor("plotFillColor"));plotFillAlpha=pluck(chartAttr.plotfillalpha,HUNDREDSTRING);plotBorderAlpha=pluck(chartAttr.plotborderalpha,HUNDREDSTRING);plotBorderColor=pluck(chartAttr.plotbordercolor,plotFillColor);highColor=pluck(chartAttr.highcolor,"000000");lowColor=pluck(chartAttr.lowcolor,"000000");highBorderColor=pluck(chartAttr.highbordercolor,chartAttr.plotbordercolor,highColor);lowBorderColor=pluck(chartAttr.lowbordercolor,chartAttr.plotbordercolor,lowColor);for(i=0;i<len;i++){setData=setDataArr[i];dataObj=dataStore[i];config=dataObj.config;colorArr=null;color=plotFillColor;borderColor=plotBorderColor;if(config.setValue===maxValue){color=highColor;borderColor=highBorderColor;highDisplayValue=config.displayValue}if(dataObj.config.setValue===minValue){color=lowColor;borderColor=lowBorderColor;lowDisplayValue=config.displayValue}config.colorArr=colorArr=getColumnColor(color+COMMASTRING+conf.plotgradientcolor,plotFillAlpha,"0","90",isRoundEdges,borderColor,plotBorderAlpha,0,0);if(showHoverEffect!==0&&colorArr){hoverColor=hoverAlpha=UNDEF;if(config.setValue===maxValue){hoverColor=chartAttr.highhovercolor;hoverAlpha=chartAttr.highhoveralpha}if(dataObj.config.setValue===minValue){hoverColor=chartAttr.lowhovercolor;hoverAlpha=chartAttr.lowhoveralpha}hoverColor=pluck(setData.hovercolor,JSONData.hovercolor,hoverColor,chartAttr.plotfillhovercolor,chartAttr.columnhovercolor,colorArr[0].FCcolor.color);hoverColor=hoverColor.split(/\s{0,},\s{0,}/);cLen=hoverColor.length;for(cInd=0;cInd<cLen;cInd++){hoverColor[cInd]=getLightColor(hoverColor[cInd],70)}hoverColor=hoverColor.join(",");hoverAlpha=pluck(setData.hoveralpha,JSONData.hoveralpha,hoverAlpha,chartAttr.plotfillhoveralpha,chartAttr.columnhoveralpha,plotFillAlpha);hoverGradientColor=pluck(setData.hovergradientcolor,JSONData.hovergradientcolor,chartAttr.plothovergradientcolor,conf.plotgradientcolor);!hoverGradientColor&&(hoverGradientColor=BLANKSTRING);hoverBorderColor=pluck(setData.borderhovercolor,JSONData.borderhovercolor,chartAttr.plotborderhovercolor,conf.plotbordercolor);hoverBorderAlpha=pluck(setData.borderhoveralpha,JSONData.borderhoveralpha,chartAttr.plotborderhoveralpha,chartAttr.plotfillhoveralpha,plotBorderAlpha,plotFillAlpha);if(showHoverEffect===1&&hoverColor===colorArr[0].FCcolor.color){hoverColor=getLightColor(hoverColor,70)}hoverColorArr=getColumnColor(hoverColor+COMMASTRING+hoverGradientColor,hoverAlpha,"0","90",isRoundEdges,hoverBorderColor,hoverBorderAlpha.toString(),0,0);config.setRolloutAttr={fill:toRaphaelColor(colorArr[0]),stroke:borderThickness&&toRaphaelColor(colorArr[1]),"stroke-width":borderThickness};config.setRolloverAttr={fill:toRaphaelColor(hoverColorArr[0]),stroke:borderThickness&&toRaphaelColor(hoverColorArr[1]),"stroke-width":borderThickness}}config._x=i;config._y=config.setValue}for(i=0;i<len;i++){var dataObject=dataStore[i],configuration=dataObject.config;if(configuration.setTooltext!==UNDEF){macroIndices=[56,57,60,61];parserConfig={highValue:highDisplayValue,highDataValue:highDisplayValue,lowValue:lowDisplayValue,lowDataValue:lowDisplayValue};configuration.toolText=parseTooltext(configuration.setTooltext,macroIndices,parserConfig,setData,chartAttr,JSONData);configuration.finalTooltext=configuration.setTooltext=configuration.toolText}}};return SparkColumnDataset}(ColumnDataset);export default SparkColumnDataset;