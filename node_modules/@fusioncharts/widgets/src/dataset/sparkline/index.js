import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{BLANKSTRING,pluck,pluckNumber,POSITION_START,parseTooltext,POSITION_END,getLightColor,parseColor}from"@fusioncharts/core/src/lib";import LineDataset from"@fusioncharts/charts/src/dataset/line";import{addDep}from"@fusioncharts/core/src/dependency-manager";import sparklineAnimation from"./index.animation";var UNDEF,GUTTER_PADDING=2,defined=function defined(obj){return obj!==UNDEF&&obj!==null},drawSparkValues=function drawSparkValues(){var dataSet=this,chart=dataSet.getFromEnv("chart"),chartConf=chart.config,style=chartConf.dataLabelStyle,valuePadding=chartConf.valuepadding+GUTTER_PADDING,dataLabelContainer=dataSet.getContainer("labelGroup"),animationManager=dataSet.getFromEnv("animationManager"),closeValueCheck=dataSet.getGraphicalElement("closeValue"),closeValue,openValueCheck=dataSet.getGraphicalElement("openValue"),openValue,startBracesCheck=dataSet.getGraphicalElement("startBraces"),startBraces,highValueCheck=dataSet.getGraphicalElement("highValue"),highValue,separatorCheck=dataSet.getGraphicalElement("separator"),separator,lowValueCheck=dataSet.getGraphicalElement("lowValue"),lowValue,endBracesCheck=dataSet.getGraphicalElement("endBraces"),endBraces,sparkValues=chartConf.sparkValues||(chartConf.sparkValues={}),SmartLabel=dataSet.getFromEnv("smartLabel"),START_BRACES="[",END_BRACES="]",SEPARATER="|",textAttr={class:"fusioncharts-label","text-anchor":POSITION_END,fill:style.color,"font-size":style.fontSize,"font-weight":style.fontWeight,"font-style":style.fontStyle,"font-family":style.fontFamily,visibility:"visible"},attr={x:0,y:0};chart.getChildContainer("datalabelsGroup").attr({"clip-rect":null});attr.y=chartConf.canvasHeight*.5+chartConf.canvasTop;attr.x=chartConf.canvasLeft-valuePadding;if(sparkValues.openValue&&sparkValues.openValue.label||openValue){openValue=animationManager.setAnimation({el:openValueCheck||"text",state:"appearing",container:dataLabelContainer,attr:{text:sparkValues.openValue.label,x:attr.x,y:attr.y,fill:sparkValues.openValue.color||textAttr.fill,"text-anchor":POSITION_END,"line-height":style.lineHeight,"text-bound":[style.backgroundColor,style.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash],visibility:"visible"},label:"label",component:dataSet});if(!openValueCheck){dataSet.addGraphicalElement("openValue",openValue)}}textAttr["text-anchor"]=POSITION_START;attr.x=chartConf.canvasWidth+chartConf.canvasLeft+valuePadding;if(sparkValues.closeValue&&sparkValues.closeValue.label||closeValue){closeValue=animationManager.setAnimation({el:closeValueCheck||"text",container:dataLabelContainer,state:"appearing",attr:{text:sparkValues.closeValue.label,x:attr.x,y:attr.y,fill:sparkValues.closeValue.color||textAttr.fill,"text-anchor":POSITION_START,"line-height":style.lineHeight,"text-bound":[style.backgroundColor,style.borderColor,style.borderThickness,style.borderPadding,style.borderRadius,style.borderDash],visibility:"visible"},label:"label",component:dataSet});if(!closeValueCheck){dataSet.addGraphicalElement("closeValue",closeValue)}attr.x+=sparkValues.closeValue.smartObj&&sparkValues.closeValue.smartObj.width+GUTTER_PADDING+valuePadding||0}if(sparkValues.highLowValue&&sparkValues.highLowValue.label||highValue){if(sparkValues.highLowValue&&sparkValues.highLowValue.label===BLANKSTRING){SEPARATER=START_BRACES=END_BRACES=BLANKSTRING}SmartLabel.useEllipsesOnOverflow(chartConf.useEllipsesWhenOverflow);SmartLabel.setStyle(style);startBraces=animationManager.setAnimation({el:startBracesCheck||"text",state:"appearing",container:dataLabelContainer,attr:{text:START_BRACES,x:attr.x,y:attr.y,"text-anchor":POSITION_START,visibility:"visible"},label:"label",component:dataSet});if(!startBracesCheck){dataSet.addGraphicalElement("startBraces",startBraces)}attr.x+=SmartLabel.getSmartText(START_BRACES).width;highValue=animationManager.setAnimation({el:highValueCheck||"text",state:"appearing",container:dataLabelContainer,attr:{text:sparkValues.highValue.label,x:attr.x,y:attr.y,"text-anchor":POSITION_START,fill:sparkValues.highValue.color||textAttr.fill,visibility:"visible"},label:"label",component:dataSet});if(!highValueCheck){dataSet.addGraphicalElement("highValue",highValue)}attr.x+=SmartLabel.getSmartText(sparkValues.highValue.label).width;separator=animationManager.setAnimation({el:separatorCheck||"text",state:"appearing",container:dataLabelContainer,attr:{text:SEPARATER,x:attr.x,y:attr.y,"text-anchor":POSITION_START,visibility:"visible"},label:"label",component:dataSet});if(!separatorCheck){dataSet.addGraphicalElement("separator",separator)}attr.x+=SmartLabel.getSmartText(SEPARATER).width;lowValue=animationManager.setAnimation({el:lowValueCheck||"text",container:dataLabelContainer,state:"appearing",attr:{text:sparkValues.lowValue.label,x:attr.x,y:attr.y,"text-anchor":POSITION_START,fill:sparkValues.lowValue.color||textAttr.fill,visibility:"visible"},label:"label",component:dataSet});if(!lowValueCheck){dataSet.addGraphicalElement("lowValue",lowValue)}attr.x+=SmartLabel.getSmartText(sparkValues.lowValue.label).width;endBraces=animationManager.setAnimation({el:endBracesCheck||"text",state:"appearing",container:dataLabelContainer,attr:{text:END_BRACES,x:attr.x,y:attr.y,"text-anchor":POSITION_START,visibility:"visible"},label:"label",component:dataSet});if(!endBracesCheck){dataSet.addGraphicalElement("endBraces",endBraces)}}dataSet.labelDrawn=true};addDep({name:"sparklineAnimation",type:"animationRule",extension:sparklineAnimation});var SparkLineDataset=function(_LineDataset){_inheritsLoose(SparkLineDataset,_LineDataset);function SparkLineDataset(){return _LineDataset.apply(this,arguments)||this}var _proto=SparkLineDataset.prototype;_proto.getType=function getType(){return"dataset"};_proto.getName=function getName(){return"sparkLine"};_proto.parseAttributes=function parseAttributes(){_LineDataset.prototype.parseAttributes.call(this);var dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=dataSet.config.JSONData,chartAttr=chart.getFromEnv("chart-attrib");conf.showValues=pluckNumber(JSONData.showvalues,chartAttr.showvalues,0);conf.linethickness=pluckNumber(JSONData.linethickness,chartAttr.linethickness,1)};_proto._setConfigure=function _setConfigure(newDataset){_LineDataset.prototype._setConfigure.call(this);var dataSet=this,chart=dataSet.getFromEnv("chart"),conf=dataSet.config,JSONData=dataSet.config.JSONData,chartAttr=chart.getFromEnv("dataSource").chart,setDataArr=newDataset||JSONData.data,setData,dataObj,xAxis=dataSet.getFromEnv("xAxis"),len=newDataset&&newDataset.data.length||xAxis.getTicksLen(),colorM=dataSet.getFromEnv("color-manager"),chartConf=chart.config,dataStore,config,i,openColor=parseColor(pluck(chartAttr.opencolor,"0099FF")),closeColor=parseColor(pluck(chartAttr.closecolor,"0099FF")),highColor=parseColor(pluck(chartAttr.highcolor,"00CC00")),lowColor=parseColor(pluck(chartAttr.lowcolor,"CC0000")),anchorColor=parseColor(pluck(chartAttr.anchorcolor,colorM.getColor("plotFillColor"))),showOpenAnchor=pluckNumber(chartAttr.showopenanchor,chartAttr.drawanchors,chartAttr.showanchors,1),showCloseAnchor=pluckNumber(chartAttr.showcloseanchor,chartAttr.drawanchors,chartAttr.showanchors,1),showHighAnchor=pluckNumber(chartAttr.showhighanchor,chartAttr.drawanchors,chartAttr.showanchors,1),showLowAnchor=pluckNumber(chartAttr.showlowanchor,chartAttr.drawanchors,chartAttr.showanchors,1),anchorAlpha=pluckNumber(chartAttr.anchoralpha,100),showAnchors=pluckNumber(chartAttr.drawanchors,chartAttr.showanchors,0),defAnchorAlpha=showAnchors?pluckNumber(chartAttr.anchoralpha,100):0,lineColor=pluck(chartAttr.linecolor,colorM.getColor("plotFillColor")),sparkValues,hasValidValue,highValue,lowValue,pointAnchorAlpha,highDisplayValue,lowDisplayValue,openDisplayValue,macroIndices,parserConfig,closeDisplayValue;dataStore=dataSet.components.data;highValue=conf.maxValue;lowValue=conf.minValue;conf.shadow={opacity:pluckNumber(chartAttr.showshadow,0)?conf.alpha/100:0};dataObj=dataStore[0];config=dataObj.config;config.anchorProps.bgColor=pluck(dataObj.anchorbgcolor,openColor);config.anchorProps.enabled=!!showOpenAnchor;config.anchorProps.bgAlpha=showOpenAnchor?pointAnchorAlpha:0;if(config.anchorProps.enabled&&config.hoverEffects){config.hoverEffects.anchorColor=pluck(chartAttr.openhovercolor,chartAttr.anchorhovercolor,chartAttr.plotfillhovercolor,getLightColor(openColor,70));config.hoverEffects.anchorBgAlpha=pluckNumber(chartAttr.openhoveralpha,chartAttr.anchorhoveralpha,chartAttr.plotfillhoveralpha,100)}openDisplayValue=config.displayValue;dataObj=dataStore[len-1];config=dataObj.config;config.anchorProps.bgColor=pluck(dataObj.anchorbgcolor,closeColor);config.anchorProps.enabled=!!showCloseAnchor;config.anchorProps.bgAlpha=showCloseAnchor?pointAnchorAlpha:0;if(config.anchorProps.enabled&&config.hoverEffects){config.hoverEffects.anchorColor=pluck(chartAttr.closehovercolor,chartAttr.anchorhovercolor,chartAttr.plotfillhovercolor,getLightColor(closeColor,70));config.hoverEffects.anchorBgAlpha=pluckNumber(chartAttr.closehoveralpha,chartAttr.anchorhoveralpha,chartAttr.plotfillhoveralpha,100)}closeDisplayValue=config.displayValue;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj.config;setData=setDataArr[i];pointAnchorAlpha=pluckNumber(setData.anchorbgalpha,anchorAlpha);conf.maxRadius=-Infinity;if(i!==0&&i!==len-1){config.anchorProps.bgColor=pluck(setData.anchorbgcolor,anchorColor);config.anchorProps.bgAlpha=pluckNumber(setData.anchorbgalpha,defAnchorAlpha);config.hoverEffects.anchorColor=parseColor(pluck(chartAttr.anchorhovercolor,chartAttr.plotfillhovercolor,getLightColor(lineColor,70)));config.hoverEffects.anchorBgAlpha=pluckNumber(chartAttr.lowhoveralpha,chartAttr.anchorhoveralpha,chartAttr.plotfillhoveralpha,100)}config.anchorProps.radius=pluckNumber(chartAttr.anchorradius,setData.anchorradius,2);config.anchorProps.borderThickness=0;config.hoverEffects.anchorBorderThickness=0;config.hoverEffects.anchorRadius=pluckNumber(chartAttr.anchorhoverradius,chartAttr.anchorradius,setData.anchorradius,3);conf.maxRadius=Math.max(config.anchorProps.radius+config.anchorProps.borderThickness/2,conf.maxRadius);if(config.setValue===lowValue){config.anchorProps.bgColor=pluck(setData.anchorbgcolor,lowColor);config.hoverEffects.anchorColor=pluck(chartAttr.lowhovercolor,chartAttr.anchorhovercolor,chartAttr.plotfillhovercolor,getLightColor(lowColor,70));config.hoverEffects.anchorBgAlpha=pluckNumber(chartAttr.lowhoveralpha,chartAttr.anchorhoveralpha,chartAttr.plotfillhoveralpha,100);config.anchorProps.enabled=!!showLowAnchor;config.anchorProps.bgAlpha=showLowAnchor?pointAnchorAlpha:0;lowDisplayValue=config.displayValue}if(config.setValue===highValue){config.anchorProps.bgColor=pluck(setData.anchorbgcolor,highColor);config.hoverEffects.anchorColor=pluck(chartAttr.highhovercolor,chartAttr.anchorhovercolor,chartAttr.plotfillhovercolor,getLightColor(highColor,70));config.hoverEffects.anchorBgAlpha=pluckNumber(chartAttr.highhoveralpha,chartAttr.anchorhoveralpha,chartAttr.plotfillhoveralpha,100);config.anchorProps.enabled=!!showHighAnchor;config.anchorProps.bgAlpha=showHighAnchor?pointAnchorAlpha:0;highDisplayValue=config.displayValue}if(defined(config.setValue)){hasValidValue=1}config._x=i;config._y=config.setValue}sparkValues=chartConf.sparkValues={openValue:{color:openColor},closeValue:{color:closeColor},highValue:{color:highColor},lowValue:{color:lowColor},highLowValue:{}};if(hasValidValue){sparkValues.openValue.label=pluckNumber(chartAttr.showopenvalue,1)?openDisplayValue:BLANKSTRING;sparkValues.closeValue.label=pluckNumber(chartAttr.showclosevalue,1)?closeDisplayValue:BLANKSTRING;if(pluckNumber(chartAttr.showhighlowvalue,1)){sparkValues.highLowValue.label="["+highDisplayValue+" | "+lowDisplayValue+"]";sparkValues.highValue.label=highDisplayValue;sparkValues.lowValue.label=lowDisplayValue}}for(i=0;i<len;i++){var dataObject=dataStore[i],configuration=dataObject.config;if(configuration.setTooltext!==UNDEF){macroIndices=[54,55,56,57,58,59,60,61];parserConfig={openValue:sparkValues.openValue.label,openDataValue:sparkValues.openValue.label,closeValue:sparkValues.closeValue.label,closeDataValue:sparkValues.closeValue.label,highValue:sparkValues.highValue.label,highDataValue:sparkValues.highValue.label,lowValue:sparkValues.lowValue.label,lowDataValue:sparkValues.lowValue.label};configuration.toolText=parseTooltext(configuration.setTooltext,macroIndices,parserConfig,setData,chartAttr,JSONData);configuration.finalTooltext=configuration.setTooltext=configuration.toolText}}};_proto.draw=function draw(){var dataSet=this;_LineDataset.prototype.draw.call(this);dataSet._drawSparkValues()};_proto._drawSparkValues=function _drawSparkValues(){var dataSet=this;drawSparkValues.call(dataSet)};return SparkLineDataset}(LineDataset);export default SparkLineDataset;