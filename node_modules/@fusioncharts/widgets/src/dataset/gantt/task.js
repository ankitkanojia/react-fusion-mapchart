import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import Column from"@fusioncharts/charts/src/dataset/column";import{extend2,parseConfiguration,pluck,pluckNumber,getFirstValue,parseTooltext,setLineHeight,TRACKER_FILL,getValidValue,parseUnsafeString,convertColor,toRaphaelColor,crispBound,getDarkColor,getFirstColor,BLANKSTRING,HUNDREDSTRING,POSITION_END,POSITION_START}from"@fusioncharts/core/src/lib";import{addDep}from"@fusioncharts/core/src/dependency-manager";import taskAnimation from"./task.animation";import{priorityList}from"@fusioncharts/core/src/schedular";var UNDEF;var BLANK="",BOLD="bold",ITALIC="italic",NORMAL="normal",PROCESS="PROCESS_",ROLLOVER="DataPlotRollOver",ROLLOUT="DataPlotRollOut",align={left:"start",right:"end",center:"middle"},xAlign={left:0,right:1,center:.5,undefined:.5},alignGutter={left:5,right:-5,center:0,undefined:0},stylePropValues={fontWeight:[NORMAL,BOLD],fontStyle:[NORMAL,ITALIC]},hideFn=function hideFn(){this.hide()},defined=function defined(obj){return obj!==UNDEF&&obj!==null},extractLabelStyle=function extractLabelStyle(styleObj){var style,prop;for(prop in styleObj){if(styleObj[prop]!==UNDEF){style=style||{};switch(prop){case"fontWeight":case"fontStyle":style[prop]=stylePropValues[prop][styleObj[prop]];break;default:style[prop]=styleObj[prop]}}}return style},isPercent=function isPercent(str){return/%/g.test(str)},checkInvalidValue=function checkInvalidValue(){var i=0,ii=arguments.length,allValuesValid=false,val;for(i=0;i<ii;i++){val=arguments[i];if(isNaN(val)){return false}allValuesValid=true}return allValuesValid};addDep({name:"taskAnimation",type:"animationRule",extension:taskAnimation});var Task=function(_Column){_inheritsLoose(Task,_Column);function Task(){var _this;_this=_Column.call(this)||this;_this.components={};return _this}var _proto=Task.prototype;_proto.getName=function getName(){return"task"};_proto.__setDefaultConfig=function __setDefaultConfig(){_Column.prototype.__setDefaultConfig.call(this);var config=this.config;config.showpercentlabel=UNDEF;config.showlabels=UNDEF;config.showborder=1;config.borderthickness=1;config.font=BLANKSTRING;config.fontcolor=BLANKSTRING;config.fontsize=BLANKSTRING;config.color=BLANKSTRING;config.alpha=HUNDREDSTRING;config.angle=270;config.slackfillcolor=UNDEF;config.borderalpha=HUNDREDSTRING;config.hoverfillcolor=BLANKSTRING;config.hoverfillalpha=HUNDREDSTRING;config.slackhoverfillalpha=HUNDREDSTRING;config.showstartdate=UNDEF;config.showenddate=UNDEF};_proto.configureAttributes=function configureAttributes(){var dataset=this,jsonData=dataset.getFromEnv("dataSource"),userConfig=extend2({},jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{});parseConfiguration(userConfig,dataset.config,dataset.getFromEnv("chart").config,{task:true});if(!dataset.components){dataset.components={}}dataset._setConfigure();dataset.setState("dirty",true)};_proto._setConfigure=function _setConfigure(newDataset){var dataset=this,datasetConfig=dataset.config,chart=dataset.getFromEnv("chart"),yAxis=chart.getChildren("yAxis")[0],axisConfig=yAxis.config,jsonData=dataset.getFromEnv("dataSource"),chartAttrs=jsonData.chart,JSONData=jsonData.tasks&&jsonData.tasks.length?jsonData.tasks[0]:jsonData.tasks||{},setDataArr=newDataset||JSONData.length?JSONData:JSONData.task,setDataLen=setDataArr&&setDataArr.length,colorM=dataset.getFromEnv("color-manager"),chartConfig=chart.config,numberFormatter=dataset.getFromEnv("number-formatter"),taskMix=chartConfig.taskbarfillmix,taskRatio=chartConfig.taskbarfillratio,showSlackAsFill=chartConfig.showslackasfill,dataStore=dataset.components.data,percentComplete,eDate,sDate,i,processMap=axisConfig.processes.processMap,processes=axisConfig.processes.process.process,processName,arrColor,arrAlpha,arrRatio,dataLabel,dInt=chartConfig.dateintooltip,dataObj,taskObj,alignVal={right:"right",left:"left",undefined:"center",center:"center"},id,tAlpha,tBorderAlpha,tBorderColor,label,color,fillAngle,showPercentLabel,tasksMap=chart.components.tasksMap={},inCanStyle=chartConfig.style.inCanvasStyle,toolText,slHovColor,slColor,tColorObj,tHovColor,tHovBorderColor,taskId,dataConfig,showtooltip=pluckNumber(chartAttrs.showtooltip,1),dataLabelStyle=chartConfig.dataLabelStyle,datasetLabelStyle,setLabelStyle;if(!dataStore){dataStore=dataset.components.data=[]}datasetConfig.showlabels=pluck(JSONData.showlabels,JSONData.showlabels,JSONData.showname,chartAttrs.showtasklabels,chartAttrs.showtasknames,0);datasetConfig.showTextOutline=pluckNumber(chartAttrs.textoutline,0);datasetLabelStyle=datasetConfig.labelStyle=extractLabelStyle({fontSize:datasetConfig.fontSize,fontFamily:datasetConfig.font});setLineHeight(datasetConfig.labelStyle);if(setDataLen){for(i=0;i<setDataLen;i+=1){taskObj=setDataArr[i];id=pluck(taskObj.processid);if(id&&typeof id==="string"){id=id.toLowerCase()}taskId=taskObj.id;percentComplete=taskObj.percentcomplete;tAlpha=pluckNumber(taskObj.alpha,datasetConfig.alpha);color=pluck(taskObj.color,datasetConfig.color,colorM.getColor("plotFillColor"));tBorderAlpha=pluckNumber(taskObj.borderalpha,datasetConfig.borderalpha,"100");tBorderColor=pluck(taskObj.bordercolor,datasetConfig.bordercolor,colorM.getColor("plotBorderColor"));label=getFirstValue(pluck(taskObj.label,taskObj.name),BLANK);arrColor=colorM.parseColorMix(color,taskMix);arrAlpha=colorM.parseAlphaList(tAlpha.toString(),arrColor.length);arrRatio=colorM.parseRatioList(taskRatio,arrColor.length);fillAngle=pluckNumber(taskObj.angle,datasetConfig.angle);dataObj=dataStore[i]||(dataStore[i]={config:{}});dataConfig=dataObj.config;dataConfig.index=i;dataConfig.link=taskObj.link;dataConfig.processId=PROCESS+i;dataConfig.textColor=getFirstColor(pluck(taskObj.fontcolor,datasetConfig.fontcolor,inCanStyle.color));dataConfig.style=extractLabelStyle({fontSize:taskObj.fontsize,fontFamily:taskObj.font});setLineHeight(dataConfig.style);setLabelStyle=dataConfig.style;dataConfig.lineHeight=pluck(setLabelStyle&&setLabelStyle.lineHeight,datasetLabelStyle&&datasetLabelStyle.lineHeight,dataLabelStyle&&dataLabelStyle.lineHeight);dataConfig.startMs=numberFormatter.getDateValue(taskObj.start).ms;dataConfig.endMs=numberFormatter.getDateValue(taskObj.end).ms;sDate=numberFormatter.getFormattedDate(dataConfig.startMs);eDate=numberFormatter.getFormattedDate(dataConfig.endMs);dataConfig.tAlpha=tAlpha;dataConfig.tBorderColor=tBorderColor;dataConfig.tBorderAlpha=tBorderAlpha;dataLabel=BLANK;dataConfig.percentComplete=percentComplete=Math.min(pluckNumber(taskObj.percentcomplete,-1),100);dataConfig.labelAlign=alignVal[[pluck(taskObj.labelalign,chartConfig.tasklabelsalign).toLowerCase()]];dataConfig.showAsGroup=pluckNumber(taskObj.showasgroup,0);showPercentLabel=dataConfig.showPercentLabel=pluckNumber(taskObj.showpercentlabel,datasetConfig.showpercentlabel);if(pluckNumber(taskObj.showlabel,taskObj.showname,datasetConfig.showlabels)){dataLabel=label}if(showPercentLabel&&percentComplete!==-1){dataLabel+=" "+percentComplete+"%"}dataConfig.percentComplete=percentComplete;tColorObj={FCcolor:{color:arrColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}};slColor=colorM.parseColorMix(pluck(taskObj.slackfillcolor,datasetConfig.slackfillcolor,chartConfig.slackfillcolor),taskMix);slColor=showSlackAsFill?{FCcolor:{color:slColor.join(),alpha:arrAlpha,ratio:arrRatio,angle:fillAngle}}:TRACKER_FILL;tHovColor={FCcolor:{color:colorM.parseColorMix(pluck(taskObj.hoverfillcolor,datasetConfig.hoverfillcolor,chartConfig.taskhoverfillcolor,getDarkColor(color,80)),taskMix).join(),alpha:colorM.parseAlphaList(pluck(taskObj.hoverfillalpha,datasetConfig.hoverfillalpha).toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}};tHovBorderColor=convertColor(pluck(taskObj.hoverbordercolor,datasetConfig.hoverbordercolor,getDarkColor(tBorderColor,80)),pluck(taskObj.hoverborderalpha,datasetConfig.hoverborderalpha,tBorderAlpha));slHovColor=showSlackAsFill?{FCcolor:{color:colorM.parseColorMix(getDarkColor(pluck(taskObj.slackhoverfillcolor,datasetConfig.slackhoverfillcolor,chartConfig.slackfillcolor),80),taskMix).join(),alpha:colorM.parseAlphaList(pluck(taskObj.slackhoverfillalpha,datasetConfig.slackhoverfillalpha,"100").toString(),arrColor.length),ratio:arrRatio,angle:fillAngle}}:TRACKER_FILL;dataConfig.color=toRaphaelColor(tColorObj);dataConfig.slackColor=toRaphaelColor(slColor);dataConfig.hoverFillColor=toRaphaelColor(tHovColor);dataConfig.hoverBorderColor=tHovBorderColor;dataConfig.slackHoverColor=toRaphaelColor(slHovColor);dataConfig.showHoverEffect=pluckNumber(taskObj.showhovereffect,datasetConfig.showhovereffect,chartAttrs.showhovereffect,1);dataConfig.taskHeight=pluck(taskObj.height,"35%");dataConfig.topPadding=pluck(taskObj.toppadding,"35%");dataConfig.showPercentLabel=showPercentLabel;dataConfig.endDate=pluckNumber(taskObj.showenddate,datasetConfig.showenddate)?eDate:UNDEF;dataConfig._endDate=eDate;dataConfig.startDate=pluckNumber(taskObj.showstartdate,datasetConfig.showstartdate)?sDate:UNDEF;dataConfig._startDate=sDate;dataConfig.shadow={opacity:Math.max(tAlpha,tBorderAlpha)/100,inverted:true};dataConfig.id=id;dataConfig.taskId=taskId;dataConfig.borderColor=convertColor(tBorderColor,tBorderAlpha);dataConfig.borderThickness=pluckNumber(taskObj.showborder,datasetConfig.showborder)?pluckNumber(taskObj.borderthickness,datasetConfig.borderthickness):0;toolText=getValidValue(parseUnsafeString(pluck(taskObj.tooltext,datasetConfig.hovertext,datasetConfig.plottooltext,chartAttrs.plottooltext)));if(showtooltip){if(toolText!==UNDEF){if(processMap[id]){processName=processMap[id].catObj.label||processMap[id].catObj.name}else{processName=processes[i]&&(processes[i].label||processes[i].name)}toolText=parseTooltext(toolText,[3,28,29,30,31],{end:eDate,start:sDate,label:label,percentComplete:percentComplete!==-1?numberFormatter.percentValue(percentComplete):BLANK,processName:processName},datasetConfig)}else{toolText=(label!==BLANK?label+(dInt?", ":BLANK):BLANK)+(dInt?sDate+" - "+eDate:BLANK)}}dataConfig.label=dataLabel;dataConfig.toolText=toolText;typeof taskId==="string"&&(taskId=taskId.toLowerCase());if(taskId!==UNDEF){tasksMap[taskId]=dataStore[i]}}}if(pluckNumber(JSONData.visible,1)){dataset.setState("visible",true)}else{dataset.setState("visible",false)}};_proto.slackElemHandlers=function slackElemHandlers(slackElem,chart){var dataset=this;if(slackElem){slackElem.on("fc-click",function(e){var ele=this;chart.plotEventHandler(ele,e)}).hover(function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOVER);dataObj.config.showHoverEffect&&dataset.taskHoverHandler.call(ele,chart)},function(data){var ele=this,dataObj=ele.data("dataObj");chart.plotEventHandler(ele,data,ROLLOUT);dataObj.config.showHoverEffect&&dataset.taskHoverOutHandler.call(ele,chart)})}};_proto.trimData=function trimData(datasetJSON){if(!this.config.JSONData){return}var dataSet=this,config=dataSet.config,context=config&&config.context,prevCatlen=context&&context.prevCatlen,xAxis=dataSet.getFromEnv("xAxis"),currCatLen=xAxis.getProcessLen(),catDiff=prevCatlen-currCatLen,prevData=config.JSONData,prevDataLength=prevData.task&&prevData.task.length,currDataLength=datasetJSON.task&&datasetJSON.task.length||0,dataDiff=prevDataLength-currDataLength,diff,startIndex;if(catDiff>dataDiff){diff=catDiff;startIndex=currCatLen}else{diff=dataDiff;startIndex=currDataLength}if(diff>0){this.removeData(startIndex,diff,false)}};_proto.getAxisValuePadding=function getAxisValuePadding(){return this.config.defaultPadding};_proto.drawLabel=function drawLabel(){var dataset=this,conf=dataset.config,chart=dataset.getFromEnv("chart"),animationManager=dataset.getFromEnv("animationManager"),dataStore=dataset.components.data,valElemDummy,startValElemDummy,endValElemDummy,valElem,startValElem,endValElem,config,graphics,dataObj,eventArgs,textAttr,startLabelTextAttr,endLabelTextAttr,dataLabelContainer=dataset.getContainer("dataLabelContainer"),i,len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj.config;graphics=dataObj.graphics;eventArgs=config.eventArgs;valElemDummy=graphics.valElem;textAttr=config._labelTextAttr;if(defined(config.label)&&config.label!==BLANK&&textAttr){valElem=graphics.valElem=animationManager.setAnimation({el:valElemDummy||"text",attr:textAttr,container:dataLabelContainer,component:dataset});valElem.outlineText(conf.showTextOutline,textAttr.fill);if(!valElemDummy){valElem.data("dataset",dataset);dataset.slackElemHandlers(valElem,chart)}else{valElem.removeCSS();valElem.show()}valElem.css(config.style);valElem.data("dataObj",dataObj).data("dataObj",dataObj).data("eventArgs",eventArgs)}else{valElemDummy&&animationManager.setAnimation({el:valElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}startValElemDummy=graphics.startValElem;startLabelTextAttr=config._startLabelTextAttr;if(defined(config.startDate)&&config.startDate!==BLANK&&startLabelTextAttr){startValElem=graphics.startValElem=animationManager.setAnimation({el:startValElemDummy||"text",attr:startLabelTextAttr,container:dataLabelContainer,component:dataset});startValElem.outlineText(conf.showTextOutline,startLabelTextAttr.fill);if(!startValElemDummy){startValElem.data("dataset",dataset);dataset.slackElemHandlers(startValElem,chart)}else{startValElem.removeCSS();startValElem.show()}startValElem.css(config.style);startValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{startValElemDummy&&animationManager.setAnimation({el:startValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}endValElemDummy=graphics.endValElem;endLabelTextAttr=config._endLabelTextAttr;if(defined(config.endDate)&&config.endDate!==BLANK&&endLabelTextAttr){endValElem=graphics.endValElem=animationManager.setAnimation({el:endValElemDummy||"text",attr:endLabelTextAttr,container:dataLabelContainer,component:dataset});endValElem.outlineText(conf.showTextOutline,endLabelTextAttr.fill);if(!endValElemDummy){endValElem.data("dataset",dataset);dataset.slackElemHandlers(endValElem,chart)}else{endValElem.removeCSS();endValElem.show().css(config.style)}endValElem.data("dataObj",dataObj).data("chart",chart).data("eventArgs",eventArgs)}else{endValElemDummy&&animationManager.setAnimation({el:endValElemDummy,component:dataset,callback:hideFn,doNotRemove:true})}}};_proto.taskHoverHandler=function taskHoverHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset"),dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.hoverFillColor,stroke:config.hoverBorderColor};if(config.percentComplete!==-1&&!config.showAsGroup){graphics.slackElem.attr({fill:config.slackHoverColor});graphics.taskFill.attr({fill:config.hoverFillColor});delete attrib.fill}graphics.element.attr(attrib)};_proto.taskHoverOutHandler=function taskHoverOutHandler(){var ele=this,dataObj=ele.data("dataObj")||{},dataset=ele.data("dataset")||{},dataStore=dataset.components.data,config=dataObj.config||{},index=config.index,graphics=dataStore[index]&&dataStore[index].graphics,attrib={fill:config.color,stroke:config.borderColor,"stroke-width":config.borderThickness,"stroke-dasharray":config.dashedStyle};if(config.percentComplete!==-1&&!config.showAsGroup){graphics.slackElem.attr({fill:config.slackColor});graphics.taskFill.attr({fill:config.color});delete attrib.fill}graphics.element.attr(attrib)};_proto.parsePlotAttributes=function parsePlotAttributes(dataObj,index){var dataset=this,chart=dataset.getFromEnv("chart"),jsonData=chart.getFromEnv("dataSource"),chartConfig=chart.config,canvasTop=chartConfig.canvasTop,xAxis=chart.getChildren("xAxis")[0],yAxis=chart.getChildren("yAxis")[0],config,endX,startMs,endMs,setLink,height,id,pHeight,width,width2,xPos,yPos,borderThickness,taskBarElementAttrs,crispBox,halfH,txtAlign,borderFill,padding,incrementId=index,datePadding=chartConfig.datepadding,taskHeight,viewPortConfig=chartConfig.viewPortConfig,x=viewPortConfig.x,labelTextAttr,endLabelTextAttr,startLabelTextAttr,proLen=jsonData.processes.process&&jsonData.processes.process.length,scaleX=viewPortConfig.scaleX,taskBarRadius=chartConfig.taskbarroundradius,cursor,processDimention,lineHeight;config=dataObj&&dataObj.config;!dataObj.graphics&&(dataObj.graphics={});startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){return}taskHeight=config.taskHeight;setLink=config.link;borderThickness=config.borderThickness;id=config.id;borderFill=config.color;lineHeight=config.lineHeight;if(incrementId>proLen-1){incrementId=0}if(typeof config.id!=="undefined"){processDimention=yAxis.getProcessPositionById(id)}else{processDimention=yAxis.getProcessPositionByIndex(incrementId)}incrementId++;pHeight=processDimention.height;padding=pHeight*(isPercent(config.topPadding)&&parseFloat(config.topPadding,10)*.01)||pluckNumber(config.topPadding,pHeight);height=config.height=pHeight*(isPercent(taskHeight)&&parseFloat(taskHeight,10)*.01)||pluckNumber(taskHeight,pHeight);xPos=config.xPos=xAxis.getPixel(config.startMs)+x*scaleX;endX=xAxis.getPixel(config.endMs)+x*scaleX;width=config.width=Math.abs(width2=endX-xPos);yPos=processDimention.bottom+canvasTop-pHeight;yPos=config.yPos=yPos+Math.min(padding,pHeight-height);halfH=height*.5;crispBox=crispBound(xPos,yPos,width,height,borderThickness);xPos=crispBox.x;yPos=crispBox.y;width=crispBox.width;height=crispBox.height;if(checkInvalidValue(xPos,yPos,width,height)===false){config.inValidValue=true;return}config.props={element:{},perComElem:{},slackElem:{}};if(config.showAsGroup){taskBarElementAttrs={path:["M",xPos,yPos,"V",yPos+height,"L",xPos+halfH,yPos+halfH,"H",xPos+width-halfH,"L",xPos+width,yPos+height,"V",yPos,"H",xPos]}}else{taskBarElementAttrs={x:crispBox.x,y:crispBox.y,width:crispBox.width||1,height:height}}Object.assign(taskBarElementAttrs,{fill:borderFill,stroke:config.borderColor,cursor:setLink?"pointer":BLANK,r:taskBarRadius,"stroke-width":borderThickness,width:crispBox.width||1});config.eventArgs={processId:config.processId,taskId:config.taskId,start:config._startDate,end:config._endDate,showAsGroup:config.showAsGroup,link:config.link,sourceType:"task",percentComplete:config.percentComplete!==-1};if(config.percentComplete!==-1&&!config.showAsGroup){width2=width*config.percentComplete*.01;borderFill=TRACKER_FILL;config.props.perComElem={attr:{x:xPos,y:yPos,height:height,width:width2,fill:config.color,cursor:setLink?"pointer":BLANK,"stroke-width":0}};config.props.slackElem={attr:{x:xPos+width2||1,y:yPos,width:width-width2,height:height,fill:config.slackColor,cursor:setLink?"pointer":BLANK,"stroke-width":0}};taskBarElementAttrs.fill=borderFill}txtAlign=config.labelAlign;labelTextAttr=config._labelTextAttr||(config._labelTextAttr={});config.props.element.attr=taskBarElementAttrs;labelTextAttr.x=xPos+width*xAlign[txtAlign]+alignGutter[txtAlign];labelTextAttr.y=yPos-parseInt(lineHeight,10)*.5-chartConfig.tasklabelspadding;labelTextAttr.text=config.label;labelTextAttr.direction=chartConfig.textDirection;labelTextAttr["text-anchor"]=align[txtAlign];labelTextAttr.cursor=cursor;labelTextAttr.fill=convertColor(config.textColor);labelTextAttr["line-height"]=lineHeight;startLabelTextAttr=config._startLabelTextAttr||(config._startLabelTextAttr={});startLabelTextAttr.x=xPos-2-datePadding;startLabelTextAttr.y=yPos+height*.5;startLabelTextAttr.text=config.startDate;startLabelTextAttr["text-anchor"]=POSITION_END;startLabelTextAttr.cursor=cursor;startLabelTextAttr.direction=chartConfig.textDirection;startLabelTextAttr.fill=convertColor(config.textColor);startLabelTextAttr["line-height"]=lineHeight;endLabelTextAttr=config._endLabelTextAttr||(config._endLabelTextAttr={});endLabelTextAttr.x=xPos+width+2+datePadding;endLabelTextAttr.y=yPos+height*.5;endLabelTextAttr.text=config.endDate;endLabelTextAttr.cursor=cursor;endLabelTextAttr.direction=chartConfig.textDirection;endLabelTextAttr["text-anchor"]=POSITION_START;endLabelTextAttr.fill=convertColor(config.textColor);endLabelTextAttr["line-height"]=lineHeight;config.cursor=cursor};_proto.allocatePosition=function allocatePosition(){var dataset=this,dsStore=dataset.components.data||[],length=dsStore.length,i,dataObj;for(i=0;i<length;i++){dataObj=dsStore[i];dataset.parsePlotAttributes(dataObj,i)}};_proto._removeDataVisuals=function _removeDataVisuals(dataObj){var dataset=this,animationManager=dataset.getFromEnv("animationManager"),ele,graphics,graphicsObj;if(!dataObj){return}graphics=dataObj.graphics;for(ele in graphics){graphicsObj=graphics[ele];graphicsObj&&animationManager.setAnimation({el:graphicsObj,component:dataset})}};_proto.draw=function draw(){var dataset=this,i,visible=dataset.getState("visible"),chart=dataset.getFromEnv("chart"),toolTipController=dataset.getFromEnv("toolTipController"),chartConfig=chart.config,canvas=chart.getChildren("canvas")[0],animationManager=dataset.getFromEnv("animationManager"),len,parentContainer=canvas.getChildContainer("taskGroup"),components=dataset.components,dataStore=components.data,dataObj,config,graphics,removeDataArr=components.removeDataArr,removeDataArrLen=removeDataArr&&removeDataArr.length,dataLabelsLayer=chart.getChildContainer("datalabelsGroup"),labelsGroup=canvas.getContainer("labelsGroup"),dataLabelContainer=dataset.getContainer("dataLabelContainer"),isContextChanged=dataset._contextChanged(),container=dataset.getContainer("taskColumnContainer"),shadowContainer=dataset.getContainer("taskColumnShadowContainer"),startMs,endMs,toolText,taskBarElement,perComElem,perComElemDummy,slackElem,slackElemDummy,elemType,taskBarElementAttrs,eventArgs,shadow=chartConfig.showshadow,conf=dataset.config;if(!dataset.getState("removed")&&!dataset.getState("dirty")&&!(isContextChanged&&visible)){return}if(!container){container=dataset.addContainer("taskColumnContainer",animationManager.setAnimation({el:"group",attr:{name:"columns"},container:parentContainer,component:dataset}))}if(!visible){container.hide()}else{container.show()}if(!labelsGroup){labelsGroup=canvas.addContainer("labelsGroup",animationManager.setAnimation({el:"group",attr:{name:"task-plot-labels"},container:dataLabelsLayer,component:canvas}))}if(!dataLabelContainer){dataLabelContainer=dataset.addContainer("dataLabelContainer",animationManager.setAnimation({el:"group",attr:{name:"labels"},container:labelsGroup,component:dataset}))}else{dataLabelContainer.removeCSS()}if(!visible){dataLabelContainer.hide()}else{dataLabelContainer.show()}labelsGroup=animationManager.setAnimation({el:labelsGroup,attr:{transform:"T"+-chart.config.xOffset+",0"},component:canvas});dataLabelContainer.css(conf.labelStyle);if(!shadowContainer){shadowContainer=dataset.addContainer("taskColumnShadowContainer",animationManager.setAnimation({el:"group",attr:{name:"shadow"},container:parentContainer,component:dataset}).toBack());if(!visible){shadowContainer.hide()}}len=dataStore.length;for(i=0;i<len;i++){dataObj=dataStore[i];config=dataObj&&dataObj.config;!dataObj.graphics&&(dataObj.graphics={});graphics=dataObj.graphics;startMs=config&&config.startMs;endMs=config&&config.endMs;if(typeof dataObj==="undefined"||typeof startMs==="undefined"||endMs===null){continue}toolText=config.toolText;if(config.inValidValue){continue}taskBarElement=graphics.element;elemType=config.showAsGroup?"path":"rect";if(taskBarElement&&taskBarElement.type!==elemType){taskBarElement.remove();taskBarElement=graphics.element=null}taskBarElementAttrs=config.props.element.attr;graphics.element=animationManager.setAnimation({el:taskBarElement||elemType,label:elemType,attr:taskBarElementAttrs,container:container,component:dataset});if(!taskBarElement){taskBarElement=graphics.element;taskBarElement.data("dataset",dataset);dataset.slackElemHandlers(taskBarElement,chart)}eventArgs=config.eventArgs;if(config.percentComplete!==-1&&!config.showAsGroup){perComElemDummy=graphics.taskFill;slackElemDummy=graphics.slackElem;perComElem=graphics.taskFill=animationManager.setAnimation({el:perComElemDummy||"rect",attr:config.props.perComElem.attr,container:container,component:dataset});if(!perComElemDummy){dataset.slackElemHandlers(perComElem,chart)}slackElem=graphics.slackElem=animationManager.setAnimation({el:slackElemDummy||"rect",attr:config.props.slackElem.attr,container:container,component:dataset});if(!slackElemDummy){dataset.slackElemHandlers(slackElem,chart)}perComElem.show();perComElem.data("chart",chart).data("dataObj",dataObj).data("dataset",dataset);toolTipController.enableToolTip(perComElem,toolText);slackElem.show();perComElem&&perComElem.data("eventArgs",eventArgs);slackElem&&slackElem.data("eventArgs",eventArgs).data("dataObj",dataObj).data("dataset",dataset).data("chart",chart)}else{graphics.taskFill&&animationManager.setAnimation({el:graphics.taskFill,component:dataset,callback:hideFn,doNotRemove:true});graphics.slackElem&&animationManager.setAnimation({el:graphics.slackElem,component:dataset,callback:hideFn,doNotRemove:true})}taskBarElement.show().shadow({opacity:shadow},shadowContainer).data("dataObj",dataObj).data("chart",chart).data("dataset",dataset).data("eventArgs",eventArgs);toolTipController.enableToolTip(taskBarElement,toolText)}dataset.drawn?dataset.drawLabel():dataset.addJob("drawLabel",dataset.drawLabel.bind(dataset),priorityList.label);dataset.drawn=true;for(i=0;i<removeDataArrLen;i++){dataset._removeDataVisuals(removeDataArr.shift())}};return Task}(Column);export{checkInvalidValue,extractLabelStyle,hideFn};export default Task;