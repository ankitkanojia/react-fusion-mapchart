import FusionCharts from"../../../../fusioncharts/core";import chartType from"./index";import chartValidator from"../../../../../smoke-test/test-sanity/multiaxisline.sanity";import ignoreCaseExt from"../../../../fc-features/src/ignore-case-ext";import inputAdapter from"../../../../fc-features/src/input-ext";import{setup,getSVG,initDimensions,resizeDimensions,CONTAINER_ID}from"../../../../../smoke-test/test-sanity/utility";import{extend2}from"../../../../fc-core/src/lib/";import CommonTests from"../../../../../smoke-test/test-sanity/common.sanity";import{PXSTRING,POINTER}from"../../../../../packages/fc-core/src/lib";import*as chartData from"../../../../../smoke-test/test-data/data-by-chart";FusionCharts.addDep(chartType);FusionCharts.addDep(ignoreCaseExt);FusionCharts.addDep(inputAdapter);var svgElement,chartName=chartType.getName(),chartID=chartName.toLowerCase(),doc=window.document;describe("Running common chart tests for "+chartName,function(){var chart={type:chartID,renderAt:CONTAINER_ID,width:initDimensions.width,height:initDimensions.height,dataFormat:"json",dataSource:{}},config={chartID:chartID,chart:chart,document:doc,chartWrapperId:CONTAINER_ID};CommonTests.forEach(function(test){var itArr;if(test.name&&test.run){it(test.name,function(done){test.run(config,function(result){expect(result).toBe(true);done()})})}else if(test.iterator){itArr=test.iterator(chart);itArr.forEach(function(subTest){it(subTest.name,function(done){subTest.run(config,function(result){expect(result).toBe(true);done()})})})}})});describe("Chart basic testing: "+chartName,function(){var chart,chartObj,itResize,renderData=chartValidator.BASIC.newChart,updateData=chartValidator.BASIC.updateChart;chart={type:chartID,renderAt:CONTAINER_ID};extend2(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("Rendered chart validation passes",function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=chartValidator.BASIC.validate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.render();chartObj.addEventListener("renderComplete",renderComplete)});it("Chart update passes",function(done){expect(chartObj).toBeDefined();var called=0;var renderComplete=function renderComplete(){if(called===0){called++;chartObj.setChartData(updateData||chart.dataSource,"json")}else if(called===1){var response=chartValidator.BASIC.updateValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()});itResize=function itResize(resizeDimensions){it("Chart resize passes for "+resizeDimensions.width+" x "+resizeDimensions.height,function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=chartValidator.BASIC.resizeValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render(function(){chartObj.resizeTo(resizeDimensions.width,resizeDimensions.height)})})};for(var index=0;index<resizeDimensions.length;index++){itResize(resizeDimensions[index])}});describe("Chart EI testing: "+chartType.getName(),function(){var chart,chartObj,eiMethods,renderData=chartValidator.EI.newChart;chart={type:chartID,renderAt:CONTAINER_ID};extend2(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});eiMethods=function eiMethods(methodObj){it(methodObj.name,function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){svgElement=getSVG(chartObj);methodObj.fn(svgElement,chartObj,function(result){expect(result).toBe(true);done()})};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()})};for(var key in chartValidator.EI.methods){if(chartValidator.EI.methods.hasOwnProperty(key)){eiMethods(chartValidator.EI.methods[key])}}});describe("Running yaxisvaluecosmetics tests for "+chartName,function(){var chart={type:chartID,renderAt:CONTAINER_ID,dataSource:{chart:{yaxisvaluefontcolor:"#ff0000",yaxisvaluelink:"https://www.google.com",yaxisvaluefontsize:30,yaxisvaluealpha:50,yaxisvaluefontbold:1,yaxisvaluefontitalic:1,yaxisvaluebgcolor:"#0000ff",yaxisvaluebordercolor:"#ffffff",yaxisvalueborderalpha:20,yaxisvalueborderdashed:1,yaxisvalueborderdashlen:6,yaxisvalueborderdashgap:5,labelalpha:50,animation:0},categories:[{category:[{label:"00:00s"},{label:"00:04s"},{label:"00:08s"},{label:"00:12s"},{label:"00:16s"},{label:"00:20s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",data:[{value:"6"},{value:"26"},{value:"16"},{value:"27"},{value:"28"},{value:"33"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"},{value:"336"},{value:"371"},{value:"389"},{value:"393"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"},{value:"36"},{value:"49"},{value:"68"},{value:"88"}]}]}]}},chartObj;beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){chartObj.dispose()});it("yAxisCosmetics-FontColor",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fill).toBe("rgb(255, 0, 0)");done()});chartObj.render()});it("yAxisCosmetics-FontSize",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fontSize).toBe(chart.dataSource.chart.yaxisvaluefontsize+PXSTRING);done()});chartObj.render()});it("yAxisCosmetics-yaxislabelAlpha",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fillOpacity).toBe((chart.dataSource.chart.yaxisvaluealpha/100).toString());done()});chartObj.render()});it("yAxisCosmetics-labelLink",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).cursor).toBe(POINTER);done()});chartObj.render()});it("yAxisCosmetics-BGColor",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).fill).toBe("rgb(0, 0, 255)");done()});chartObj.render()});it("yAxisCosmetics-BDRColor",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).stroke).toBe("rgb(255, 255, 255)");done()});chartObj.render()});it("yAxisCosmetics-BdrAlpha",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).strokeOpacity).toBe((chart.dataSource.chart.yaxisvalueborderalpha/100).toString());done()});chartObj.render()});it("yAxisCosmetics-xaxislabelAlpha",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("text");expect(getComputedStyle(yAxisTextElement[0]).fillOpacity).toBe((chart.dataSource.chart.labelalpha/100).toString());done()});chartObj.render()});it("yAxisCosmetics-BdrDashed",function(done){chartObj.addEventListener("renderComplete",function(){var yAxisDomElement=document.querySelectorAll('[class*="dataset-axis"]')[4],yAxisTextElement=yAxisDomElement.getElementsByTagName("rect");expect(getComputedStyle(yAxisTextElement[0]).strokeDasharray).toBe("6px, 5px");done()});chartObj.render()})});describe("Axis position testing",function(){var chartObj,data={chart:{caption:"Power Generator",xaxisname:"Time",showvalues:"0",divlinealpha:"100",numvdivlines:"4",vdivlinealpha:"0",showalternatevgridcolor:"1",alternatevgridalpha:"5",animation:"0",xaxisposition:"top"},categories:[{category:[{label:"00:00s"},{label:"00:04s"},{label:"00:08s"},{label:"00:12s"},{label:"00:16s"},{label:"00:20s"}]}],axis:[{title:"Power",titlepos:"left",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Power [W]",data:[{value:"6"},{value:"26"},{value:"16"},{value:"27"},{value:"28"},{value:"33"}]}]},{title:"Temp.",titlepos:"left",numdivlines:"14",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Temperature",data:[{value:"296"},{value:"311"},{value:"336"},{value:"371"},{value:"389"},{value:"393"}]}]},{title:"Speed[RPM]",titlepos:"RIGHT",axisonleft:"0",numdivlines:"10",tickwidth:"10",divlineisdashed:"1",dataset:[{seriesname:"Speed",data:[{value:"1"},{value:"11"},{value:"36"},{value:"49"},{value:"68"},{value:"88"}]}]}]},chart={type:chartID,renderAt:CONTAINER_ID,width:600,height:400,dataFormat:"json",dataSource:data};beforeAll(function(){chartObj=setup(FusionCharts,chart)});afterAll(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("xAxis will be rendered on top",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(74.6);expect(dim.opposite).toBe(350.5);expect(label.getAttribute("y")).toBe("68");done()});chartObj.render()});it("xAxis will be updated to render on bottom",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(317.5);expect(dim.opposite).toBe(41.6);expect(label.getAttribute("y")).toBe("331");done()});data.chart.xaxisposition=undefined;chartObj.setJSONData(data)})});