import FusionCharts from"../../../../fusioncharts/core";import chartType from"./index";import chartValidator from"../../../../../smoke-test/test-sanity/heatmap.sanity";import ignoreCaseExt from"../../../../fc-features/src/ignore-case-ext";import{setup,getSVG,initDimensions,resizeDimensions,CONTAINER_ID}from"../../../../../smoke-test/test-sanity/utility";import{extend2}from"../../../../fc-core/src/lib/";import CommonTests from"../../../../../smoke-test/test-sanity/common.sanity";import*as chartData from"../../../../../smoke-test/test-data/data-by-chart";import{isCloseTo}from"../../../../../dev-tests/viz/utitilies";FusionCharts.addDep(chartType);FusionCharts.addDep(ignoreCaseExt);var svgElement,chartName=chartType.getName(),chartID=chartName.toLowerCase(),doc=window.document;describe("Running common chart tests for "+chartName,function(){var chart={type:chartID,renderAt:CONTAINER_ID,width:initDimensions.width,height:initDimensions.height,dataFormat:"json",dataSource:{}},config={chartID:chartID,chart:chart,document:doc,chartWrapperId:CONTAINER_ID};CommonTests.forEach(function(test){var itArr;if(test.name&&test.run){it(test.name,function(done){test.run(config,function(result){expect(result).toBe(true);done()})})}else if(test.iterator){itArr=test.iterator(chart);itArr.forEach(function(subTest){it(subTest.name,function(done){subTest.run(config,function(result){expect(result).toBe(true);done()})})})}})});describe("Chart basic testing: "+chartName,function(){var chart,chartObj,itResize,renderData=chartValidator.BASIC.newChart,updateData=chartValidator.BASIC.updateChart;chart={type:chartID,renderAt:CONTAINER_ID};extend2(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("Rendered chart validation passes",function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=chartValidator.BASIC.validate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.render();chartObj.addEventListener("renderComplete",renderComplete)});it("Chart update passes",function(done){expect(chartObj).toBeDefined();var called=0;var renderComplete=function renderComplete(){if(called===0){called++;chartObj.setChartData(updateData||chart.dataSource,"json")}else if(called===1){var response=chartValidator.BASIC.updateValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()});itResize=function itResize(resizeDimensions){it("Chart resize passes for "+resizeDimensions.width+" x "+resizeDimensions.height,function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){var response=chartValidator.BASIC.resizeValidate(chartObj);expect(response.flag).toBe(true,response.messages.join(" && "));done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render(function(){chartObj.resizeTo(resizeDimensions.width,resizeDimensions.height)})})};for(var index=0;index<resizeDimensions.length;index++){itResize(resizeDimensions[index])}});describe("Chart EI testing: "+chartType.getName(),function(){var chart,chartObj,eiMethods,renderData=chartValidator.EI.newChart;chart={type:chartID,renderAt:CONTAINER_ID};extend2(chart,renderData);chart.dataSource=chart.dataSource?chart.dataSource:chartData[chartID]["default"];chart.dataSource.chart.animation="0";beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});eiMethods=function eiMethods(methodObj){it(methodObj.name,function(done){expect(chartObj).toBeDefined();var renderComplete=function renderComplete(){svgElement=getSVG(chartObj);methodObj.fn(svgElement,chartObj,function(result){expect(result).toBe(true);done()})};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()})};for(var key in chartValidator.EI.methods){if(chartValidator.EI.methods.hasOwnProperty(key)){eiMethods(chartValidator.EI.methods[key])}}});describe("Text outline testing "+chartName,function(){var chart,chartObj,itResize,renderData={chart:{caption:"Weekly Percentage",subcaption:"In percentage",textoutline:"1",animation:"1"},rows:{row:[{id:"Google",label:"Google US"},{id:"Yahoo",label:"Yahoo US"},{id:"Microsoft",label:"Microsoft US"}]},columns:{column:[{id:"MON",label:"Monday"},{id:"TUE",label:"Tuesday"},{id:"WED",label:"Wednesday"},{id:"THU",label:"Thursday"},{id:"FRI",label:"Friday"}]},dataset:[{data:[{rowid:"Yahoo",columnid:"Mon",value:"0"},{rowid:"Yahoo",columnid:"Tue",value:"71"},{rowid:"Yahoo",columnid:"Wed",value:"70"},{rowid:"Yahoo",columnid:"Thu",value:"3"},{rowid:"Yahoo",columnid:"Fri",value:"79"},{rowid:"Google",columnid:"Mon",value:"68"},{rowid:"Google",columnid:"Tue",value:"5"},{rowid:"Google",columnid:"Wed",value:"95"},{rowid:"Google",columnid:"Thu",value:"-10"},{rowid:"Google",columnid:"Fri",value:"55.98"},{rowid:"Microsoft",columnid:"Mon",value:"98"},{rowid:"Microsoft",columnid:"Tue",value:"8"},{rowid:"Microsoft",columnid:"Wed",value:"123"},{rowid:"Microsoft",columnid:"Thu",value:"79"},{rowid:"Microsoft",columnid:"Fri",value:"39"}]}],colorrange:{mapbypercent:"1",gradient:"1",minvalue:"0",code:"00CCFF",startlabel:"Poor",endlabel:"Good",color:[{code:"66ADD9",maxvalue:"30",label:"BAD"},{code:"F2CF63",maxvalue:"70",label:"AVERAGE"},{code:"D99036",maxvalue:"100"}]}},updateDataWithNoOutline={chart:{caption:"Weekly Percentage",subcaption:"In percentage",animation:"1"},rows:{row:[{id:"Google",label:"Google US"},{id:"Yahoo",label:"Yahoo US"},{id:"Microsoft",label:"Microsoft US"}]},columns:{column:[{id:"MON",label:"Monday"},{id:"TUE",label:"Tuesday"},{id:"WED",label:"Wednesday"},{id:"THU",label:"Thursday"},{id:"FRI",label:"Friday"}]},dataset:[{data:[{rowid:"Yahoo",columnid:"Mon",value:"0"},{rowid:"Yahoo",columnid:"Tue",value:"71"},{rowid:"Yahoo",columnid:"Wed",value:"70"},{rowid:"Yahoo",columnid:"Thu",value:"3"},{rowid:"Yahoo",columnid:"Fri",value:"79"},{rowid:"Google",columnid:"Mon",value:"68"},{rowid:"Google",columnid:"Tue",value:"5"},{rowid:"Google",columnid:"Wed",value:"95"},{rowid:"Google",columnid:"Thu",value:"-10"},{rowid:"Google",columnid:"Fri",value:"55.98"},{rowid:"Microsoft",columnid:"Mon",value:"98"},{rowid:"Microsoft",columnid:"Tue",value:"8"},{rowid:"Microsoft",columnid:"Wed",value:"123"},{rowid:"Microsoft",columnid:"Thu",value:"79"},{rowid:"Microsoft",columnid:"Fri",value:"39"}]}],colorrange:{mapbypercent:"1",gradient:"1",minvalue:"0",code:"00CCFF",startlabel:"Poor",endlabel:"Good",color:[{code:"66ADD9",maxvalue:"30",label:"BAD"},{code:"F2CF63",maxvalue:"70",label:"AVERAGE"},{code:"D99036",maxvalue:"100"}]}};chart={type:chartID,renderAt:CONTAINER_ID,dataSource:renderData};beforeEach(function(){chartObj=setup(FusionCharts,chart)});afterEach(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("Text outline should get applied",function(done){var renderComplete=function renderComplete(){var labelElement=document.querySelector('[class$="label-group fusioncharts-datalabels').getElementsByTagName("text")[0];expect(labelElement.getAttribute("filter")).not.toBe(null);done()};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()});it("Text outline should be removed",function(done){var updateFlag=0,renderComplete=function renderComplete(){if(!updateFlag){updateFlag=1;chartObj.setJSONData(updateDataWithNoOutline)}else{var labelElement=document.querySelector('[class$="label-group fusioncharts-datalabels').getElementsByTagName("text")[0];expect(labelElement.getAttribute("filter")).toBe(null);done()}};chartObj.addEventListener("renderComplete",renderComplete);chartObj.render()})});describe("Axis position testing",function(){var chartObj,data={chart:{caption:"Weekly Percentage",subcaption:"In percentage",animation:"0",yaxisposition:"right",xaxisposition:"top"},rows:{row:[{id:"Google",label:"Google US"},{id:"Yahoo",label:"Yahoo US"},{id:"Microsoft",label:"Microsoft US"}]},columns:{column:[{id:"MON",label:"Monday"},{id:"TUE",label:"Tuesday"},{id:"WED",label:"Wednesday"},{id:"THU",label:"Thursday"},{id:"FRI",label:"Friday"}]},dataset:[{data:[{rowid:"Yahoo",columnid:"Mon",value:"0"},{rowid:"Yahoo",columnid:"Tue",value:"71"},{rowid:"Yahoo",columnid:"Wed",value:"70"},{rowid:"Yahoo",columnid:"Thu",value:"3"},{rowid:"Yahoo",columnid:"Fri",value:"79"},{rowid:"Google",columnid:"Mon",value:"68"},{rowid:"Google",columnid:"Tue",value:"5"},{rowid:"Google",columnid:"Wed",value:"95"},{rowid:"Google",columnid:"Thu",value:"-10"},{rowid:"Google",columnid:"Fri",value:"55.98"},{rowid:"Microsoft",columnid:"Mon",value:"98"},{rowid:"Microsoft",columnid:"Tue",value:"8"},{rowid:"Microsoft",columnid:"Wed",value:"123"},{rowid:"Microsoft",columnid:"Thu",value:"79"},{rowid:"Microsoft",columnid:"Fri",value:"39"}]}],colorrange:{mapbypercent:"1",gradient:"1",minvalue:"0",code:"00CCFF",startlabel:"Poor",endlabel:"Good",color:[{code:"66ADD9",maxvalue:"30",label:"BAD"},{code:"F2CF63",maxvalue:"70",label:"AVERAGE"},{code:"D99036",maxvalue:"100"}]}},chart={type:chartID,renderAt:CONTAINER_ID,width:600,height:400,dataFormat:"json",dataSource:data};beforeAll(function(){chartObj=setup(FusionCharts,chart)});afterAll(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("yAxis will be rendered on right",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("yAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(isCloseTo(dim.x,516.875,1)).toBe(true);expect(isCloseTo(dim.opposite,16,1)).toBe(true);expect(isCloseTo(label.getAttribute("x"),"520.875",1)).toBe(true);done()});chartObj.render()});it("yAxis will be updated to render on left",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("yAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[0],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(isCloseTo(dim.x,83.125,1)).toBe(true);expect(isCloseTo(dim.opposite,584,1)).toBe(true);expect(isCloseTo(label.getAttribute("x"),"79.125",1)).toBe(true);done()});data.chart.yaxisposition=undefined;chartObj.setJSONData(data)});it("xAxis will be rendered on top",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[1],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(70.8);expect(dim.opposite).toBe(310.6);expect(label.getAttribute("y")).toBe("64");done()});chartObj.setJSONData(data)});it("xAxis will be updated to render on bottom",function(done){chartObj.addEventListener("renderComplete",function(e){e.detachHandler();var dim=chartObj.apiInstance.getChildren("xAxis")[0].getAxisDimension(),yAxisLabelsGroup=document.querySelectorAll('[class*="dataset-Label-group"] > [class*="-dataset-axis"]')[1],label=yAxisLabelsGroup.getElementsByTagName("text")[0];expect(dim.y).toBe(294.6);expect(dim.opposite).toBe(54.8);expect(label.getAttribute("y")).toBe("308");done()});data.chart.xaxisposition=undefined;chartObj.setJSONData(data)})});describe("Row Label Cosmetics",function(){var chartObj,data={chart:{showvalues:"1",animation:"0",useroundedges:"0",showplotborder:"1",valuefont:"verdana",rotatevalues:"1",showlabels:"1",labelfont:"verdana",labelfontcolor:"#cc0000",labelfontsize:"10",labelfontbold:"1",labelfontitalic:"1",labelbgcolor:"#00ff00",labelbordercolor:"#cc0000",labelalpha:"85",labelbgalpha:"60",labelborderalpha:"90",labelborderpadding:"2",labelborderradius:"5",labelborderthickness:"2",labelborderdashed:"1",labelborderdashlen:"6",labelborderdashgap:"3"},rows:{row:[{id:"Google",label:"Google US"},{id:"Yahoo",label:"Yahoo US"},{id:"Microsoft",label:"Microsoft US"}]},columns:{column:[{id:"MON",label:"Monday"},{id:"TUE",label:"Tuesday"},{id:"WED",label:"Wednesday"},{id:"THU",label:"Thursday"},{id:"FRI",label:"Friday"}]},dataset:[{data:[{rowid:"Yahoo",columnid:"Mon",value:"0",tllabel:""},{rowid:"Yahoo",columnid:"Tue",value:"71"},{rowid:"Yahoo",columnid:"Wed",value:"70",tllabel:"TOPLEFT"},{rowid:"Yahoo",columnid:"Thu",value:"3"},{rowid:"Yahoo",columnid:"Fri",value:"79",trlabel:"TOPRIGHT"},{rowid:"Google",columnid:"Mon",value:"68"},{rowid:"Google",columnid:"Tue",value:"5",bllabel:"BOTLEFT"},{rowid:"Google",columnid:"Wed",value:"95"},{rowid:"Google",columnid:"Thu",value:"-10",brlabel:"BOTRIGHT"},{rowid:"Google",columnid:"Fri",value:"55.98"},{rowid:"Microsoft",columnid:"Mon",value:"98"},{rowid:"Microsoft",columnid:"Tue",value:"8"},{rowid:"Microsoft",columnid:"Wed",value:"123"},{rowid:"Microsoft",columnid:"Thu",value:"79"},{rowid:"Microsoft",columnid:"Fri",value:"39"}]}],colorrange:{mapbypercent:"1",gradient:"1",minvalue:"0",code:"00CCFF",startlabel:"Poor",endlabel:"Good",color:[{code:"66ADD9",maxvalue:"30",label:"BAD"},{code:"F2CF63",maxvalue:"70",label:"AVERAGE"},{code:"D99036",maxvalue:"100"}]}},chart={type:chartID,renderAt:CONTAINER_ID,width:600,height:400,dataFormat:"json",dataSource:data};beforeAll(function(){chartObj=setup(FusionCharts,chart)});afterAll(function(){if(chartObj&&!chartObj.disposed)chartObj.dispose()});it("label font family",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("text")[0];expect(getComputedStyle(labelDom).fontFamily).toBe("verdana");done()});chartObj.render()});it("label font color",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("text")[0];expect(getComputedStyle(labelDom).fill).toBe("rgb(204, 0, 0)");done()});chartObj.render()});it("label font size",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("text")[0];expect(getComputedStyle(labelDom).fontSize).toBe("10px");done()});chartObj.render()});it("label font bgcolor",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).fill).toBe("rgb(0, 255, 0)");done()});chartObj.render()});it("label font border color",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).stroke).toBe("rgb(204, 0, 0)");done()});chartObj.render()});it("label alpha",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("text")[0];expect(getComputedStyle(labelDom).fillOpacity).toBe("0.85");done()});chartObj.render()});it("label bg alpha",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).fillOpacity).toBe("0.6");done()});chartObj.render()});it("label border alpha",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).strokeOpacity).toBe("0.9");done()});chartObj.render()});it("label border thickness",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).strokeWidth).toBe("2px");done()});chartObj.render()});it("label dasharray",function(done){chartObj.addEventListener("renderComplete",function(e){var rowlabelsGroup=document.querySelectorAll('[class*="dataset-axis"]')[1],labelDom=rowlabelsGroup.getElementsByTagName("rect")[0];expect(getComputedStyle(labelDom).strokeDasharray).toBe("6px, 3px");done()});chartObj.render()})});