import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import CommonSpaceManager from"@fusioncharts/charts/src/chart/_internal/commonspacemanager";import{priorityList}from"@fusioncharts/core/src/schedular";import{getMouseCoordinate}from"@fusioncharts/core/src/lib";import{Tool}from"@fusioncharts/core/src/toolbox";import TreeMapDS from"../../dataset/treemap";import _ref from"./helper";import{getDep}from"@fusioncharts/core/src/dependency-manager";import datasetFactory from"@fusioncharts/charts/src/factories/singleseries-dataset";import{_manageLegendSpace as _manageLegendSpace2,manageGradientLegendSpace as _manageGradientLegendSpace}from"@fusioncharts/charts/src/_internal/common-chart-api/legend-spacemanager.js";import legendItemFactory from"@fusioncharts/charts/src/factories/legend";import createColorRangeManager from"@fusioncharts/charts/src/factories/colorrange";import decideLegendCreation from"@fusioncharts/charts/src/factories/legendmanager";import mousetrackerFactory from"@fusioncharts/charts/src/factories/mouse-tracker";import raphaelShapesButton from"@fusioncharts/core/src/_internal/redraphael/redraphael-shapes/redraphael-shapes.button";var Raphael=getDep("redraphael","plugin"),MOUSEOUT="fc-mouseout",UNDEF;raphaelShapesButton(Raphael);Raphael.addSymbol({backIcon:function backIcon(x,y,radius){var rad=radius-1,x1=x,y1=y-rad,x2=x-rad,y2=y,x3=x,y3=y+rad,x4=x3,y4=y3-rad/2,x5=x4+rad,y5=y4,x6=x5,y6=y5-rad,x7=x5-rad,y7=y6;return["M",x1,y1,"L",x2,y2,x3,y3,x4,y4,x5,y5,x6,y6,x7,y7,"Z"]},homeIcon:function homeIcon(x,y,radius){var rad=radius-1,len=rad*2,x1=x,y1=y-rad,x2=x-rad,y2=y,x3=x2+len/6,y3=y2,x4=x3,y4=y+rad,x5=x4+len/4,y5=y4,x6=x5,y6=y5-rad/2,x7=x6+len/6,y7=y6,x8=x7,y8=y6+rad/2,x9=x7+len/4,y9=y8,x10=x9,y10=y9-rad,x11=x9+len/6,y11=y10;return["M",x1,y1,"L",x2,y2,x3,y3,x4,y4,x5,y5,x6,y6,x7,y7,x8,y8,x9,y9,x10,y10,x11,y11,"Z"]}});var TreeMap=function(_CommonSpaceManager){_inheritsLoose(TreeMap,_CommonSpaceManager);TreeMap.getName=function getName(){return"TreeMap"};function TreeMap(){var _this;_this=_CommonSpaceManager.call(this)||this;_this._lastAttached={};_this.hasGradientLegend=true;_this.addToEnv("ref",_ref());_this.registerFactory("legend",legendItemFactory);_this.registerFactory("legend",decideLegendCreation,["canvas"]);_this.registerFactory("colormanager-decider",createColorRangeManager,["legend"]);_this.registerFactory("mouseTracker",mousetrackerFactory);_this.registerFactory("dataset",datasetFactory,["vCanvas"]);return _this}var _proto=TreeMap.prototype;_proto.getName=function getName(){return"TreeMap"};_proto.__setDefaultConfig=function __setDefaultConfig(){_CommonSpaceManager.prototype.__setDefaultConfig.call(this);this.config.enablemousetracking=true;this.config.skipCanvasDrawing=true;this.config.valuefontbold=0};_proto.configureAttributes=function configureAttributes(dataObj){var iapi=this;iapi.config.skipConfigureIteration={};iapi.config.valuesset=false;iapi.parseChartAttr(dataObj);iapi.createComponent(dataObj);iapi.setTooltipStyle();iapi.configureChildren();iapi._createToolBox()};_proto.mouseoutHandler=function mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex){var chart=this,datasets=chart.config.datasetOrder||chart.getDatasets(),mouseTracker=chart.getChildren("mouseTracker")[0];datasets[_lastDatasetIndex]._firePlotEvent(MOUSEOUT,_lastPointIndex,e);delete mouseTracker._lastDatasetIndex;delete mouseTracker._lastPointIndex};_proto._mouseEvtHandler=function _mouseEvtHandler(e,data){var chart=this,mouseTracker=data.mouseTracker,oriEvent=e.originalEvent,chartConfig=chart.config,canvasLeft=chartConfig.canvasLeft,canvasRight=chartConfig.canvasRight,canvasBottom=chartConfig.canvasBottom,canvasTop=chartConfig.canvasTop,datasets=chartConfig.datasetOrder||chart.getDatasets(),coordinate=getMouseCoordinate(chart.getFromEnv("chart-container"),oriEvent,chart),chartX=coordinate.chartX,chartY=coordinate.chartY,dataset,hoveredInfo,pointFound=false,i=datasets.length,j,l,derivedEvensInfo,_lastDatasetIndex=mouseTracker._lastDatasetIndex,_lastPointIndex=mouseTracker._lastPointIndex;if(chartX>canvasLeft&&chartX<canvasRight&&chartY>canvasTop&&chartY<canvasBottom||chart.config.plotOverFlow){while(i--&&!pointFound){dataset=datasets[i];if(dataset){hoveredInfo=dataset._getHoveredPlot&&dataset._getHoveredPlot(chartX,chartY);if(hoveredInfo&&hoveredInfo.hovered){pointFound=true;hoveredInfo.datasetIndex=i;derivedEvensInfo=mouseTracker.getMouseEvents(e,hoveredInfo.datasetIndex,hoveredInfo.pointIndex)}}}}if((!pointFound||derivedEvensInfo&&derivedEvensInfo.fireOut)&&_lastDatasetIndex!==UNDEF){if(datasets[_lastDatasetIndex]&&datasets[_lastDatasetIndex]._firePlotEvent){if(derivedEvensInfo&&!derivedEvensInfo.events.length){mouseTracker.mouseoutTimer=setTimeout(function(){chart.mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex)},20)}else{chart.mouseoutHandler(e,_lastDatasetIndex,_lastPointIndex);clearTimeout(mouseTracker.mouseoutTimer)}}}if(pointFound){l=derivedEvensInfo.events&&derivedEvensInfo.events.length;if(l){mouseTracker._lastDatasetIndex=hoveredInfo.datasetIndex;_lastPointIndex=mouseTracker._lastPointIndex=hoveredInfo.pointIndex}for(j=0;j<l;j+=1){dataset&&dataset._firePlotEvent&&dataset._firePlotEvent(derivedEvensInfo.events[j],_lastPointIndex,e)}}};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){var jsonData=this.getFromEnv("dataSource");if(!jsonData.data){return true}};_proto.addData=function addData(){var ref=this.getFromEnv("ref"),algorithmFactory=ref.algorithmFactory,args=Array.prototype.slice.call(arguments,0);args.unshift("addData");args.unshift(this._getCleanValue());algorithmFactory.realTimeUpdate.apply(this,args)};_proto.removeData=function removeData(){var ref=this.getFromEnv("ref"),algorithmFactory=ref.algorithmFactory,args=Array.prototype.slice.call(arguments,0);args.unshift("deleteData");args.unshift(this._getCleanValue());algorithmFactory.realTimeUpdate.apply(this,args)};_proto.triggerKDTreePartioning=function triggerKDTreePartioning(){var dataset=this.getDatasets()[0];dataset.addJob("partitioning",dataset.kdTreePartioning.bind(dataset),priorityList.tracker)};_proto.resetSingleTracker=function resetSingleTracker(){var dataset=this.getDatasets()[0],singleTracker=dataset&&dataset.graphics&&dataset.graphics.singleTracker;singleTracker&&singleTracker.attr({x:0,y:0,width:0,height:0,stroke:"rgba(255,255,255,0)","fill-opacity":0})};_proto._manageLegendSpace=function _manageLegendSpace(){_manageLegendSpace2.call(this)};_proto.manageGradientLegendSpace=function manageGradientLegendSpace(allottedSpace){return _manageGradientLegendSpace.call(this,allottedSpace)};_proto.flushKDTree=function flushKDTree(){var dataset=this.getDatasets()[0];dataset.kdTree={}};_proto._createToolBox=function _createToolBox(){_CommonSpaceManager.prototype._createToolBox.call(this);var chart=this,config=chart.config,toolBarType=config.toolbarVAlign==="t"?"chartMenuBar":"actionBar",toolConf=chart.getFromEnv("tool-config"),toolBar;toolBar=chart.getChildren(toolBarType)[0];for(var i=0;i<2;i++){toolBar.attachChild(Tool,"tool",(i===0?"home":"back")+"-"+toolBar.getId()+"-"+chart.getId())}toolBar.getChild("back-"+toolBar.getId()+"-"+chart.getId()).configure(Object.assign({},toolConf,{name:"backIcon",isHidden:true}));toolBar.getChild("home-"+toolBar.getId()+"-"+chart.getId()).configure(Object.assign({},toolConf,{name:"homeIcon",isHidden:true}));chart.addToEnv("toolbarBtns",{back:toolBar.getChild("back-"+toolBar.getId()+"-"+chart.getId()),home:toolBar.getChild("home-"+toolBar.getId()+"-"+chart.getId())})};_proto._getCleanValue=function _getCleanValue(){var numberFormatter=this.getFromEnv("number-formatter");return function(value){return numberFormatter.getCleanValue(value)}};_proto.getDSdef=function getDSdef(){return TreeMapDS};return TreeMap}(CommonSpaceManager);export default TreeMap;