import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import DragBase from"../_internal/dragbase";import{DragNodeDataset,DragNodeConnector,DragNodeLabels,DragNodeGroup}from"../../dataset/dragnode";import{getValidValue,pluck,pluckNumber,ZEROSTRING,extend2}from"@fusioncharts/core/src/lib";import{getDepsByType}from"@fusioncharts/core/src/dependency-manager";import datasetFactory from"../../factories/dragnode-dataset";import{submitData}from"../_internal/editable-charts";import axisFactory from"@fusioncharts/charts/src/factories/xy-axis";import{_mouseEvtHandler as _mouseEvtHandler2}from"@fusioncharts/core/src/base-chart";var DRAGNODE="dragnode";var configurer,UNDEF;var DragNode=function(_DragBase){_inheritsLoose(DragNode,_DragBase);DragNode.getName=function getName(){return"DragNode"};function DragNode(){var _this;_this=_DragBase.call(this)||this;var chart=_assertThisInitialized(_this);chart.fireGroupEvent=true;chart.usesXYinCategory=true;chart.dontShowLegendByDefault=true;_this.registerFactory("dataset",datasetFactory,["vCanvas"]);_this.registerFactory("axis",axisFactory,["canvas"]);return _this}var _proto=DragNode.prototype;_proto.getName=function getName(){return"DragNode"};_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){var datasetsJSON=this.getFromEnv("dataSource").dataset;if(!datasetsJSON){return true}};_proto._mouseEvtHandler=function _mouseEvtHandler(e,data){_mouseEvtHandler2(this,e,data)};_proto.parseChartAttr=function parseChartAttr(dataObj){var iapi=this,chartAttr=iapi.getFromEnv("dataSource").chart,config,transcoders=getDepsByType("transcoder");_DragBase.prototype.parseChartAttr.call(this,dataObj);config=iapi.config;config.formAction=getValidValue(chartAttr.formaction);config.showLegend=pluckNumber(chartAttr.showlegend,0);if(chartAttr.submitdataasxml===ZEROSTRING&&!chartAttr.formdataformat){chartAttr.formdataformat=transcoders.csv().format}config.formDataFormat=pluck(chartAttr.formdataformat,transcoders.xml().format);config.formTarget=pluck(chartAttr.formtarget,"_self");config.formMethod=pluck(chartAttr.formmethod,"POST");config.submitFormAsAjax=pluckNumber(chartAttr.submitformusingajax,1);config.viewMode=pluckNumber(chartAttr.viewmode,0);config.drawTrendRegion=0};_proto.__setDefaultConfig=function __setDefaultConfig(){_DragBase.prototype.__setDefaultConfig.call(this);var chartConf=this.config;chartConf.hasLegend=true;chartConf.defaultDatasetType=DRAGNODE;chartConf.limitUpdaterEnabled=false;chartConf.skipClipping=true;chartConf.numVDivLines=0;chartConf.numDivLines=0;chartConf.setadaptivexmin=1;chartConf.showLimits=0;chartConf.showdivlinevalues=0;chartConf.showzeroplane=0;chartConf.showyaxisvalues=0;chartConf.enablemousetracking=true;chartConf.showzeroplaneontop=0};_proto.addConfigureOptions=function addConfigureOptions(){var chart=this,chartConf=chart.config,restore,submit,toolbar=chart.getFromEnv("toolbar"),hamburgerMenu=toolbar.getChild("hamburgerMenu-"+toolbar.getId()+"-"+chart.getId()+"-0"),configureTools=[{name:"Add Node",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showNodeAddUI()},action:"click"},{name:"Add Connector",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showConnectorAddUI()},action:"click"},{name:"Add Label",handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.showLabelUpdateUI()},action:"click"}];if(chartConf.showRestoreBtn){restore={name:chartConf.restoreBtnTitle,handler:function handler(){var manager=chart.getChildren("canvas")[0].getChildren("vCanvas")[0].getChildren("datasetGroup_dragNode")[0];manager.restoreData()},action:"click"};configureTools.push(restore)}if(chartConf.showFormBtn){submit={name:chartConf.submitBtnTitle,handler:function handler(){submitData.call(chart)},action:"click"};configureTools.push(submit)}if(!chart.config.viewMode){hamburgerMenu.appendInMenu(configureTools)}};_proto.getDSdef=function getDSdef(dsType){switch(dsType){case"connector":return DragNodeConnector;case"dragnode":return DragNodeDataset;case"dragableLabels":return DragNodeLabels}};_proto.getDSGroupdef=function getDSGroupdef(){return DragNodeGroup};_proto._setCategories=function _setCategories(){var iapi=this,dataObj=iapi.getFromEnv("dataSource"),xAxis=iapi.getChildren("xAxis"),categories=dataObj.categories&&dataObj.categories[0].category||[],catLen=categories.length,catArr=[],i,catObj;for(i=0;i<catLen;i++){catObj=categories[i]||{};if(catObj.x!==UNDEF){catArr.push(catObj)}}xAxis&&xAxis[0].setTickValues(catArr)};_proto.getJSONData=function getJSONData(){var chart=this,canvas=chart.getChildren("canvas")[0],vCanvas=canvas.getChildren("vCanvas")[0],groupManager=vCanvas.getChildren("datasetGroup_dragNode")[0],datasetsArr={},jsonObj;if(groupManager){datasetsArr=groupManager.getJSONData()}jsonObj=extend2({},chart.getFromEnv("dataSource"));jsonObj.dataset=datasetsArr.dataset;jsonObj.connectors=datasetsArr.connectors;jsonObj.labels=datasetsArr.labels;return jsonObj};return DragNode}(DragBase);configurer=DragNode.prototype.configure;export default DragNode;export{configurer};