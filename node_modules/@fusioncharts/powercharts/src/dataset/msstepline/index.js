import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{pluckNumber,pluck,toRaphaelColor,getFirstValue}from"@fusioncharts/core/src/lib";import LineDataset from"@fusioncharts/charts/src/dataset/line";import{addDep}from"@fusioncharts/core/src/dependency-manager";import msStepLineAnimation from"./index.animation";var LINE="line",H="H",V="V",M="M",UNDEF;addDep({name:"stepLineAnimation",type:"animationRule",extension:msStepLineAnimation});var MSStepLineDataset=function(_LineDataset){_inheritsLoose(MSStepLineDataset,_LineDataset);function MSStepLineDataset(){var _this;_this=_LineDataset.call(this)||this;_this.getPathArr=function(){var pathObj=this,pathArr=pathObj.pathArr,path2Arr=pathObj.path2Arr;if(pathArr.length||path2Arr.length){return pathArr.concat(path2Arr)}return[]};return _this}var _proto=MSStepLineDataset.prototype;_proto.getType=function getType(){return"dataset"};_proto.getName=function getName(){return"stepLine"};_proto.__setDefaultConfig=function __setDefaultConfig(){_LineDataset.prototype.__setDefaultConfig.call(this);var config=this.config;config.drawverticaljoins=UNDEF;config.useforwardsteps=UNDEF};_proto._addLegend=function _addLegend(){var dataset=this,conf=dataset.config,legend=dataset.getFromEnv("legend"),drawAnchors=pluckNumber(conf.drawanchors,1),legendItem,config={enabled:conf.includeinlegend,type:LINE,drawLine:pluck(conf.drawLine,true),anchorSide:drawAnchors?conf.anchorsides:0,label:getFirstValue(dataset.config.JSONData.seriesname)};if(conf.includeinlegend){legendItem=legend.getItem(dataset.config.legendItemId);if(!legendItem){dataset.config.legendItemId=legend.createItem(dataset);legendItem=legend.getItem(dataset.config.legendItemId);dataset.addExtEventListener("fc-click",function(){legendItem.itemClickFn()},legendItem)}legendItem.configure(config);legendItem.setStateCosmetics("default",{symbol:{fill:toRaphaelColor({color:conf.anchorbgcolor,alpha:conf.anchorbgalpha}),rawFillColor:conf.anchorbgcolor,rawStrokeColor:conf.anchorbordercolor,stroke:toRaphaelColor({color:conf.anchorbordercolor,alpha:"100"}),"stroke-width":conf.anchorborderthickness}});if(!dataset.getState("visible")){legendItem.setLegendState("hidden")}else{legendItem.removeLegendState("hidden")}}else if(dataset.config.legendItemId){legend.disposeItem(dataset.config.legendItemId)}};_proto.getLinePath=function getLinePath(data,positions){var dataset=this,conf=dataset.config,chartConfig=dataset.getFromEnv("chartConfig"),connectNullData=pluckNumber(chartConfig.connectnulldata),obj={},drawVerticalJoins=pluckNumber(conf.drawverticaljoins),halfStep=pluckNumber(chartConfig.stepatmiddle)?dataset.getFromEnv("xAxis").getPVR()*.5:0,lastValidValue=obj.lastValidValue||false,temp=obj.temp||[],temp2=obj.temp2||[],pathArr=obj.pathArr||[],path2Arr=obj.path2Arr||[],lastXPos,i,config,xPos,yPos,pointsJoined=obj.pointsJoined||0,dataObj,setValue,startPos=positions&&positions.begin||0,endPos=positions&&positions.end||data.length,step=chartConfig.viewPortConfig.step||1,dataWithRemovedPaths=[];dataWithRemovedPaths=dataWithRemovedPaths.concat(data);for(i=startPos;i<endPos;i+=step){dataObj=dataWithRemovedPaths[i];if(!dataObj){continue}config=dataObj.config;setValue=config.setValue;if(setValue===UNDEF||config&&config.isSkipped===true){config&&delete config.isSkipped;continue}xPos=config._Px;yPos=config._Py;if(setValue===null||setValue.isNull){if(!connectNullData){temp=[];temp2=[];lastValidValue=false}}else{if(lastValidValue){if(temp.length){pathArr=pathArr.concat(temp);temp=[];pointsJoined++}if(pluckNumber(conf.useforwardsteps)){pathArr.push([H,xPos-halfStep]);if(drawVerticalJoins){pathArr.push([V,yPos])}else{pathArr.push([M,xPos-halfStep,yPos])}if(halfStep){pathArr.push([H,xPos])}}else{if(drawVerticalJoins){pathArr.push([V,yPos])}else{pathArr.push([M,lastXPos,yPos])}pathArr.push([H,xPos]);lastXPos=xPos}}else{temp.push([M,xPos,yPos]);lastXPos=xPos;pointsJoined=0;lastValidValue=true}}}return{pathArr:pathArr,path2Arr:path2Arr,lastValidValue:lastValidValue,pointsJoined:pointsJoined,temp:temp,temp2:temp2,getPathArr:dataset.getPathArr}};return MSStepLineDataset}(LineDataset);export default MSStepLineDataset;