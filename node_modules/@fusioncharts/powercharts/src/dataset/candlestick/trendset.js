import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import Line from"@fusioncharts/charts/src/dataset/line";import{pluck,pluckNumber,getValidValue,getDashStyle,getFirstValue,toRaphaelColor,getFirstColor}from"@fusioncharts/core/src/lib";import{addDep}from"@fusioncharts/core/src/dependency-manager";import trendsetAnimation from"./trendset.animation";var HUNDRED="100",DASH_DEF="none";addDep({name:"trendsetAnimation",type:"animationRule",extension:trendsetAnimation});var Trendset=function(_Line){_inheritsLoose(Trendset,_Line);function Trendset(){return _Line.apply(this,arguments)||this}var _proto=Trendset.prototype;_proto.__setDefaultConfig=function __setDefaultConfig(){_Line.prototype.__setDefaultConfig.call(this);this.config.drawLine=1};_proto.configureAttributes=function configureAttributes(datasetJSON){if(!datasetJSON){return false}this.trimData(datasetJSON);this.config.JSONData=datasetJSON;var dataset=this,chartAttr=dataset.getFromEnv("chart-attrib"),trendset=dataset.config.JSONData,index=dataset.index,setDataArr=trendset.data||trendset.set||[],conf=dataset.config,dataObj,itemValue,dataStore=dataset.components.data,dataStoreObj,config,maxValue=-Infinity,minValue=+Infinity,x,length,xMax=-Infinity,xMin=+Infinity,NumberFormatter=dataset.getFromEnv("number-formatter"),trendSetColor=getFirstColor(pluck(trendset.color,chartAttr.trendsetcolor,"666666")),trendSetAlpha=pluck(trendset.alpha,chartAttr.trendsetalpha,HUNDRED),trendSetThickness=pluckNumber(trendset.thickness,chartAttr.trendsetthickness,2),trendSetDashed=Boolean(pluckNumber(trendset.dashed,chartAttr.trendsetdashed,0)),trendSetDashLen=pluckNumber(trendset.dashlen,chartAttr.trendsetdashlen,4),trendSetDashGap=pluckNumber(trendset.dashgap,chartAttr.trendsetdashgap,4);conf.includeInLegend=pluckNumber(trendset.includeinlegend,1);conf.lineColor=trendSetColor;conf.lineAlpha=trendSetAlpha;conf.connectNullData=pluckNumber(chartAttr.connectnulldata,0);conf.linethickness=trendSetThickness;conf.lineDashStyle=trendSetDashed?getDashStyle(trendSetDashLen,trendSetDashGap):DASH_DEF;conf.name=getValidValue(trendset.name);conf.includeInLegend=pluckNumber(trendset.includeinlegend,1);conf.defaultPadding={left:.5,right:.5};if(!dataStore){dataStore=dataset.components.data=[]}for(index=0,length=setDataArr.length;index<length;index+=1){dataObj=setDataArr[index];if(dataObj&&!dataObj.vline){dataStoreObj=dataStore[index]=dataStore[index]||(dataStore[index]={});config=dataStoreObj.config=dataStoreObj.config||(dataStoreObj.config={});itemValue=config._y=config.setValue=NumberFormatter.getCleanValue(dataObj.value);config.setColor=conf.lineColor;config.setAlpha=conf.lineAlpha;x=NumberFormatter.getCleanValue(dataObj.x);x=config._x=config.x=x!==null?x:index+1;maxValue=Math.max(maxValue,itemValue);minValue=Math.min(minValue,itemValue);xMin=Math.min(xMin,x);xMax=Math.max(xMax,x);config.anchorProps=this._parseAnchorProperties(index);config.hoverEffects={};if(!dataStoreObj.graphics){dataStoreObj.graphics={}}}}conf.max=maxValue;conf.min=minValue;conf.xMax=xMax;conf.xMin=xMin;dataset.getFromEnv("chartConfig").showLegend&&dataset._addLegend();dataset.setState("visible",true);dataset.setState("dirty",true)};_proto._addLegend=function _addLegend(){var dataset=this,conf=dataset.config,legendItem,legend=dataset.getFromEnv("legend");if(conf.includeinlegend){legendItem=legend.getItem(dataset.config.legendItemId);if(!legendItem){dataset.config.legendItemId=legend.createItem(dataset);legendItem=legend.getItem(dataset.config.legendItemId)}else{legendItem.configure({style:legend.config.itemStyle,hiddenStyle:legend.config.itemHiddenStyle,datasetVisible:legend.config.datasetVisible,hoverStyle:legend.config.itemHoverStyle})}legendItem.configure({enabled:conf.includeInLegend,interactiveLegend:false,type:dataset.type,drawLine:true,label:getFirstValue(dataset.config.JSONData.name)});legendItem.setStateCosmetics("default",{symbol:{stroke:toRaphaelColor({color:conf.lineColor,alpha:HUNDRED}),rawFillColor:conf.lineColor}})}else if(dataset.config.legendItemId){legend.disposeItem(dataset.config.legendItemId)}};_proto.getDataLimits=function getDataLimits(){var conf=this.config;return{max:conf.max,min:conf.min,xMax:conf.xMax,xMin:conf.xMin}};_proto.getType=function getType(){return"trendset"};_proto.drawLabel=function drawLabel(){};_proto.getName=function getName(){return"trendset"};return Trendset}(Line);export default Trendset;