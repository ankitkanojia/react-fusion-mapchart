import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import MSCartesian from"@fusioncharts/charts/src/chart/_internal/mscartesian";import{ComponentInterface}from"@fusioncharts/core/src/component-interface";import*as defaultPaletteOption from"@fusioncharts/charts/src/_internal/color-utils/chart-palette-colors";import domEvtHandler from"@fusioncharts/core/src/dom-event";import{raiseWarning}from"@fusioncharts/core/src/event-api";import{pluck,hasTouch,trimString,pluckNumber,getDashStyle,getMouseCoordinate,convertColor,BLANKSTRING,stubFN,extend2}from"@fusioncharts/core/src/lib";import datasetFactory from"../../factories/maps-dataset";import canvasFactory from"@fusioncharts/charts/src/factories/canvas";import createColorRangeManager from"@fusioncharts/charts/src/factories/colorrange";import decideLegendCreation from"@fusioncharts/charts/src/factories/legendmanager";var defaultPaletteOptions=extend2({foregroundcolor:"333333",foregroundalpha:"100",foregrounddarkcolor:"111111",foregrounddarkalpha:"100",foregroundlightcolor:"666666",foregroundlightalpha:"100",backgroundlightcolor:"FFFFFF",backgroundlightalpha:"100",backgroundlightangle:90,backgroundlightratio:"",backgroundcolor:"FFFFCC",backgroundalpha:"100",backgrounddarkcolor:"ffcc66",backgrounddarkalpha:"100",backgrounddarkangle:270,backgrounddarkratio:"",shadow:1},defaultPaletteOption),zeroCommaHundredStr="0,100",MAP_STR="Map",MAPS_STR="maps",GEO_STR="geo",RIGHT_STR="right",colorPaletteMapGlobal={basefontcolor:"foregroundcolor",bordercolor:"foregrounddarkcolor",borderalpha:"foregrounddarkalpha",bgcolor:"backgroundlightcolor",bgalpha:"backgroundlightalpha",bgangle:"backgroundlightangle",bgratio:"backgroundlightratio",canvasbordercolor:"foregrounddarkcolor",canvasborderalpha:"foregrounddarkalpha",canvasbgcolor:"backgroundlightcolor",canvasbgalpha:"backgroundlightalpha",canvasbgangle:"backgroundlightangle",canvasbgratio:"backgroundlightratio",tooltipbordercolor:"foregrounddarkcolor",tooltipborderalpha:"foregrounddarkalpha",tooltipbgcolor:"backgroundlightcolor",tooltipbgalpha:"backgroundlightalpha",tooltipfontcolor:"foregroundcolor",legendbordercolor:"foregrounddarkcolor",legendborderalpha:"foregrounddarkalpha",markerbordercolor:"foregroundlightcolor",markerborderalpha:"foregroundlightalpha",markerfillcolor:"backgrounddarkcolor",markerfillalpha:"backgrounddarkalpha",markerfillangle:"backgrounddarkangle",markerfillratio:"backgrounddarkratio",plotfillcolor:"backgroundcolor",plotfillalpha:"backgroundalpha",plotfillangle:"backgroundangle",plotfillratio:"backgroundratio",plothoverfillcolor:"backgrounddarkcolor",plothoverfillalpha:"backgrounddarkalpha",plothoverfillangle:"backgrounddarkangle",plothoverfillratio:"backgrounddarkratio",plotbordercolor:"foregroundcolor",plotborderalpha:"foregroundalpha",shadow:"shadow"},eiMethodsGlobal={getMapName:function getMapName(){var chart=this,iapi=chart.jsVars.instanceAPI,mapName=iapi.getName().toLowerCase();return mapName},getEntityList:function getEntityList(){var chart=this,iapi=chart.jsVars.instanceAPI,datasets=iapi.getDatasets()||[],i,entities,dataset,len=datasets.length,entityList=[],data,entityObj,config,name;for(i=0;i<len;i++){dataset=datasets[i]||[];name=dataset.getName();if(name==="entities"){entities=dataset;break}}data=entities.components.data;len=data.length;for(i in data){if(data.hasOwnProperty(i)){entityObj=data[i]||{};config=entityObj.config||{};entityList.push({id:config.id,originalId:config.originalId||config.id,label:config.label,shortlabel:config.shortLabel,value:config.value,formattedValue:config.formattedValue,toolText:config.toolText})}}return entityList},getMapAttribute:function getMapAttribute(){var chartObj=this;raiseWarning(this,"12061210581","run","JavaScriptRenderer~getMapAttribute()",'Use of deprecated "getMapAttribute()". Replace with "getChartAttribute()".');return chartObj.getChartAttribute.apply(chartObj,arguments)},exportMap:function exportMap(){var chartObj=this;raiseWarning(this,"12061210581","run","JavaScriptRenderer~exportMap()",'Use of deprecated "exportMap()". Replace with "exportChart()".');return chartObj.exportChart&&chartObj.exportChart.apply(chartObj,arguments)},addMarker:function addMarker(options){var iapi=this.jsVars.instanceAPI,datasets=iapi.getDatasets()||[],len=datasets.length,i,dataset,markers,name;for(i=0;i<len;i++){dataset=datasets[i]||[];name=dataset.getName();if(name==="markers"){markers=dataset;break}}if(markers&&!markers.addMarkerItem(options)){raiseWarning(this,"1309264086","run","MapsRenderer~addMarker()","Failed to add marker. Check the options and try again.")}},updateMarker:function updateMarker(id,options){var iapi=this.jsVars.instanceAPI,datasets=iapi.getDatasets()||[],newId,len=datasets.length,i,dataset,markers,name;for(i=0;i<len;i++){dataset=datasets[i]||[];name=dataset.getName();if(name==="markers"){markers=dataset;break}}if(markers&&id){newId=(id+BLANK).toLowerCase();markers.updateMarkerItem(newId,options)}},removeMarker:function removeMarker(id){var iapi=this.jsVars.instanceAPI,datasets=iapi.getDatasets()||[],len=datasets.length,newId,i,dataset,markers,name;for(i=0;i<len;i++){dataset=datasets[i]||[];name=dataset.getName();if(name==="markers"){markers=dataset;break}}if(id){newId=(id+BLANK).toLowerCase();markers._removeMarkerItem(newId)}}},UNDEF,DASH_DEF="none",COMMASPACE=", ",BLANK="",POSITION_BOTTOM="bottom",SHAPE_CIRCLE="circle",math=window.Math,mathMin=math.min,mathMax=math.max,isWithinCanvas=function isWithinCanvas(e,chart){var mousePos=getMouseCoordinate(chart.getFromEnv("chart-container"),e,chart),chartX=mousePos.chartX,chartY=mousePos.chartY,chartConfig=chart.config,minX=chartConfig.canvasLeft,minY=chartConfig.canvasTop,maxX=chartConfig.canvasLeft+chartConfig.canvasWidth,maxY=chartConfig.canvasHeight+chartConfig.canvasTop;mousePos.insideCanvas=false;mousePos.originalEvent=e;if(chartX>minX&&chartX<maxX&&chartY>minY&&chartY<maxY){mousePos.insideCanvas=true}return mousePos};var ColorPalette=function(_ComponentInterface){_inheritsLoose(ColorPalette,_ComponentInterface);function ColorPalette(hash,index){var _this;_this=_ComponentInterface.call(this)||this;_this.subpalette=BLANKSTRING;_this.key=BLANKSTRING;_this.index=index;var key;for(key in hash){_this.subpalette=defaultPaletteOptions[hash[key]];_this[key]=_this.subpalette instanceof Array?_this.subpalette[index]:_this.subpalette;_this.key=key}return _this}return ColorPalette}(ComponentInterface);var Maps=function(_MSCartesian){_inheritsLoose(Maps,_MSCartesian);function Maps(){var _this2;_this2=_MSCartesian.call(this)||this;_this2.friendlyName=MAP_STR;_this2.revision=1;_this2.hasCanvas=true;_this2.standaloneInit=false;_this2.defaultDatasetType=MAPS_STR;_this2.defaultSeriesType=GEO_STR;_this2.fireGroupEvent=true;_this2.legendposition=RIGHT_STR;_this2.hasGradientLegend=true;_this2.isMap=true;_this2.defaultPaletteOptions={paletteColors:[["A6A6A6","CCCCCC","E1E1E1","F0F0F0"],["A7AA95","C4C6B7","DEDFD7","F2F2EE"],["04C2E3","66E7FD","9CEFFE","CEF8FF"],["FA9101","FEB654","FED7A0","FFEDD5"],["FF2B60","FF6C92","FFB9CB","FFE8EE"]],bgColor:["FFFFFF","CFD4BE,F3F5DD","C5DADD,EDFBFE","A86402,FDC16D","FF7CA0,FFD1DD"],bgAngle:[270,270,270,270,270],bgRatio:[zeroCommaHundredStr,zeroCommaHundredStr,zeroCommaHundredStr,zeroCommaHundredStr,zeroCommaHundredStr],bgAlpha:["100","60,50","40,20","20,10","30,30"],toolTipBgColor:["FFFFFF","FFFFFF","FFFFFF","FFFFFF","FFFFFF"],toolTipBorderColor:["545454","545454","415D6F","845001","68001B"],baseFontColor:["555555","60634E","025B6A","A15E01","68001B"],tickColor:["333333","60634E","025B6A","A15E01","68001B"],trendColor:["545454","60634E","415D6F","845001","68001B"],plotFillColor:["545454","60634E","415D6F","845001","68001B"],borderColor:["767575","545454","415D6F","845001","68001B"],borderAlpha:[50,50,50,50,50]};_this2.colorPaletteMap=colorPaletteMapGlobal;_this2.eiMethods=eiMethodsGlobal;_this2.registerFactory("legend",decideLegendCreation,["canvas"]);_this2.registerFactory("axis",stubFN,["canvas"]);_this2.registerFactory("colormanager-decider",createColorRangeManager,["legend"]);_this2.registerFactory("dataset",datasetFactory,["colormanager-decider"]);_this2.registerFactory("canvas",canvasFactory);return _this2}var _proto=Maps.prototype;_proto._checkInvalidSpecificData=function _checkInvalidSpecificData(){this.config.invalid=false;return false};_proto.__setDefaultConfig=function __setDefaultConfig(){_MSCartesian.prototype.__setDefaultConfig.call(this);var config=this.config;!config.baseWidth&&(config.baseWidth=400);!config.baseHeight&&(config.baseHeight=300);!config.baseScaleFactor&&(config.baseScaleFactor=1)};Maps.getName=function getName(){return"maps"};Maps.getType=function getType(){return"chartAPI"};_proto.getName=function getName(){return this.config.name||"GEO"};_proto.getType=function getType(){return"chartAPI"};_proto.configureAttributes=function configureAttributes(dataObj){var iapi=this,colorPalette=iapi.getChildren("colorPalette")&&iapi.getChildren("colorPalette")[0],chartAttrs;chartAttrs=dataObj.chart=dataObj.chart||dataObj.graph||dataObj.map||{};iapi.jsonData=dataObj;if(!colorPalette){colorPalette=new ColorPalette(this.colorPaletteMap,(chartAttrs.palette>0&&chartAttrs.palette<6?chartAttrs.palette:pluckNumber(iapi.paletteIndex,1))-1);iapi.attachChild(colorPalette,"colorPalette")}iapi.config.skipCanvasDrawing=true;_MSCartesian.prototype.configureAttributes.call(this,dataObj);iapi._parseBackgroundCosmetics()};_proto.parseChartAttr=function parseChartAttr(dataObj){var iapi=this,config,jsonData=iapi.jsonData,chartAttrs=jsonData.chart||jsonData.map,markerAttrs=jsonData.markers,palette=new ColorPalette(this.colorPaletteMap,(chartAttrs.palette>0&&chartAttrs.palette<6?chartAttrs.palette:pluckNumber(iapi.paletteIndex,1))-1),inCancolor,inCanFontFamily,inCanFontSize,style,entityBorderColor=pluck(chartAttrs.entitybordercolor,chartAttrs.bordercolor,palette.plotbordercolor),entityFillColor=pluck(chartAttrs.entityfillcolor,chartAttrs.fillcolor,palette.plotfillcolor),entityFillAlpha=pluck(chartAttrs.entityfillalpha,chartAttrs.fillalpha,palette.plotfillalpha),entityFillRatio=pluck(chartAttrs.entityfillratio,chartAttrs.fillratio,palette.plotfillratio),entityFillAngle=pluck(chartAttrs.entityfillangle,chartAttrs.fillangle,palette.plotfillangle),nullEntityColor=pluck(chartAttrs.nullentityfillcolor,chartAttrs.nullentitycolor,entityFillColor),markerDataEnabled=pluckNumber(chartAttrs.usevaluesformarkers,jsonData.markers&&jsonData.markers.items&&jsonData.markers.items.length,!(jsonData.markers&&jsonData.markers.application&&jsonData.markers.application.length&&jsonData.markers.definition&&jsonData.markers.definition.length));_MSCartesian.prototype.parseChartAttr.call(this,dataObj);config=iapi.config;config.origMarginTop=pluckNumber(chartAttrs.charttopmargin,chartAttrs.maptopmargin,11);config.origMarginLeft=pluckNumber(chartAttrs.chartleftmargin,chartAttrs.mapleftmargin,11);config.origMarginBottom=pluckNumber(chartAttrs.chartbottommargin,chartAttrs.mapbottommargin,11);config.origMarginRight=pluckNumber(chartAttrs.chartrightmargin,chartAttrs.maprightmargin,11);config.labelsOnTop=pluckNumber(chartAttrs.entitylabelsontop,1);style=config.style;inCancolor=style.inCancolor;inCanFontFamily=style.inCanfontFamily;inCanFontSize=style.inCanfontSize;config.entityOpts={baseScaleFactor:config.baseScaleFactor,dataLabels:{style:{fontFamily:inCanFontFamily,fontSize:inCanFontSize,lineHeight:style.inCanLineHeight,color:style.inCancolor}},fillColor:entityFillColor,fillAlpha:entityFillAlpha,fillRatio:entityFillRatio,fillAngle:entityFillAngle,borderColor:entityBorderColor,borderAlpha:pluck(chartAttrs.entityborderalpha,chartAttrs.borderalpha,iapi.borderAlpha,"100"),borderThickness:pluckNumber(chartAttrs.showentityborder,chartAttrs.showborder,1)?pluckNumber(chartAttrs.entityborderthickness,chartAttrs.borderthickness,1):0,scaleBorder:pluckNumber(chartAttrs.scaleentityborder,chartAttrs.scaleborder,0),hoverFillColor:pluck(chartAttrs.entityfillhovercolor,chartAttrs.hoverfillcolor,chartAttrs.hovercolor,palette.plothoverfillcolor),hoverFillAlpha:pluck(chartAttrs.entityfillhoveralpha,chartAttrs.hoverfillalpha,chartAttrs.hoveralpha,palette.plothoverfillalpha),hoverFillRatio:pluck(chartAttrs.entityfillhoverratio,chartAttrs.hoverfillratio,chartAttrs.hoverratio,palette.plothoverfillratio),hoverFillAngle:pluck(chartAttrs.entityfillhoverangle,chartAttrs.hoverfillangle,chartAttrs.hoverangle,palette.plothoverfillangle),hoverBorderThickness:pluck(chartAttrs.entityborderhoverthickness,chartAttrs.hoverborderthickness),hoverBorderColor:pluck(chartAttrs.entityborderhovercolor,entityBorderColor,palette.plotbordercolor),hoverBorderAlpha:pluck(chartAttrs.entityborderhoveralpha,palette.plotborderalpha),nullEntityColor:nullEntityColor,nullEntityAlpha:pluck(chartAttrs.nullentityfillalpha,chartAttrs.nullentityalpha,entityFillAlpha),nullEntityRatio:pluck(chartAttrs.nullentityfillratio,chartAttrs.nullentityratio,entityFillRatio),nullEntityAngle:pluck(chartAttrs.nullentityfillangle,chartAttrs.nullentityangle,entityFillAngle),connectorColor:pluck(chartAttrs.labelconnectorcolor,chartAttrs.connectorcolor,inCancolor),connectorAlpha:pluck(chartAttrs.labelconnectoralpha,chartAttrs.connectoralpha,"100"),connectorThickness:pluckNumber(chartAttrs.labelconnectorthickness,chartAttrs.borderthickness,1),showHoverEffect:pluckNumber(chartAttrs.showentityhovereffect,chartAttrs.usehovercolor,chartAttrs.showhovereffect,1),hoverOnNull:pluckNumber(chartAttrs.hoveronnull,chartAttrs.entityhoveronnull,1),labelPadding:pluckNumber(chartAttrs.labelpadding,5),showLabels:pluckNumber(chartAttrs.showlabels,1),labelsOnTop:pluckNumber(chartAttrs.entitylabelsontop,1),includeNameInLabels:pluckNumber(chartAttrs.includenameinlabels,1),includeValueInLabels:pluckNumber(chartAttrs.includevalueinlabels,0),useSNameInTooltip:pluckNumber(chartAttrs.usesnameintooltip,0),useShortName:pluckNumber(chartAttrs.usesnameinlabels,1),labelSepChar:pluck(chartAttrs.labelsepchar,COMMASPACE),showTooltip:pluckNumber(chartAttrs.showentitytooltip,chartAttrs.showtooltip,1),tooltipSepChar:pluck(chartAttrs.tooltipsepchar,", "),tooltext:chartAttrs.entitytooltext,hideNullEntities:pluckNumber(chartAttrs.hidenullentities,0),showHiddenEntityBorder:pluckNumber(chartAttrs.showhiddenentityborder,1),showNullEntityBorder:pluckNumber(chartAttrs.shownullentityborder,1),hiddenEntityColor:pluck(chartAttrs.hiddenentitycolor,chartAttrs.hiddenentityfillcolor,chartAttrs.hiddenentityalpha||chartAttrs.hiddenentityfillalpha?nullEntityColor:"ffffff"),hiddenEntityAlpha:pluck(chartAttrs.hiddenentityalpha,chartAttrs.hiddenentityfillalpha,.001),shadow:pluckNumber(chartAttrs.showshadow,iapi.defaultPlotShadow,palette.shadow)};config.markerOpts={dataLabels:{style:{fontFamily:pluck(chartAttrs.markerfont,inCanFontFamily),fontSize:pluckNumber(chartAttrs.markerfontsize,parseInt(inCanFontSize,10)),fontColor:pluck(chartAttrs.markerfontcolor,inCancolor)}},showTooltip:pluckNumber(chartAttrs.showmarkertooltip,chartAttrs.showtooltip,1),showLabels:pluckNumber(chartAttrs.showmarkerlabels,chartAttrs.showlabels,1),showHoverEffect:pluckNumber(chartAttrs.showmarkerhovereffect,1),labelPadding:pluck(chartAttrs.markerlabelpadding,"5"),labelWrapWidth:pluckNumber(chartAttrs.markerlabelwrapwidth,0),labelWrapHeight:pluckNumber(chartAttrs.markerlabelwrapheight,0),fillColor:pluck(chartAttrs.markerfillcolor,chartAttrs.markerbgcolor,palette.markerfillcolor),fillAlpha:pluck(chartAttrs.markerfillalpha,palette.markerfillalpha),fillAngle:pluck(chartAttrs.markerfillangle,palette.markerfillangle),fillRatio:pluck(chartAttrs.markerfillratio,palette.markerfillratio),fillPattern:pluck(chartAttrs.markerfillpattern,palette.markerbgpattern),hoverFillColor:chartAttrs.markerfillhovercolor,hoverFillAlpha:chartAttrs.markerfillhoveralpha,hoverFillRatio:chartAttrs.markerfillhoverratio,hoverFillAngle:chartAttrs.markerfillhoverangle,borderThickness:pluck(chartAttrs.markerborderthickness,1),borderColor:pluck(chartAttrs.markerbordercolor,palette.markerbordercolor),borderAlpha:pluckNumber(chartAttrs.markerborderalpha,palette.markerborderalpha),hoverBorderThickness:chartAttrs.markerborderhoverthickness,hoverBorderColor:chartAttrs.markerborderhovercolor,hoverBorderAlpha:chartAttrs.markerborderhoveralpha,radius:pluckNumber(chartAttrs.markerradius&&trimString(chartAttrs.markerradius),7),shapeId:pluck(chartAttrs.defaultmarkershape,SHAPE_CIRCLE),labelSepChar:pluck(chartAttrs.labelsepchar,COMMASPACE),tooltipSepChar:pluck(chartAttrs.tooltipsepchar,", "),autoScale:pluckNumber(chartAttrs.autoscalemarkers,0),tooltext:pluck(markerAttrs&&markerAttrs.tooltext,chartAttrs.markertooltext),dataEnabled:markerDataEnabled,valueToRadius:pluckNumber(chartAttrs.markerradiusfromvalue,1),valueMarkerAlpha:pluck(chartAttrs.valuemarkeralpha,"75"),hideNull:pluckNumber(chartAttrs.hidenullmarkers,0),nullRadius:pluckNumber(chartAttrs.nullmarkerradius,chartAttrs.markerradius,7),adjustViewPort:pluckNumber(chartAttrs.adjustviewportformarkers,0),startAngle:pluckNumber(chartAttrs.markerstartangle,90),maxRadius:pluckNumber(chartAttrs.maxmarkerradius,0),minRadius:pluckNumber(chartAttrs.minmarkerradius,0),applyAll:pluckNumber(chartAttrs.applyallmarkers,0),shadow:pluckNumber(chartAttrs.showmarkershadow,chartAttrs.showshadow,0)};config.connectorOpts={showHoverEffect:pluckNumber(chartAttrs.showconnectorhovereffect,1),thickness:pluckNumber(chartAttrs.connectorthickness,chartAttrs.markerconnthickness,"2"),color:pluck(chartAttrs.connectorcolor,chartAttrs.markerconncolor,palette.markerbordercolor),alpha:pluck(chartAttrs.connectoralpha,chartAttrs.markerconnalpha,"100"),hoverThickness:pluckNumber(chartAttrs.connectorhoverthickness,chartAttrs.connectorthickness,chartAttrs.markerconnthickness,"2"),hoverColor:pluck(chartAttrs.connectorhovercolor,chartAttrs.connectorcolor,chartAttrs.markerconncolor,palette.markerbordercolor),hoverAlpha:pluck(chartAttrs.connectorhoveralpha,chartAttrs.connectoralpha,chartAttrs.markerconnalpha,"100"),dashed:pluckNumber(chartAttrs.connectordashed,chartAttrs.markerconndashed,0),dashLen:pluckNumber(chartAttrs.connectordashlen,chartAttrs.markerconndashlen,3),dashGap:pluckNumber(chartAttrs.connectordashgap,chartAttrs.markerconndashgap,2),font:pluck(chartAttrs.connectorfont,chartAttrs.markerconnfont,inCanFontFamily),fontColor:pluck(chartAttrs.connectorfontcolor,chartAttrs.markerconnfontcolor,inCancolor),fontSize:pluckNumber(chartAttrs.connectorfontsize,chartAttrs.markerconnfontsize,parseInt(inCanFontSize,10)),showLabels:pluckNumber(chartAttrs.showconnectorlabels,chartAttrs.showmarkerlabels,chartAttrs.showlabels,1),labelBgColor:pluck(chartAttrs.connectorlabelbgcolor,chartAttrs.markerconnlabelbgcolor,palette.plotfillcolor),labelBorderColor:pluck(chartAttrs.connectorlabelbordercolor,chartAttrs.markerconnlabelbordercolor,palette.markerbordercolor),shadow:pluckNumber(chartAttrs.showconnectorshadow,chartAttrs.showmarkershadow,chartAttrs.showshadow,0),showTooltip:pluckNumber(chartAttrs.showconnectortooltip,chartAttrs.showmarkertooltip,chartAttrs.showtooltip,1),tooltext:pluck(markerAttrs&&markerAttrs.connectortooltext,chartAttrs.connectortooltext),hideOpen:pluckNumber(chartAttrs.hideopenconnectors,1)};config.adjustViewPortForMarkers=pluckNumber(chartAttrs.adjustviewportformarkers,markerDataEnabled)};_proto._attachMouseEvents=function _attachMouseEvents(){var iapi=this,listeners=iapi.getFromEnv("eventListeners"),containerElem=iapi.getFromEnv("chart-container");listeners.push(domEvtHandler.listen(containerElem,hasTouch?"touchstart":"click",Maps.searchMouseMove,iapi));listeners.push(domEvtHandler.listen(window.document,hasTouch?"touchstart":"mousemove",Maps.searchMouseMove,iapi))};_proto._dispose=function _dispose(){var iapi=this,containerElem=iapi.getFromEnv("chart-container");if(hasTouch){domEvtHandler.unlisten(containerElem,"touchstart",Maps.searchMouseMove);domEvtHandler.unlisten(window.document,"touchstart",Maps.searchMouseMove)}domEvtHandler.unlisten(containerElem,"click",Maps.searchMouseMove);domEvtHandler.unlisten(window.document,"mousemove",Maps.searchMouseMove);_MSCartesian.prototype._dispose.call(this)};Maps.searchMouseMove=function searchMouseMove(e){var mousePos,chart=e.data,chartConfig=chart.config,datasets=chart.getDatasets(),markers=datasets[1],toolTipController=markers&&markers.getFromEnv("toolTipController"),currentToolTip=markers&&markers.config.currentToolTip,lastHoveredPoint=chart.config.lastHoveredPoint,lastMouseCoordinate={};if(!chart.getFromEnv("chart-container")||chart.config.lastInteractionEvent===e.originalEvent){return}chart.config.lastInteractionEvent=e.originalEvent;if((mousePos=isWithinCanvas(e,chart))&&mousePos.insideCanvas){chartConfig.lastMouseEvent=e;lastMouseCoordinate={x:mousePos.chartX,y:mousePos.chartY};chart._searchNearestNeighbour(lastMouseCoordinate,e)}else{lastHoveredPoint&&markers&&markers.hoverOutFn(lastHoveredPoint.element);chart.config.lastHoveredPoint=null;toolTipController&&toolTipController.hide(currentToolTip)}};_proto._searchNearestNeighbour=function _searchNearestNeighbour(point,event){var iapi=this,datasets=iapi.getDatasets(),markers=datasets[1],kdPoint;if(markers){if(!markers.components.kDTree){return}kdPoint=markers.getElement(point);if(kdPoint){markers.highlightPoint(kdPoint,event)}else{markers.highlightPoint(false,event)}}};_proto._createLayers=function _createLayers(){_MSCartesian.prototype._createLayers.call(this);this._attachMouseEvents()};_proto._parseBackgroundCosmetics=function _parseBackgroundCosmetics(){var iapi=this,background=iapi.getChildren("background")[0],config=background.config,palette=iapi.getChildren("colorPalette")[0],chartAttrs=iapi.getFromEnv("chart-attrib"),showBorder;showBorder=config.showBorder=pluckNumber(chartAttrs.showcanvasborder,1);config.borderWidth=showBorder?pluckNumber(chartAttrs.canvasborderthickness,1):0;config.borderRadius=config.borderRadius=pluckNumber(chartAttrs.canvasborderradius,0);config.borderDashStyle=config.borderDashStyle=pluckNumber(chartAttrs.borderdashed,0)?getDashStyle(pluckNumber(chartAttrs.borderdashlen,4),pluckNumber(chartAttrs.borderdashgap,2)):DASH_DEF;config.borderAlpha=pluck(chartAttrs.canvasborderalpha,palette.borderAlpha);config.borderColor=config.borderColor=convertColor(pluck(chartAttrs.canvasbordercolor,palette&&palette.borderColor),config.borderAlpha)};_proto._getBackgroundCosmetics=function _getBackgroundCosmetics(){var iapi=this,chartAttrs=iapi.getFromEnv("chart-attrib")||iapi.jsonData.map,palette=iapi.getChildren("colorPalette")[0];return{FCcolor:{color:pluck(chartAttrs.bgcolor,chartAttrs.canvasbgcolor,palette.bgcolor),alpha:pluck(chartAttrs.bgalpha,chartAttrs.canvasbgalpha,palette.bgalpha),angle:pluck(chartAttrs.bgangle,chartAttrs.canvasbgangle,palette.bgangle),ratio:pluck(chartAttrs.bgratio,chartAttrs.canvasbgratio,palette.bgratio)}}};_proto._parseCanvasCosmetics=function _parseCanvasCosmetics(){_MSCartesian.prototype._parseCanvasCosmetics.call(this);var iapi=this,config=iapi.config,chartAttrs=iapi.getFromEnv("chart-attrib")||iapi.jsonData.map,canvasConfig=iapi.getChildren("canvas")[0].config;config.origMarginTop=pluckNumber(chartAttrs.maptopmargin,11);config.origMarginLeft=pluckNumber(chartAttrs.mapleftmargin,11);config.origMarginBottom=pluckNumber(chartAttrs.mapbottommargin,11);config.origMarginRight=pluckNumber(chartAttrs.maprightmargin,11);config.origCanvasLeftMargin=pluckNumber(chartAttrs.canvasleftmargin,0);config.origCanvasRightMargin=pluckNumber(chartAttrs.canvasrightmargin,0);config.origCanvasTopMargin=pluckNumber(chartAttrs.canvastopmargin,0);config.origCanvasBottomMargin=pluckNumber(chartAttrs.canvasbottommargin,0);canvasConfig.canvasBorderRadius=pluckNumber(chartAttrs.canvasborderradius,0);canvasConfig.origCanvasTopPad=pluckNumber(chartAttrs.canvastoppadding,0);canvasConfig.origCanvasBottomPad=pluckNumber(chartAttrs.canvasbottompadding,0);canvasConfig.origCanvasLeftPad=pluckNumber(chartAttrs.canvasleftpadding,0);canvasConfig.origCanvasRightPad=pluckNumber(chartAttrs.canvasrightpadding,0)};_proto.preliminaryScaling=function preliminaryScaling(){var iapi=this,jsonData=iapi.jsonData,markerArray=jsonData.markers&&jsonData.markers.items||[],i=markerArray&&markerArray.length||0,minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity,x,y,item;while(i--){item=markerArray[i];x=Number(item.x);y=Number(item.y);minX=mathMin(minX,x);minY=mathMin(minY,y);maxX=mathMax(maxX,x);maxY=mathMax(maxY,y)}return{x:minX,y:minY,x1:maxX,y1:maxY}};_proto.getScalingParameters=function getScalingParameters(wg,hg,wv,hv){var iapi=this,aspR=wg/hg,widthScaleR=wv/(wg*iapi.config.baseScaleFactor),heightScaleR=hv/(hg*iapi.config.baseScaleFactor),translateX=0,translateY=0,scaleFactor,strokeWidth;if(widthScaleR>heightScaleR){scaleFactor=heightScaleR;translateX+=(wv-hv*aspR)/2;strokeWidth=200/(hg*scaleFactor)}else{scaleFactor=widthScaleR;translateY+=(hv-wv/aspR)/2;strokeWidth=200/(wg*scaleFactor)}return{scaleFactor:scaleFactor,strokeWidth:strokeWidth,translateX:translateX,translateY:translateY}};_proto.calculateMarkerBounds=function calculateMarkerBounds(scaleFactor,xOffset,yOffset){var iapi=this,config=iapi.config,markerOptions=config.markerOpts,datasets=iapi.getDatasets(),limits=iapi.getDataLimits(),dataMin=limits.dataMin,dataMax=limits.dataMax,hideNull=markerOptions.hideNull,nullRadius=markerOptions.nullRadius,v2r=markerOptions.valueToRadius,markerDataset,markerConf,minR,maxR,markerArray,i,name,dataset,len,minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity,x,y,r,definition,item;for(i=0,len=datasets.length;i<len;i++){dataset=datasets[i];name=dataset.getName();if(name==="markers"){markerDataset=dataset}}if(markerDataset){markerDataset.calculateMarkerRadiusLimits();markerConf=markerDataset.config||{};minR=markerConf.minRadius;maxR=markerConf.maxRadius;markerArray=markerDataset.components&&markerDataset.components.markerObjs||{};for(i in markerArray){item=markerArray[i];config=item.config;definition=config.definition||{};if(config.cleanValue!==null){if(v2r&&definition.radius===UNDEF){config.radius=minR+(maxR-minR)*(config.cleanValue-dataMin)/(dataMax-dataMin)}}else{if(hideNull){config.__hideMarker=true}else if(config.radius===null){config.radius=nullRadius}continue}r=Number(config.radius);x=(Number(definition.x)+xOffset)*scaleFactor;y=(Number(definition.y)+yOffset)*scaleFactor;minX=mathMin(minX,x-r);minY=mathMin(minY,y-r);maxX=mathMax(maxX,x+r);maxY=mathMax(maxY,y+r)}}return{x:minX,y:minY,x1:maxX,y1:maxY}};_proto._spaceManager=function _spaceManager(){var availableHeight,iapi=this,config=iapi.config,legend=iapi.getChildren("legend")&&iapi.getChildren("legend")[0],legendPosition=legend&&legend.config.legendPos,chartAttrs=iapi.getFromEnv("chart-attrib"),showBorder=config.showBorder,translateX=config.origMarginLeft,translateY=config.origMarginTop,wg=iapi.config.baseWidth,hg=iapi.config.baseHeight,scalingParams,wv,hv,sFactor,extraMarkerSpace={},xDifference=0,yDifference=0,initHv,initWv,allottedSpace,topSpace,markerOptions=config.markerOpts,chartBorderWidth=config.borderWidth=showBorder?pluckNumber(chartAttrs.borderthickness,1):0;iapi._allocateSpace({top:chartBorderWidth,bottom:chartBorderWidth,left:chartBorderWidth,right:chartBorderWidth});iapi._allocateSpace(iapi._manageActionBarSpace&&iapi._manageActionBarSpace(config.availableHeight*.225)||{});if(legendPosition==="right"){allottedSpace=config.canvasWidth*.3}else{allottedSpace=config.canvasHeight*.3}config.showLegend&&iapi._manageLegendSpace(allottedSpace);availableHeight=legendPosition===POSITION_BOTTOM?config.canvasHeight*.225:config.canvasWidth*.225;topSpace=iapi._manageChartMenuBar(availableHeight);wv=config.canvasWidth;hv=config.canvasHeight;if(markerOptions.dataEnabled){if(config.adjustViewPortForMarkers){extraMarkerSpace=iapi.preliminaryScaling();if(extraMarkerSpace.x1>wg){wg=extraMarkerSpace.x1}if(extraMarkerSpace.x<0){wg+=-extraMarkerSpace.x;xDifference=-extraMarkerSpace.x}if(extraMarkerSpace.y1>hg){hg=extraMarkerSpace.y1}if(extraMarkerSpace.y<0){hg+=-extraMarkerSpace.y;yDifference=-extraMarkerSpace.y}scalingParams=iapi.getScalingParameters(wg,hg,wv,hv);extraMarkerSpace=iapi.calculateMarkerBounds(scalingParams.scaleFactor*iapi.config.baseScaleFactor,xDifference,yDifference);initHv=hv;initWv=wv;if(extraMarkerSpace.x<0){translateX+=-extraMarkerSpace.x;wv+=extraMarkerSpace.x}if(extraMarkerSpace.y<0){translateY+=-extraMarkerSpace.y;hv+=extraMarkerSpace.y}if(extraMarkerSpace.x1>initWv){wv-=extraMarkerSpace.x1-initWv}if(extraMarkerSpace.y1>initHv){hv-=extraMarkerSpace.y1-initHv}}else{scalingParams=iapi.getScalingParameters(wg,hg,wv,hv);iapi.calculateMarkerBounds(scalingParams.scaleFactor*iapi.config.baseScaleFactor,xDifference,yDifference)}scalingParams=iapi.getScalingParameters(wg,hg,wv,hv);translateX+=xDifference*scalingParams.scaleFactor*iapi.config.baseScaleFactor;translateY+=yDifference*scalingParams.scaleFactor*iapi.config.baseScaleFactor}else{scalingParams=iapi.getScalingParameters(wg,hg,wv,hv)}iapi.config.scalingParams=scalingParams;sFactor=scalingParams.scaleFactor;scalingParams.translateX=scalingParams.translateX+translateX;scalingParams.translateY=scalingParams.translateY+translateY+topSpace.top||0;scalingParams.sFactor=sFactor*iapi.config.baseScaleFactor*100/100;scalingParams.transformStr=["t",scalingParams.translateX,",",scalingParams.translateY,"s",sFactor,",",sFactor,",0,0"].join("");iapi.config.annotationConfig={id:"Geo",showbelow:0,autoscale:0,grpxshift:scalingParams.translateX?scalingParams.translateX:0,grpyshift:scalingParams.translateY?scalingParams.translateY:0,xscale:(sFactor?sFactor*iapi.config.baseScaleFactor:1)*100,yscale:(sFactor?sFactor*iapi.config.baseScaleFactor:1)*100,scaletext:1,options:{useTracker:true}}};_proto.getDataLimits=function getDataLimits(){var iapi=this,datasets=iapi.getDatasets(),length=datasets.length,dataset,dataMin=+Infinity,dataMax=-Infinity,limits,i;for(i=0;i<length;i++){dataset=datasets[i];limits=dataset.getDataLimits();dataMin=mathMin(dataMin,limits.min);dataMax=mathMax(dataMax,limits.max)}return{dataMin:dataMin,dataMax:dataMax}};_proto.getEntityPaths=function getEntityPaths(copy){var returnObj={},ents=this.config.entities,id;if(copy){for(id in ents){returnObj[id]=ents[id]}return returnObj}return ents};_proto.checkComplete=function checkComplete(){var iapi=this;if(iapi.config.entityFlag&&iapi.config.entitiesReady){iapi.config.entityFlag=false;iapi.config.markersDrawn=true;iapi.fireChartInstanceEvent("internal.mapdrawingcomplete",{renderer:iapi})}};return Maps}(MSCartesian);export default Maps;