import _inheritsLoose from"@babel/runtime/helpers/inheritsLoose";import{pluckNumber,pluck,pluckFontSize,hiddenStr,visibleStr}from"@fusioncharts/core/src/lib";import{pluckBoolean}from"../utils";import AnnotationBaseShape from"./annotation-base";import CircleAnnotation from"./annotation-circle";import PathAnnotation from"./annotation-path";import RectAnnotation from"./annotation-rect";import ImageAnnotation from"./annotation-image";import TextAnnotation from"./annotation-text";import PolygonAnnotation from"./annotation-polygon";import ComponentBase from"@fusioncharts/core/src/component-interface/component-base";var DEFAULT_IS_VISIBLE=true,DEFAULT_OPACITY=100,DEFAULT_COLOR="#FF0000",DEFAULT_SHOW_SHADOW=0,ELEMENT_TYPE_GROUP="group",ANNOTATION_GROUP_ID_LOWER="lowerAnnotationGroup",ANNOTATION_GROUP_ID_UPPER="upperAnnotationGroup",DEFAULT_POSITION=0,shapeMap={circle:CircleAnnotation,arc:CircleAnnotation,line:PathAnnotation,path:PathAnnotation,rectangle:RectAnnotation,polygon:PolygonAnnotation,image:ImageAnnotation,text:TextAnnotation};var AnnotationGroup=function(_AnnotationBaseShape){_inheritsLoose(AnnotationGroup,_AnnotationBaseShape);function AnnotationGroup(id){var _this;_this=_AnnotationBaseShape.call(this,id)||this;_this.groups=[];_this.items=[];return _this}var _proto=AnnotationGroup.prototype;_proto.getName=function getName(){return"group"};_proto.configureAttributes=function configureAttributes(rawConfig){var group=this,groupConfig=group.config,itemType;group.rawConfig=rawConfig||{};groupConfig.id=group.rawConfig.id||group.getId("group");groupConfig.autoScale=pluckNumber(group.rawConfig.autoScale,1);groupConfig.scaleText=pluckNumber(group.rawConfig.scaleText,0);groupConfig.scaleX=groupConfig.origScaleX=pluckNumber(group.rawConfig.xScale)/100;groupConfig.scaleY=groupConfig.origScaleY=pluckNumber(group.rawConfig.yScale)/100;groupConfig.scaleImages=pluckNumber(group.rawConfig.scaleImages,0);groupConfig.constrainedScale=pluckNumber(group.rawConfig.constrainedScale,1);groupConfig.origH=Number(group.rawConfig.origH);groupConfig.origW=Number(group.rawConfig.origW);groupConfig.link=group.rawConfig.link;groupConfig.color=group.rawConfig.color||DEFAULT_COLOR;groupConfig.alpha=pluckNumber(parseFloat(group.rawConfig.alpha),DEFAULT_OPACITY);groupConfig.showShadow=pluckNumber(group.rawConfig.showShadow,DEFAULT_SHOW_SHADOW);groupConfig.x=pluckNumber(group.rawConfig.x,group.rawConfig.xPos,DEFAULT_POSITION);groupConfig.y=pluckNumber(group.rawConfig.y,group.rawConfig.yPos,DEFAULT_POSITION);groupConfig.font=pluck(group.rawConfig.font,"Verdana, sans");groupConfig.fontSize=pluckFontSize(group.rawConfig.fontSize,10);groupConfig.textAlign=pluck(group.rawConfig.textAlign);groupConfig.textVAlign=pluck(group.rawConfig.textVAlign);groupConfig.rotateText=pluck(group.rawConfig.rotateText);groupConfig.wrapText=pluck(group.rawConfig.wrapText);groupConfig.grpXShift=pluckNumber(group.rawConfig.grpXShift,0);groupConfig.grpYShift=pluckNumber(group.rawConfig.grpYShift,0);groupConfig.xShift=pluckNumber(group.rawConfig.xShift,0);groupConfig.yShift=pluckNumber(group.rawConfig.yShift,0);groupConfig.toolText=group.rawConfig.toolText;groupConfig.isVisible=pluckBoolean(group.rawConfig.isVisible,DEFAULT_IS_VISIBLE);groupConfig.elementType=ELEMENT_TYPE_GROUP;groupConfig.containerConfiguration={id:group.rawConfig.showBelow?ANNOTATION_GROUP_ID_LOWER:ANNOTATION_GROUP_ID_UPPER,label:ELEMENT_TYPE_GROUP,isParent:true};groupConfig.animationLabel=ELEMENT_TYPE_GROUP;if(group.rawConfig.customComponent instanceof ComponentBase){groupConfig.customComponent=groupConfig.rawConfig.customComponent}else{delete groupConfig.customComponent}group.rawConfig.itemConfigs.forEach(function(itemConfig){itemType=itemConfig.type&&itemConfig.type.toLowerCase();if(shapeMap[itemType]){group.attachChild(shapeMap[itemType],"item",itemConfig.id).configure(itemConfig)}});group.items=group.getChildren("item")||[]};_proto.updateScale=function updateScale(){var group=this,groupConfig=group.config,scaleValue,widthScaleFactor,heightScaleFactor,scaleX,scaleY,chart=group.getFromEnv("chart"),chartHeight=+chart.getFromEnv("chartHeight"),chartWidth=+chart.getFromEnv("chartWidth"),autoScale=groupConfig.autoScale,isConstrained=groupConfig.constrainedScale;group._setConfig("origW",Number(groupConfig.origW)||chartWidth);group._setConfig("origH",Number(groupConfig.origH)||chartHeight);if(autoScale){widthScaleFactor=chartWidth/groupConfig.origW*(Number(groupConfig.origScaleX)||1);heightScaleFactor=chartHeight/groupConfig.origH*(Number(groupConfig.origScaleY)||1)}else{widthScaleFactor=heightScaleFactor=1}scaleValue=Math.min(widthScaleFactor,heightScaleFactor);group._setConfig("scaleValue",scaleValue);if(autoScale>0||isNaN(groupConfig.scaleX)){scaleX=isConstrained?scaleValue:widthScaleFactor;group._setConfig("scaleX",scaleX)}if(autoScale>0||isNaN(groupConfig.scaleY)){scaleY=isConstrained?scaleValue:heightScaleFactor;group._setConfig("scaleY",scaleY)}groupConfig.scaleFont=groupConfig.scaleText?Math.min(groupConfig.scaleX,groupConfig.scaleY):1;groupConfig.scaleImageX=groupConfig.scaleImages?groupConfig.scaleX:1;groupConfig.scaleImageY=groupConfig.scaleImages?groupConfig.scaleY:1;groupConfig.scaleInfo={scaleX:groupConfig.scaleX,scaleY:groupConfig.scaleY,scaleValue:groupConfig.scaleValue}};_proto.updateAttr=function updateAttr(){var group=this,groupConfig=group.config,attr=groupConfig.calculatedAttrs,key,xTrans,yTrans;for(key in attr){attr[key]&&(groupConfig[key]=attr[key])}xTrans=group.getScaledVal(groupConfig.grpXShift)+groupConfig.xShift;yTrans=group.getScaledVal(groupConfig.grpYShift)+groupConfig.yShift;group._setConfig("attr",{transform:"T"+xTrans+","+yTrans})};_proto.retrieveItem=function retrieveItem(id){var group=this,i,len;for(i=0,len=group.items.length;i<len;i++){if(group.items[i].getId()===id){return group.items[i]}}};_proto.getScaledVal=function getScaledVal(val,isX){var group=this,multiplier;if(group){multiplier=isX?group._getConfig("scaleX"):(isX===false?group._getConfig("scaleY"):group._getConfig("scaleValue"))||1;return val*multiplier}return val};_proto.getScaledFont=function getScaledFont(fontSize){var group=this;if(group){return fontSize*group._getConfig("scaleFont")}return fontSize};_proto.getScaledImageVal=function getScaledImageVal(val,isX){var group=this,multiplier;if(group){multiplier=(isX?group._getConfig("scaleImageX"):group._getConfig("scaleImageY"))||1;return val*multiplier}return val};_proto.getScaleInfo=function getScaleInfo(){return this.config.scaleInfo};_proto.draw=function draw(){var group=this,attr=group._getConfig("attr")||{},xTrans,yTrans;group.updateScale();group.parseAndSetAttribute();xTrans=group.getScaledVal(group._getConfig("grpXShift"))+group._getConfig("xShift");yTrans=group.getScaledVal(group._getConfig("grpYShift"))+group._getConfig("yShift");attr.name=group._getConfig("id");attr.transform=attr.transform||"T"+xTrans+","+yTrans;attr.visibility=group.config.isVisible?visibleStr:hiddenStr;group.addGraphicalElement({el:"group",attr:attr,container:group.config.containerConfiguration,component:group.config.customComponent||group,label:group.config.animationLabel,id:group.config.id})};return AnnotationGroup}(AnnotationBaseShape);export default AnnotationGroup;